"use strict";(self["webpackChunkvue_antd_pro"]=self["webpackChunkvue_antd_pro"]||[]).push([[622],{28622:function(e,t,a){a.r(t),a.d(t,{default:function(){return Oe}});var n=function(){var e=this,t=e._self._c;return t("a-card",[t("a-tabs",{attrs:{type:"card",size:"small"}},[t("a-tab-pane",{key:"1",attrs:{tab:"系统环境配置"}},[t("SystemEnvironmentsComponent")],1),t("a-tab-pane",{key:"2",attrs:{tab:"审核参数配置"}},[t("InspectComponent")],1),t("a-tab-pane",{key:"3",attrs:{tab:"数据库实例配置"}},[t("DBConfigsComponent")],1),t("a-tab-pane",{key:"4",attrs:{tab:"数据查询权限配置"}},[t("DasComponent")],1)],1)],1)},r=[],i=(a(68309),function(){var e=this,t=e._self._c;return t("a-card",[t("a-form",{attrs:{layout:"inline",form:e.form},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}}},[t("a-form-item",[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["environment"],expression:"['environment']"}],staticStyle:{width:"200px"},attrs:{allowClear:"",placeholder:"请选择环境","show-search":""}},e._l(e.environments,(function(a,n){return t("a-select-option",{key:n,attrs:{label:a.name,value:a.name}},[e._v(" "+e._s(a.name)+" ")])})),1)],1),t("a-form-item",[t("a-input-search",{directives:[{name:"decorator",rawName:"v-decorator",value:["search"],expression:"['search']"}],staticStyle:{width:"300px"},attrs:{allowClear:"",placeholder:"输入要查询内容"}})],1),t("a-form-item",[t("span",{staticClass:"table-page-search-submitButtons"},[t("a-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")])],1)]),t("a-form-item",{staticStyle:{float:"right","margin-right":"0px"}},[t("a-button",{attrs:{type:"primary"},on:{click:e.onAdd}},[t("a-icon",{attrs:{type:"plus"}}),e._v("新增")],1)],1)],1),t("a-table",{attrs:{columns:e.tableColumns,rowKey:function(e,t){return t},dataSource:e.tableData,pagination:e.pagination,loading:e.loading,size:"middle"},on:{change:e.handleTableChange},scopedSlots:e._u([{key:"schema",fn:function(a,n){return t("span",{},[t("router-link",{attrs:{to:{name:"view.admin.systemManage.das.detail",params:{username:n.username,schema:n.schema,instance_id:n.instance_id}}}},[e._v(e._s(a))])],1)}},{key:"hostname",fn:function(a,n){return t("span",{},[e._v(" "+e._s(a)+":"+e._s(n.port)+" ")])}},{key:"action",fn:function(a,n){return t("span",{},[t("div",{staticClass:"editable-row-operations"},[t("a",{attrs:{type:"dashed"},on:{click:function(t){return e.DeleteConfirm(n.id)}}},[t("span",{staticStyle:{color:"#409eff"}},[e._v("删除")])])])])}}])}),t("DasAddComponent",{ref:"DasAddComponent",on:{refreshTable:e.getAdminGrants}})],1)}),o=[],s=a(23711),l=a(83941),c=a(37255),u=(a(41539),a(74916),a(64765),a(34820)),d=function(e){return u.ZP.request({url:"/api/v1/admin/dbconfig",method:"get",params:e})},m=function(e){return u.ZP.request({url:"/api/v1/admin/dbconfig",method:"post",data:e})},p=function(e){return u.ZP.request({url:"/api/v1/admin/dbconfig/".concat(e.id),method:"put",data:e})},f=function(e){return u.ZP.request({url:"/api/v1/admin/dbconfig/".concat(e),method:"delete",data:e})},h=function(e){return u.ZP.request({url:"/api/v1/admin/environment",method:"get",params:e})},v=function(e){return u.ZP.request({url:"/api/v1/admin/environment",method:"post",data:e})},g=function(e){return u.ZP.request({url:"/api/v1/admin/environment/".concat(e.id),method:"put",data:e})},b=function(e){return u.ZP.request({url:"/api/v1/admin/environment/".concat(e),method:"delete",data:e})},y=a(86325),_=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"新增数据库访问权限",width:"55%","on-ok":"onSubmit"},on:{cancel:e.handleCancel},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("template",{slot:"footer"},[t("a-button",{key:"back",on:{click:e.handleCancel}},[e._v("取消")]),t("a-button",{key:"submit",attrs:{type:"primary",loading:e.loading},on:{click:e.onSubmit}},[e._v("确定")])],1),t("a-form",{attrs:{form:e.form,"label-col":{span:4},"wrapper-col":{span:18}}},[t("a-form-item",{attrs:{label:"用户",help:"需要开通访问权限的用户","has-feedback":""}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["username",{rules:[{required:!0,message:"请选择用户"}]}],expression:"['username', { rules: [{ required: true, message: '请选择用户' }] }]"}],attrs:{placeholder:"请选择用户",allowClear:"","show-search":""}},e._l(e.users,(function(a,n){return t("a-select-option",{key:n,attrs:{label:a.username,value:a.username}},[e._v(" "+e._s(a.username)+" "),t("strong",[e._v(e._s(a.nick_name))])])})),1)],1),t("a-form-item",{attrs:{label:"DB类型","has-feedback":""}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["db_type",{initialValue:"MySQL",rules:[{required:!0,message:"请选择DB类型"}]}],expression:"['db_type', { initialValue: 'MySQL', rules: [{ required: true, message: '请选择DB类型' }] }]"}],attrs:{placeholder:"请选择DB类型",allowClear:"","show-search":""},on:{change:e.changeDBType}},e._l(e.dbTypes,(function(a,n){return t("a-select-option",{key:n,attrs:{label:a,value:a}},[e._v(" "+e._s(a)+" ")])})),1)],1),t("a-form-item",{attrs:{label:"环境","has-feedback":""}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["environment",{rules:[{required:!0,message:"请选择工单环境"}]}],expression:"['environment', { rules: [{ required: true, message: '请选择工单环境' }] }]"}],attrs:{placeholder:"请选择工单环境",allowClear:"","show-search":""},on:{change:e.changeEnvs}},e._l(e.environments,(function(a,n){return t("a-select-option",{key:n,attrs:{label:a.name,value:a.id}},[e._v(" "+e._s(a.name)+" ")])})),1)],1),t("a-form-item",{attrs:{label:"实例","has-feedback":""}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["instance_id",{rules:[{required:!0,message:"请选择数据库实例"}]}],expression:"['instance_id', { rules: [{ required: true, message: '请选择数据库实例' }] }]"}],attrs:{placeholder:"请选择数据库实例",allowClear:"","show-search":""},on:{change:e.changeIns}},e._l(e.instances,(function(a,n){return t("a-select-option",{key:n,attrs:{label:a.remark,value:a.instance_id}},[e._v(" "+e._s(a.remark)+" ")])})),1)],1),t("a-form-item",{attrs:{label:"库名",help:"需要开通访问权限的库名","has-feedback":""}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["schema",{rules:[{required:!0,message:"请选择数据库"}]}],expression:"['schema', { rules: [{ required: true, message: '请选择数据库' }] }]"}],attrs:{placeholder:"请选择数据库",allowClear:"","show-search":""},on:{change:e.getTables}},e._l(e.schemas,(function(a,n){return t("a-select-option",{key:n,attrs:{label:a.schema,value:a.schema}},[e._v(" "+e._s(a.schema)+" ")])})),1)],1),t("a-form-item",{attrs:{label:"表名",help:"需要开通访问权限的表，可不选。不选，默认开通当前库的访问权限；选择指定的表，仅开通当前库指定表的访问权限","has-feedback":""}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["tables",{rules:[{required:!1,message:"请选择表名"}]}],expression:"['tables', { rules: [{ required: false, message: '请选择表名' }] }]"}],attrs:{placeholder:"请选择表名",allowClear:"",mode:"multiple","show-search":""}},e._l(e.tables,(function(a,n){return t("a-select-option",{key:n,attrs:{label:a,value:a}},[e._v(" "+e._s(a)+" ")])})),1)],1)],1)],2)},k=[],w=(a(54747),a(94688)),x=["MySQL","TiDB","ClickHouse"],S={data:function(){return{visible:!1,loading:!1,users:[],environments:[],instances:[],schemas:[],tables:[],dbTypes:x,form:this.$form.createForm(this,{name:"dasAdd"})}},methods:{showModal:function(){this.form.resetFields(),this.visible=!0},handleCancel:function(e){this.visible=!1},getUsers:function(){var e=this;(0,w.xE)({is_page:!1}).then((function(t){e.users=t.data})).catch((function(e){}))},getEnvironments:function(){var e=this;return(0,c.Z)((0,l.Z)().mark((function t(){var a;return(0,l.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,h({is_page:!1});case 3:a=t.sent,e.environments=a.data,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),e.$message.error("Failed to fetch environments:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},changeDBType:function(){this.form.resetFields(["environment","instance_id","schema"])},changeEnvs:function(e){var t=this;this.form.resetFields(["instance_id","schema"]);var a={id:e,db_type:this.form.getFieldValue("db_type"),is_page:!1};(0,y.sk)(a).then((function(e){t.instances=e.data})).catch((function(e){}))},changeIns:function(e){var t=this;this.form.resetFields(["schema"]);var a={instance_id:e,is_page:!1};(0,y.HX)(a).then((function(e){t.schemas=e.data})).catch((function(e){}))},getTables:function(e){var t=this;this.form.resetFields(["tables"]);var a={instance_id:this.form.getFieldValue("instance_id"),schema:e};(0,y.Q4)(a).then((function(e){if("0001"===e.code)return t.$notification.error({title:"加载表失败，请稍后重试",message:e.message}),!1;e.data.forEach((function(e){t.tables.push(e.table_name)}))})).catch((function(e){}))},createAdminGrants:function(e){var t=this;(0,y.Fh)(e).then((function(e){var a="0000"===e.code?"info":"error";t.$message[a](e.message)})).catch((function(e){})).finally((function(){t.handleCancel(),t.$emit("refreshTable")}))},onSubmit:function(e){var t=this;this.loading=!0,e.preventDefault(),this.form.validateFields((function(e,a){e||("string"===typeof a["port"]&&(a["port"]=parseInt(a["port"])),t.createAdminGrants(a))})),this.loading=!1}},mounted:function(){this.getUsers(),this.getEnvironments()}},C=S,q=a(1001),Z=(0,q.Z)(C,_,k,!1,null,null,null),E=Z.exports,T=[{title:"用户名",dataIndex:"username",key:"username",scopedSlots:{customRender:"username"}},{title:"库名",dataIndex:"schema",key:"schema",scopedSlots:{customRender:"schema"}},{title:"环境",dataIndex:"environment",key:"environment",scopedSlots:{customRender:"environment"}},{title:"类型",dataIndex:"db_type",key:"db_type",scopedSlots:{customRender:"db_type"}},{title:"实例ID",dataIndex:"instance_id",key:"instance_id",scopedSlots:{customRender:"instance_id"}},{title:"主机",dataIndex:"hostname",key:"hostname",scopedSlots:{customRender:"hostname"}},{title:"备注",dataIndex:"remark",key:"remark",scopedSlots:{customRender:"remark"}},{title:"更新时间",dataIndex:"updated_at",key:"updated_at",scopedSlots:{customRender:"updated_at"}},{title:"操作",dataIndex:"action",key:"action",scopedSlots:{customRender:"action"}}],N={components:{DasAddComponent:E},data:function(){return{loading:!1,environments:[],tableColumns:T,tableData:[],pagination:{current:1,pageSize:10,total:0,pageSizeOptions:["10","20"],showSizeChanger:!0},form:this.$form.createForm(this,{name:"das"})}},methods:{getEnvironments:function(){var e=this;return(0,c.Z)((0,l.Z)().mark((function t(){var a;return(0,l.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,h({is_page:!1});case 3:a=t.sent,e.environments=a.data,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),e.$message.error("Failed to fetch environments:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},getAdminGrants:function(){var e=this;this.loading=!0;var t=(0,s.Z)({page_size:this.pagination.pageSize,page:this.pagination.current,is_page:!0},this.filters);(0,y.TH)(t).then((function(t){"0000"===t.code?(e.pagination.total=t.total,e.tableData=t.data):e.$message.error(t.message)})).catch((function(e){})).finally((function(){e.loading=!1}))},onAdd:function(){this.$refs.DasAddComponent.showModal()},DeleteConfirm:function(e){var t=this;this.$confirm({title:"警告",content:"你确定删除？这将会删除当前的库表权限！！！",okText:"Yes",okType:"danger",cancelText:"No",onOk:function(){(0,y.AK)(e).then((function(e){"0001"===e.code?t.$message.warning(e.message):t.$message.info(e.message)})).catch((function(e){})).finally((function(){t.getAdminGrants()}))},onCancel:function(){}})},handleTableChange:function(e){this.pagination.current=e.current,this.pagination.pageSize=e.pageSize,this.getAdminGrants()},handleSearch:function(e){var t=this;e.preventDefault(),this.form.validateFields((function(e,a){e||(t.filters={environment:a["environment"],search:a["search"]},t.pagination.current=1,t.getAdminGrants())}))}},mounted:function(){this.getAdminGrants(),this.getEnvironments()}},P=N,z=(0,q.Z)(P,i,o,!1,null,"af5cbcea",null),D=z.exports,I=function(){var e=this,t=e._self._c;return t("a-card",[t("a-form",{attrs:{layout:"inline",form:e.form},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}}},[t("a-form-item",[t("a-cascader",{directives:[{name:"decorator",rawName:"v-decorator",value:["organization_key"],expression:"['organization_key']"}],staticStyle:{width:"200px"},attrs:{"field-names":{label:"title",value:"key",children:"children"},options:e.organizations,"change-on-select":"","expand-trigger":"hover",placeholder:"请选择组织"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"apartment"},slot:"suffixIcon"})],1)],1),t("a-form-item",[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["environment"],expression:"['environment']"}],staticStyle:{width:"200px"},attrs:{allowClear:"",placeholder:"请选择环境","show-search":""}},e._l(e.environments,(function(a,n){return t("a-select-option",{key:n,attrs:{label:a.name,value:a.name}},[e._v(" "+e._s(a.name)+" ")])})),1)],1),t("a-form-item",[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["db_type"],expression:"['db_type']"}],staticStyle:{width:"200px"},attrs:{allowClear:"",placeholder:"请选择DB类型","show-search":""}},e._l(e.dbTypes,(function(a,n){return t("a-select-option",{key:n,attrs:{label:a,value:a}},[e._v(" "+e._s(a)+" ")])})),1)],1),t("a-form-item",[t("a-input-search",{directives:[{name:"decorator",rawName:"v-decorator",value:["search"],expression:"['search']"}],staticStyle:{width:"250px"},attrs:{allowClear:"",placeholder:"输入要查询内容"}})],1),t("a-form-item",[t("span",{staticClass:"table-page-search-submitButtons"},[t("a-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")])],1)]),t("a-form-item",{staticStyle:{float:"right","margin-right":"0px"}},[t("a-button",{attrs:{type:"primary"},on:{click:e.onAdd}},[t("a-icon",{attrs:{type:"plus"}}),e._v("新增")],1)],1)],1),t("a-table",{attrs:{columns:e.tableColumns,rowKey:function(e,t){return t},dataSource:e.tableData,pagination:e.pagination,loading:e.loading,size:"middle"},on:{change:e.handleTableChange},scopedSlots:e._u([{key:"use_type",fn:function(a){return t("span",{},["工单"===a?t("a-tag",{attrs:{color:"blue"}},[e._v(" "+e._s(a)+" ")]):t("a-tag",{attrs:{color:"purple"}},[e._v(e._s(a))])],1)}},{key:"action",fn:function(a,n){return t("span",{},[t("div",{staticClass:"editable-row-operations"},[t("a",{on:{click:function(){return e.editRow(n)}}},[t("span",{staticStyle:{color:"#409eff"}},[e._v("编辑")])]),t("a-divider",{attrs:{type:"vertical"}}),t("a",{attrs:{type:"dashed"},on:{click:function(t){return e.DeleteConfirm(n.id)}}},[t("span",{staticStyle:{color:"#409eff"}},[e._v("删除")])])],1)])}},{key:"expandedRowRender",fn:function(a){return t("span",{},[t("pre",[e._v(e._s(JSON.stringify(a.inspect_params,null,2)))])])}}])}),t("DBConfigsAddComponent",{ref:"DBConfigsAddComponent",on:{refreshTable:e.getDBConfig}}),t("DBConfigsEditComponent",{ref:"DBConfigsEditComponent",on:{refreshTable:e.getDBConfig}})],1)},$=[],F=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"新增数据库实例",width:"50%","on-ok":"onSubmit"},on:{cancel:e.handleCancel},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("template",{slot:"footer"},[t("a-button",{key:"back",on:{click:e.handleCancel}},[e._v("取消")]),t("a-button",{key:"submit",attrs:{type:"primary",loading:e.loading},on:{click:e.onSubmit}},[e._v("确定")])],1),t("a-form",{attrs:{form:e.form,"label-col":{span:4},"wrapper-col":{span:18}}},[t("a-form-item",{attrs:{label:"环境","has-feedback":""}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["environment",{rules:[{required:!0,message:"请选择环境"}]}],expression:"['environment', { rules: [{ required: true, message: '请选择环境' }] }]"}],attrs:{placeholder:"请选择环境",allowClear:"","show-search":""}},e._l(e.environments,(function(a,n){return t("a-select-option",{key:n,attrs:{label:a.name,value:a.id}},[e._v(" "+e._s(a.name)+" ")])})),1)],1),t("a-form-item",{attrs:{label:"组织","has-feedback":""}},[t("a-cascader",{directives:[{name:"decorator",rawName:"v-decorator",value:["organization_key",{rules:[{required:!0,message:"请选择组织"}]}],expression:"['organization_key', { rules: [{ required: true, message: '请选择组织' }] }]"}],attrs:{"field-names":{label:"title",value:"key",children:"children"},options:e.organizations,"change-on-select":"","expand-trigger":"hover",placeholder:"请选择组织"}})],1),t("a-form-item",{attrs:{label:"类型","has-feedback":""}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["db_type",{initialValue:"MySQL",rules:[{required:!0,message:"请选择数据库类型"}]}],expression:"['db_type', { initialValue: 'MySQL', rules: [{ required: true, message: '请选择数据库类型' }] }]"}],attrs:{placeholder:"请选择数据库类型"}},[t("a-select-option",{attrs:{value:"MySQL"}},[e._v(" MySQL ")]),t("a-select-option",{attrs:{value:"TiDB"}},[e._v(" TiDB ")]),t("a-select-option",{attrs:{value:"ClickHouse"}},[e._v(" ClickHouse ")])],1)],1),t("a-form-item",{attrs:{label:"用途","has-feedback":""}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["use_type",{initialValue:"工单",rules:[{required:!0,message:"请选择数据库用途"}]}],expression:"['use_type', { initialValue: '工单', rules: [{ required: true, message: '请选择数据库用途' }] }]"}],attrs:{placeholder:"请选择数据库用途"}},[t("a-select-option",{attrs:{value:"查询"}},[e._v(" 查询 ")]),t("a-select-option",{attrs:{value:"工单"}},[e._v(" 工单 ")])],1)],1),t("a-form-item",{attrs:{label:"主机名","has-feedback":""}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["hostname",{rules:[{required:!0,min:3,max:128,message:"请输入主机名"}],validateTrigger:"blur"}],expression:"[\n          'hostname',\n          {\n            rules: [{ required: true, min: 3, max: 128, message: '请输入主机名' }],\n            validateTrigger: 'blur',\n          },\n        ]"}]})],1),t("a-form-item",{attrs:{label:"端口","has-feedback":""}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["port",{type:"number",rules:[{required:!0,message:"请输入端口"}],validateTrigger:"blur"}],expression:"[\n          'port',\n          {\n            type: 'number',\n            rules: [{ required: true, message: '请输入端口' }],\n            validateTrigger: 'blur',\n          },\n        ]"}]})],1),t("a-form-item",{attrs:{label:"账号","has-feedback":""}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["user_name",{rules:[{required:!0,min:2,max:128,message:"请输入账号"}],validateTrigger:"blur"}],expression:"[\n          'user_name',\n          {\n            rules: [{ required: true, min: 2, max: 128, message: '请输入账号' }],\n            validateTrigger: 'blur',\n          },\n        ]"}]})],1),t("a-form-item",{attrs:{label:"密码","has-feedback":""}},[t("a-input-password",{directives:[{name:"decorator",rawName:"v-decorator",value:["password",{rules:[{required:!0,message:"请输入密码"}],validateTrigger:"blur"}],expression:"[\n          'password',\n          {\n            rules: [{ required: true, message: '请输入密码' }],\n            validateTrigger: 'blur',\n          },\n        ]"}]})],1),t("a-form-item",{attrs:{label:"自定义审核参数",help:"格式要求为JSON类型，默认为{}，表示继承全局审核参数","has-feedback":""}},[t("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["inspect_params",{initialValue:"{}",rules:[{required:!0,message:"请输入自定义审核参数，默认为{}",validator:e.validatorInspectParams}]}],expression:"[\n          'inspect_params',\n          {\n            initialValue: '{}',\n            rules: [\n              {\n                required: true,\n                message: '请输入自定义审核参数，默认为{}',\n                validator: validatorInspectParams,\n              },\n            ],\n          },\n        ]"}],attrs:{"auto-size":{minRows:5,maxRows:10},placeholder:"请输入自定义审核参数，默认为{}"}})],1),t("a-form-item",{attrs:{label:"备注","has-feedback":""}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["remark",{rules:[{required:!0,min:3,max:256,message:"请输入备注"}],validateTrigger:"blur"}],expression:"[\n          'remark',\n          {\n            rules: [{ required: true, min: 3, max: 256, message: '请输入备注' }],\n            validateTrigger: 'blur',\n          },\n        ]"}]})],1)],1)],2)},O=[],R=(a(47941),{data:function(){return{visible:!1,loading:!1,environments:[],organizations:[],form:this.$form.createForm(this,{name:"dbconfigAdd"}),validatorInspectParams:function(e,t,a){try{JSON.parse(t)}catch(n){return a("请输入正确的JSON格式")}a()}}},methods:{showModal:function(){this.form.resetFields(),this.visible=!0},handleCancel:function(e){this.visible=!1},getEnvironments:function(){var e=this;return(0,c.Z)((0,l.Z)().mark((function t(){var a;return(0,l.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,h({is_page:!1});case 3:a=t.sent,e.environments=a.data,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),e.$message.error("Failed to fetch environments:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},getOrganizations:function(){var e=this;return(0,c.Z)((0,l.Z)().mark((function t(){var a;return(0,l.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,w.xY)({is_page:!1});case 3:a=t.sent,e.organizations=a.data,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),e.$message.error("Failed to fetch organizations:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},createDBConfig:function(e){var t=this;m(e).then((function(e){var a="0000"===e.code?"info":"error";t.$message[a](e.message)})).catch((function(e){})).finally((function(){t.visible=!1,t.loading=!1,t.$emit("refreshTable")}))},onSubmit:function(e){var t=this;this.loading=!0,e.preventDefault(),this.form.validateFields((function(e,a){e||(a["port"]=parseInt(a["port"],10),isNaN(a["port"])||(a["inspect_params"]=JSON.parse(a["inspect_params"]),t.createDBConfig(a)))})),this.loading=!1}},mounted:function(){this.getEnvironments(),this.getOrganizations()}}),L=R,B=(0,q.Z)(L,F,O,!1,null,null,null),A=B.exports,M=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"编辑数据库配置",width:"50%","on-ok":"onSubmit"},on:{cancel:e.handleCancel},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("template",{slot:"footer"},[t("a-button",{key:"back",on:{click:e.handleCancel}},[e._v("取消")]),t("a-button",{key:"submit",attrs:{type:"primary",loading:e.loading},on:{click:e.onSubmit}},[e._v("确定")])],1),t("a-form",{attrs:{form:e.form,"label-col":{span:4},"wrapper-col":{span:18}}},[t("a-form-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{label:"ID"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["id"],expression:"['id']"}]})],1),t("a-form-item",{attrs:{label:"环境","has-feedback":""}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["environment",{rules:[{required:!0,message:"请选择环境"}]}],expression:"['environment', { rules: [{ required: true, message: '请选择环境' }] }]"}],attrs:{placeholder:"请选择环境",allowClear:"","show-search":""}},e._l(e.environments,(function(a,n){return t("a-select-option",{key:n,attrs:{label:a.name,value:a.id}},[e._v(" "+e._s(a.name)+" ")])})),1)],1),t("a-form-item",{attrs:{label:"组织","has-feedback":""}},[t("a-cascader",{directives:[{name:"decorator",rawName:"v-decorator",value:["organization_key",{rules:[{required:!0,message:"请选择组织"}]}],expression:"['organization_key', { rules: [{ required: true, message: '请选择组织' }] }]"}],attrs:{"field-names":{label:"title",value:"key",children:"children"},options:e.organizations,"change-on-select":"","expand-trigger":"hover",placeholder:"请选择组织"}})],1),t("a-form-item",{attrs:{label:"类型","has-feedback":""}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["db_type",{initialValue:"MySQL",rules:[{required:!0,message:"请选择数据库类型"}]}],expression:"['db_type', { initialValue: 'MySQL', rules: [{ required: true, message: '请选择数据库类型' }] }]"}],attrs:{placeholder:"请选择数据库类型"}},[t("a-select-option",{attrs:{value:"MySQL"}},[e._v(" MySQL ")]),t("a-select-option",{attrs:{value:"TiDB"}},[e._v(" TiDB ")]),t("a-select-option",{attrs:{value:"ClickHouse"}},[e._v(" ClickHouse ")])],1)],1),t("a-form-item",{attrs:{label:"用途","has-feedback":""}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["use_type",{initialValue:"工单",rules:[{required:!0,message:"请选择数据库用途"}]}],expression:"['use_type', { initialValue: '工单', rules: [{ required: true, message: '请选择数据库用途' }] }]"}],attrs:{placeholder:"请选择数据库用途"}},[t("a-select-option",{attrs:{value:"查询"}},[e._v(" 查询 ")]),t("a-select-option",{attrs:{value:"工单"}},[e._v(" 工单 ")])],1)],1),t("a-form-item",{attrs:{label:"主机名","has-feedback":""}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["hostname",{rules:[{required:!0,min:3,max:128,message:"请输入主机名"}],validateTrigger:"blur"}],expression:"[\n          'hostname',\n          {\n            rules: [{ required: true, min: 3, max: 128, message: '请输入主机名' }],\n            validateTrigger: 'blur',\n          },\n        ]"}]})],1),t("a-form-item",{attrs:{label:"端口","has-feedback":""}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["port",{rules:[{required:!0,message:"请输入端口"}],validateTrigger:"blur"}],expression:"[\n          'port',\n          {\n            rules: [{ required: true, message: '请输入端口' }],\n            validateTrigger: 'blur',\n          },\n        ]"}]})],1),t("a-form-item",{attrs:{label:"账号","has-feedback":""}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["user_name",{rules:[{required:!0,min:2,max:128,message:"请输入账号"}],validateTrigger:"blur"}],expression:"[\n          'user_name',\n          {\n            rules: [{ required: true, min: 2, max: 128, message: '请输入账号' }],\n            validateTrigger: 'blur',\n          },\n        ]"}]})],1),t("a-form-item",{attrs:{label:"密码","has-feedback":""}},[t("a-input-password",{directives:[{name:"decorator",rawName:"v-decorator",value:["password",{rules:[{required:!1,message:"请输入密码"}],validateTrigger:"blur"}],expression:"[\n          'password',\n          {\n            rules: [{ required: false, message: '请输入密码' }],\n            validateTrigger: 'blur',\n          },\n        ]"}],attrs:{placeholder:"留空则不修改密码"}})],1),t("a-form-item",{attrs:{label:"自定义审核参数",help:"格式要求为JSON类型，默认为{}，表示继承全局审核参数","has-feedback":""}},[t("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["inspect_params",{initialValue:"{}",rules:[{required:!0,message:"请输入自定义审核参数，默认为{}",validator:e.validatorInspectParams}]}],expression:"[\n          'inspect_params',\n          {\n            initialValue: '{}',\n            rules: [\n              {\n                required: true,\n                message: '请输入自定义审核参数，默认为{}',\n                validator: validatorInspectParams,\n              },\n            ],\n          },\n        ]"}],attrs:{"auto-size":{minRows:5,maxRows:10},placeholder:"请输入自定义审核参数，默认为{}"}})],1),t("a-form-item",{attrs:{label:"备注","has-feedback":""}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["remark",{rules:[{required:!0,min:3,max:256,message:"请输入备注"}],validateTrigger:"blur"}],expression:"[\n          'remark',\n          {\n            rules: [{ required: true, min: 3, max: 256, message: '请输入备注' }],\n            validateTrigger: 'blur',\n          },\n        ]"}]})],1)],1)],2)},G=[],V={data:function(){return{visible:!1,loading:!1,environments:[],organizations:[],form:this.$form.createForm(this,{name:"dbConfigEdit"}),validatorInspectParams:function(e,t,a){try{JSON.parse(t)}catch(n){return a("请输入正确的JSON格式")}a()}}},methods:{getEnvironments:function(){var e=this;return(0,c.Z)((0,l.Z)().mark((function t(){var a;return(0,l.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,h({is_page:!1});case 3:a=t.sent,e.environments=a.data,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),e.$message.error("Failed to fetch environments:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},getOrganizations:function(){var e=this;return(0,c.Z)((0,l.Z)().mark((function t(){var a;return(0,l.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,w.xY)({is_page:!1});case 3:a=t.sent,e.organizations=a.data,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),e.$message.error("Failed to fetch organizations:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},showModal:function(e){var t=this;this.form.resetFields(),this.$nextTick((function(){setTimeout((function(){var a={id:e.id,hostname:e.hostname,port:e.port,user_name:e.user_name,inspect_params:JSON.stringify(e.inspect_params),use_type:e.use_type,db_type:e.db_type,environment:e.environment,organization_key:e.organization_path,remark:e.remark};t.form.setFieldsValue(a)}))})),this.visible=!0},handleCancel:function(e){this.visible=!1},updateDBConfig:function(e){var t=this;p(e).then((function(e){var a="0000"===e.code?"info":"error";t.$message[a](e.message)})).catch((function(e){})).finally((function(){t.visible=!1,t.loading=!1,t.$emit("refreshTable")}))},onSubmit:function(e){var t=this;this.loading=!0,e.preventDefault(),this.form.validateFields((function(e,a){e||(a["port"]=parseInt(a["port"],10),isNaN(a["port"])||(a["inspect_params"]=JSON.parse(a["inspect_params"]),t.updateDBConfig(a)))})),this.loading=!1}},mounted:function(){this.getEnvironments(),this.getOrganizations()}},Q=V,J=(0,q.Z)(Q,M,G,!1,null,null,null),j=J.exports,H=[{title:"用途",dataIndex:"use_type",key:"use_type",scopedSlots:{customRender:"use_type"}},{title:"环境",dataIndex:"environment_name",key:"environment_name",scopedSlots:{customRender:"environment_name"}},{title:"类型",dataIndex:"db_type",key:"db_type",scopedSlots:{customRender:"db_type"}},{title:"组织",dataIndex:"organization_name",key:"organization_name",scopedSlots:{customRender:"organization_name"}},{title:"主机名",dataIndex:"hostname",key:"hostname",scopedSlots:{customRender:"hostname"}},{title:"端口",dataIndex:"port",key:"port",scopedSlots:{customRender:"port"}},{title:"备注",dataIndex:"remark",key:"remark",scopedSlots:{customRender:"remark"}},{title:"创建时间",dataIndex:"created_at",key:"created_at",scopedSlots:{customRender:"created_at"}},{title:"更新时间",dataIndex:"updated_at",key:"updated_at",scopedSlots:{customRender:"updated_at"}},{title:"操作",dataIndex:"action",key:"action",scopedSlots:{customRender:"action"}}],Y=["MySQL","TiDB","ClickHouse"],K={components:{DBConfigsAddComponent:A,DBConfigsEditComponent:j},data:function(){return{loading:!1,tableColumns:H,tableData:[],environments:[],organizations:[],dbTypes:Y,pagination:{current:1,pageSize:10,total:0,pageSizeOptions:["10","20"],showSizeChanger:!0},form:this.$form.createForm(this,{name:"dbconfig"})}},methods:{getEnvironments:function(){var e=this;return(0,c.Z)((0,l.Z)().mark((function t(){var a;return(0,l.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,h({is_page:!1});case 3:a=t.sent,e.environments=a.data,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),e.$message.error("Failed to fetch environments:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},getOrganizations:function(){var e=this;return(0,c.Z)((0,l.Z)().mark((function t(){var a;return(0,l.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,w.xY)({is_page:!1});case 3:a=t.sent,e.organizations=a.data,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),e.$message.error("Failed to fetch organizations:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},getDBConfig:function(){var e=this;this.loading=!0;var t=(0,s.Z)({page_size:this.pagination.pageSize,page:this.pagination.current,is_page:!0},this.filters);d(t).then((function(t){"0000"===t.code?(e.pagination.total=t.total,e.tableData=t.data):e.$message.error(t.message)})).catch((function(e){})).finally((function(){e.loading=!1}))},editRow:function(e){this.$refs.DBConfigsEditComponent.showModal(e)},onAdd:function(){this.$refs.DBConfigsAddComponent.showModal()},DeleteConfirm:function(e){var t=this;this.$confirm({title:"警告",content:"你确定删除？",okText:"Yes",okType:"danger",cancelText:"No",onOk:function(){f(e).then((function(e){"0001"===e.code?t.$message.warning(e.message):t.$message.info(e.message)})).catch((function(e){})).finally((function(){t.getDBConfig()}))},onCancel:function(){}})},handleTableChange:function(e){this.pagination.current=e.current,this.pagination.pageSize=e.pageSize,this.getDBConfig()},handleSearch:function(e){var t=this;e.preventDefault(),this.form.validateFields((function(e,a){e||(t.filters={environment:a["environment"],db_type:a["db_type"],search:a["search"]},t.pagination.current=1,t.getDBConfig())}))}},mounted:function(){this.getDBConfig(),this.getEnvironments(),this.getOrganizations()}},U=K,X=(0,q.Z)(U,I,$,!1,null,"6b8e840e",null),W=X.exports,ee=function(){var e=this,t=e._self._c;return t("a-card",[t("a-form",{attrs:{layout:"inline",form:e.form},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}}},[t("a-form-item",[t("a-input-search",{directives:[{name:"decorator",rawName:"v-decorator",value:["search"],expression:"['search']"}],staticStyle:{width:"300px"},attrs:{allowClear:"",placeholder:"输入要查询内容"}})],1),t("a-form-item",[t("span",{staticClass:"table-page-search-submitButtons"},[t("a-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")])],1)]),t("a-form-item",{staticStyle:{float:"right","margin-right":"0px"}},[t("a-button",{attrs:{type:"primary"},on:{click:e.onAdd}},[t("a-icon",{attrs:{type:"plus"}}),e._v("新增")],1)],1)],1),t("a-table",{attrs:{columns:e.tableColumns,rowKey:function(e,t){return t},dataSource:e.tableData,pagination:e.pagination,loading:e.loading,size:"middle"},on:{change:e.handleTableChange},scopedSlots:e._u([{key:"action",fn:function(a,n){return t("span",{},[t("div",{staticClass:"editable-row-operations"},[t("a",{on:{click:function(){return e.editRow(n)}}},[t("span",{staticStyle:{color:"#409eff"}},[e._v("编辑")])]),t("a-divider",{attrs:{type:"vertical"}}),t("a",{attrs:{type:"dashed"},on:{click:function(t){return e.DeleteConfirm(n.id)}}},[t("span",{staticStyle:{color:"#409eff"}},[e._v("删除")])])],1)])}}])}),t("EnvironmentsAddComponent",{ref:"EnvironmentsAddComponent",on:{refreshTable:e.getEnvironments}}),t("EnvironmentsEditComponent",{ref:"EnvironmentsEditComponent",on:{refreshTable:e.getEnvironments}})],1)},te=[],ae=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"新增环境",width:"40%","on-ok":"onSubmit"},on:{cancel:e.handleCancel},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("template",{slot:"footer"},[t("a-button",{key:"back",on:{click:e.handleCancel}},[e._v("取消")]),t("a-button",{key:"submit",attrs:{type:"primary",loading:e.loading},on:{click:e.onSubmit}},[e._v("确定")])],1),t("a-form",{attrs:{form:e.form,"label-col":{span:4},"wrapper-col":{span:18}}},[t("a-form-item",{attrs:{label:"环境","has-feedback":""}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,min:3,max:128,message:"请输入环境名"}],validateTrigger:"blur"}],expression:"[\n          'name',\n          {\n            rules: [{ required: true, min: 3, max: 128, message: '请输入环境名' }],\n            validateTrigger: 'blur',\n          },\n        ]"}]})],1)],1)],2)},ne=[],re={data:function(){return{visible:!1,loading:!1,form:this.$form.createForm(this,{name:"systemEnvironmentAdd"})}},methods:{showModal:function(){this.form.resetFields(),this.visible=!0},handleCancel:function(e){this.visible=!1},createEnvironments:function(e){var t=this;v(e).then((function(e){var a="0000"===e.code?"info":"error";t.$message[a](e.message)})).catch((function(e){})).finally((function(){t.visible=!1,t.loading=!1,t.$emit("refreshTable")}))},onSubmit:function(e){var t=this;this.loading=!0,e.preventDefault(),this.form.validateFields((function(e,a){e||t.createEnvironments(a)})),this.loading=!1}}},ie=re,oe=(0,q.Z)(ie,ae,ne,!1,null,null,null),se=oe.exports,le=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"编辑角色",width:"55%","on-ok":"onSubmit"},on:{cancel:e.handleCancel},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("template",{slot:"footer"},[t("a-button",{key:"back",on:{click:e.handleCancel}},[e._v("取消")]),t("a-button",{key:"submit",attrs:{type:"primary",loading:e.loading},on:{click:e.onSubmit}},[e._v("确定")])],1),t("a-form",{attrs:{form:e.form,"label-col":{span:4},"wrapper-col":{span:18}}},[t("a-form-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{label:"ID"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["id"],expression:"['id']"}]})],1),t("a-form-item",{attrs:{label:"环境","has-feedback":""}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,min:3,max:128,message:"请输入环境名"}],validateTrigger:"blur"}],expression:"[\n          'name',\n          {\n            rules: [{ required: true, min: 3, max: 128, message: '请输入环境名' }],\n            validateTrigger: 'blur',\n          },\n        ]"}]})],1)],1)],2)},ce=[],ue={data:function(){return{visible:!1,loading:!1,form:this.$form.createForm(this,{name:"systemEnvironmentEdit"})}},methods:{showModal:function(e){var t=this;this.form.resetFields(),this.$nextTick((function(){setTimeout((function(){var a={id:e.id,name:e.name};t.form.setFieldsValue(a)}))})),this.visible=!0},handleCancel:function(e){this.visible=!1},updateEnvironments:function(e){var t=this;g(e).then((function(e){var a="0000"===e.code?"info":"error";t.$message[a](e.message)})).catch((function(e){})).finally((function(){t.visible=!1,t.loading=!1,t.$emit("refreshTable")}))},onSubmit:function(e){var t=this;this.loading=!0,e.preventDefault(),this.form.validateFields((function(e,a){e||("string"===typeof a["port"]&&(a["port"]=parseInt(a["port"])),t.updateEnvironments(a))})),this.loading=!1}}},de=ue,me=(0,q.Z)(de,le,ce,!1,null,null,null),pe=me.exports,fe=[{title:"环境",dataIndex:"name",key:"name",scopedSlots:{customRender:"name"}},{title:"创建时间",dataIndex:"created_at",key:"created_at",scopedSlots:{customRender:"created_at"}},{title:"更新时间",dataIndex:"updated_at",key:"updated_at",scopedSlots:{customRender:"updated_at"}},{title:"操作",dataIndex:"action",key:"action",scopedSlots:{customRender:"action"}}],he={components:{EnvironmentsAddComponent:se,EnvironmentsEditComponent:pe},data:function(){return{loading:!1,tableColumns:fe,tableData:[],pagination:{current:1,pageSize:10,total:0,pageSizeOptions:["10","20"],showSizeChanger:!0},form:this.$form.createForm(this,{name:"environment"})}},methods:{getEnvironments:function(){var e=this;this.loading=!0;var t=(0,s.Z)({page_size:this.pagination.pageSize,page:this.pagination.current,is_page:!0},this.filters);h(t).then((function(t){"0000"===t.code?(e.pagination.total=t.total,e.tableData=t.data):e.$message.error(t.message)})).catch((function(e){})).finally((function(){e.loading=!1}))},editRow:function(e){this.$refs.EnvironmentsEditComponent.showModal(e)},onAdd:function(){this.$refs.EnvironmentsAddComponent.showModal()},DeleteConfirm:function(e){var t=this;this.$confirm({title:"警告",content:"你确定删除？",okText:"Yes",okType:"danger",cancelText:"No",onOk:function(){b(e).then((function(e){"0001"===e.code?t.$message.warning(e.message):t.$message.info(e.message)})).catch((function(e){})).finally((function(){t.getEnvironments()}))},onCancel:function(){}})},handleTableChange:function(e){this.pagination.current=e.current,this.pagination.pageSize=e.pageSize,this.getEnvironments()},handleSearch:function(e){var t=this;e.preventDefault(),this.form.validateFields((function(e,a){e||(t.filters={search:a["search"]},t.pagination.current=1,t.getEnvironments())}))}},mounted:function(){this.getEnvironments()}},ve=he,ge=(0,q.Z)(ve,ee,te,!1,null,"7a45bdc0",null),be=ge.exports,ye=function(){var e=this,t=e._self._c;return t("a-card",[t("a-alert",{attrs:{message:"全局审核参数配置，作用于全部数据库实例的语法审核。优先级：数据库实例级别审核参数 > 全局审核参数。如您需要个性化定制实例级别审核参数，请在「数据库实例配置」里面进行调整。",type:"success"}}),t("a-form",{attrs:{layout:"inline",form:e.form},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}}},[t("a-form-item",[t("a-input-search",{directives:[{name:"decorator",rawName:"v-decorator",value:["search"],expression:"['search']"}],staticStyle:{width:"250px"},attrs:{allowClear:"",placeholder:"输入要查询内容"}})],1),t("a-form-item",[t("span",{staticClass:"table-page-search-submitButtons"},[t("a-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")])],1)])],1),t("a-table",{attrs:{columns:e.tableColumns,rowKey:function(e,t){return t},dataSource:e.tableData,pagination:e.pagination,loading:e.loading,size:"middle"},on:{change:e.handleTableChange},scopedSlots:e._u([{key:"action",fn:function(a,n){return t("span",{},[t("div",{staticClass:"editable-row-operations"},[t("a",{on:{click:function(){return e.editRow(n)}}},[t("span",{staticStyle:{color:"#409eff"}},[e._v("编辑")])])])])}},{key:"expandedRowRender",fn:function(a){return t("span",{},[t("pre",[e._v(e._s(JSON.stringify(a.params,null,2)))])])}}])}),t("InspectEditComponent",{ref:"InspectEditComponent",on:{refreshTable:e.GetInspectParams}})],1)},_e=[],ke=function(e){return u.ZP.request({url:"/api/v1/admin/inspect/params",method:"get",params:e})},we=function(e){return u.ZP.request({url:"/api/v1/admin/inspect/params/".concat(e.id),method:"put",data:e})},xe=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"编辑审核参数",width:"55%","on-ok":"onSubmit"},on:{cancel:e.handleCancel},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("template",{slot:"footer"},[t("a-button",{key:"back",on:{click:e.handleCancel}},[e._v("取消")]),t("a-button",{key:"submit",attrs:{type:"primary",loading:e.loading},on:{click:e.onSubmit}},[e._v("确定")])],1),t("a-form",{attrs:{form:e.form,"label-col":{span:4},"wrapper-col":{span:18}}},[t("a-form-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{label:"ID"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["id"],expression:"['id']"}]})],1),t("a-form-item",{attrs:{label:"审核参数",help:"格式要求为JSON类型，禁止修改KEY，可修改Value！！！","has-feedback":""}},[t("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["params",{initialValue:"{}",rules:[{required:!0,message:"请输入自定义审核参数，默认为{}",validator:e.validatorInspectParams}]}],expression:"[\n        'params',\n        {\n          initialValue: '{}',\n          rules: [\n            {\n              required: true,\n              message: '请输入自定义审核参数，默认为{}',\n              validator: validatorInspectParams,\n            },\n          ],\n        },\n      ]"}],attrs:{"auto-size":{minRows:3,maxRows:5},placeholder:"请输入自定义审核参数，默认为{}"}})],1),t("a-form-item",{attrs:{label:"备注",help:"非必要不要修改","has-feedback":""}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["remark",{rules:[{required:!0,min:3,max:256,message:"请输入备注"}],validateTrigger:"blur"}],expression:"[\n          'remark',\n          {\n            rules: [{ required: true, min: 3, max: 256, message: '请输入备注' }],\n            validateTrigger: 'blur',\n          },\n        ]"}]})],1)],1)],2)},Se=[],Ce={data:function(){return{visible:!1,loading:!1,form:this.$form.createForm(this,{name:"inspectEdit"}),validatorInspectParams:function(e,t,a){try{JSON.parse(t)}catch(n){return a("请输入正确的JSON格式")}a()}}},methods:{showModal:function(e){var t=this;this.form.resetFields(),this.$nextTick((function(){setTimeout((function(){var a={id:e.id,params:JSON.stringify(e.params),remark:e.remark};t.form.setFieldsValue(a)}))})),this.visible=!0},handleCancel:function(e){this.visible=!1},UpdateInspectParams:function(e){var t=this;we(e).then((function(e){var a="0000"===e.code?"info":"error";t.$message[a](e.message)})).catch((function(e){})).finally((function(){t.visible=!1,t.loading=!1,t.$emit("refreshTable")}))},onSubmit:function(e){var t=this;this.loading=!0,e.preventDefault(),this.form.validateFields((function(e,a){e||(a["params"]=JSON.parse(a["params"]),t.UpdateInspectParams(a))})),this.loading=!1}}},qe=Ce,Ze=(0,q.Z)(qe,xe,Se,!1,null,null,null),Ee=Ze.exports,Te=[{title:"备注",dataIndex:"remark",key:"remark",scopedSlots:{customRender:"remark"}},{title:"更新时间",dataIndex:"updated_at",key:"updated_at",scopedSlots:{customRender:"updated_at"}},{title:"操作",dataIndex:"action",key:"action",scopedSlots:{customRender:"action"}}],Ne={components:{InspectEditComponent:Ee},data:function(){return{loading:!1,tableColumns:Te,tableData:[],pagination:{current:1,pageSize:10,total:0,pageSizeOptions:["10","20"],showSizeChanger:!0},form:this.$form.createForm(this,{name:"inspect"})}},methods:{GetInspectParams:function(){var e=this;this.loading=!0;var t=(0,s.Z)({page_size:this.pagination.pageSize,page:this.pagination.current,is_page:!0},this.filters);ke(t).then((function(t){"0000"===t.code?(e.pagination.total=t.total,e.tableData=t.data):e.$message.error(t.message)})).catch((function(e){})).finally((function(){e.loading=!1}))},editRow:function(e){this.$refs.InspectEditComponent.showModal(e)},handleTableChange:function(e){this.pagination.current=e.current,this.pagination.pageSize=e.pageSize,this.GetInspectParams()},handleSearch:function(e){var t=this;e.preventDefault(),this.form.validateFields((function(e,a){e||(t.filters={environment:a["environment"],db_type:a["db_type"],search:a["search"]},t.pagination.current=1,t.GetInspectParams())}))}},mounted:function(){this.GetInspectParams()}},Pe=Ne,ze=(0,q.Z)(Pe,ye,_e,!1,null,"6a87eef2",null),De=ze.exports,Ie={components:{DBConfigsComponent:W,InspectComponent:De,SystemEnvironmentsComponent:be,DasComponent:D}},$e=Ie,Fe=(0,q.Z)($e,n,r,!1,null,"28bfbf42",null),Oe=Fe.exports},86325:function(e,t,a){a.d(t,{AK:function(){return b},E0:function(){return y},Fh:function(){return g},Fx:function(){return l},HX:function(){return x},NA:function(){return h},OR:function(){return c},Q4:function(){return S},TH:function(){return v},a5:function(){return _},dN:function(){return k},g2:function(){return p},gg:function(){return r},h7:function(){return d},rK:function(){return s},s1:function(){return u},sk:function(){return w},tv:function(){return i},ty:function(){return m},v_:function(){return f},zv:function(){return o}});var n=a(34820),r=function(e){return n.ZP.request({url:"/api/v1/das/schemas",method:"get",params:e})},i=function(e){return n.ZP.request({url:"/api/v1/das/tables",method:"get",params:e})},o=function(e){return n.ZP.request({url:"/api/v1/das/execute/query/mysql",method:"post",data:e})},s=function(e){return n.ZP.request({url:"/api/v1/das/execute/query/clickhouse",method:"post",data:e})},l=function(e){return n.ZP.request({url:"/api/v1/das/user/grants",method:"get",params:e})},c=function(e){return n.ZP.request({url:"/api/v1/das/dbdict",method:"get",params:e})},u=function(e){return n.ZP.request({url:"/api/v1/das/history",method:"get",params:e})},d=function(e){return n.ZP.request({url:"/api/v1/das/favorites",method:"get",params:e})},m=function(e){return n.ZP.request({url:"/api/v1/das/favorites",method:"post",data:e})},p=function(e){return n.ZP.request({url:"/api/v1/das/favorites/".concat(e.id),method:"put",data:e})},f=function(e){return n.ZP.request({url:"/api/v1/das/favorites/".concat(e),method:"delete",data:e})},h=function(e){return n.ZP.request({url:"/api/v1/das/table-info",method:"get",params:e})},v=function(e){return n.ZP.request({url:"/api/v1/das/admin/schemas/grant",method:"get",params:e})},g=function(e){return n.ZP.request({url:"/api/v1/das/admin/schemas/grant",method:"post",data:e})},b=function(e){return n.ZP.request({url:"/api/v1/das/admin/schemas/grant/".concat(e),method:"delete",data:e})},y=function(e){return n.ZP.request({url:"/api/v1/das/admin/tables/grant",method:"get",params:e})},_=function(e){return n.ZP.request({url:"/api/v1/das/admin/tables/grant",method:"post",data:e})},k=function(e){return n.ZP.request({url:"/api/v1/das/admin/tables/grant/".concat(e),method:"delete",data:e})},w=function(e){return n.ZP.request({url:"/api/v1/das/admin/instances/list",method:"get",params:e})},x=function(e){return n.ZP.request({url:"/api/v1/das/admin/schemas/list",method:"get",params:e})},S=function(e){return n.ZP.request({url:"/api/v1/das/admin/tables/list",method:"get",params:e})}},94688:function(e,t,a){a.d(t,{BQ:function(){return b},DA:function(){return i},EP:function(){return f},G_:function(){return c},Ly:function(){return g},M6:function(){return o},MF:function(){return _},P4:function(){return d},QQ:function(){return v},X7:function(){return l},ZS:function(){return u},ie:function(){return m},mN:function(){return s},nk:function(){return y},vp:function(){return h},xE:function(){return r},xY:function(){return p}});var n=a(34820),r=function(e){return n.ZP.request({url:"/api/v1/admin/users",method:"get",params:e})},i=function(e){return n.ZP.request({url:"/api/v1/admin/users",method:"post",data:e})},o=function(e){return n.ZP.request({url:"/api/v1/admin/users/".concat(e.uid),method:"put",data:e})},s=function(e){return n.ZP.request({url:"/api/v1/admin/users/".concat(e),method:"delete",data:e})},l=function(e){return n.ZP.request({url:"/api/v1/admin/users/change/password",method:"post",data:e})},c=function(e){return n.ZP.request({url:"/api/v1/admin/roles",method:"get",params:e})},u=function(e){return n.ZP.request({url:"/api/v1/admin/roles",method:"post",data:e})},d=function(e){return n.ZP.request({url:"/api/v1/admin/roles/".concat(e.id),method:"put",data:e})},m=function(e){return n.ZP.request({url:"/api/v1/admin/roles/".concat(e),method:"delete",data:e})},p=function(e){return n.ZP.request({url:"/api/v1/admin/organizations",method:"get",params:e})},f=function(e){return n.ZP.request({url:"/api/v1/admin/organizations/root-node",method:"post",data:e})},h=function(e){return n.ZP.request({url:"/api/v1/admin/organizations/child-node",method:"post",data:e})},v=function(e){return n.ZP.request({url:"/api/v1/admin/organizations",method:"put",data:e})},g=function(e){return n.ZP.request({url:"/api/v1/admin/organizations",method:"delete",data:e})},b=function(e){return n.ZP.request({url:"/api/v1/admin/organizations/users",method:"get",params:e})},y=function(e){return n.ZP.request({url:"/api/v1/admin/organizations/users",method:"post",data:e})},_=function(e){return n.ZP.request({url:"/api/v1/admin/organizations/users",method:"delete",data:e})}},37255:function(e,t,a){a.d(t,{Z:function(){return r}});a(41539);function n(e,t,a,n,r,i,o){try{var s=e[i](o),l=s.value}catch(c){return void a(c)}s.done?t(l):Promise.resolve(l).then(n,r)}function r(e){return function(){var t=this,a=arguments;return new Promise((function(r,i){var o=e.apply(t,a);function s(e){n(o,r,i,s,l,"next",e)}function l(e){n(o,r,i,s,l,"throw",e)}s(void 0)}))}}},83941:function(e,t,a){a.d(t,{Z:function(){return r}});a(82526),a(41817),a(41539),a(32165),a(78783),a(33948),a(72443),a(39341),a(73706),a(10408),a(30489),a(54747),a(68309),a(68304),a(47042);var n=a(67555);function r(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
r=function(){return t};var e,t={},a=Object.prototype,i=a.hasOwnProperty,o=Object.defineProperty||function(e,t,a){e[t]=a.value},s="function"==typeof Symbol?Symbol:{},l=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function d(e,t,a){return Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(e){d=function(e,t,a){return e[t]=a}}function m(e,t,a,n){var r=t&&t.prototype instanceof y?t:y,i=Object.create(r.prototype),s=new z(n||[]);return o(i,"_invoke",{value:E(e,a,s)}),i}function p(e,t,a){try{return{type:"normal",arg:e.call(t,a)}}catch(e){return{type:"throw",arg:e}}}t.wrap=m;var f="suspendedStart",h="suspendedYield",v="executing",g="completed",b={};function y(){}function _(){}function k(){}var w={};d(w,l,(function(){return this}));var x=Object.getPrototypeOf,S=x&&x(x(D([])));S&&S!==a&&i.call(S,l)&&(w=S);var C=k.prototype=y.prototype=Object.create(w);function q(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function Z(e,t){function a(r,o,s,l){var c=p(e[r],e,o);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==(0,n.Z)(d)&&i.call(d,"__await")?t.resolve(d.__await).then((function(e){a("next",e,s,l)}),(function(e){a("throw",e,s,l)})):t.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return a("throw",e,s,l)}))}l(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,r){a(e,n,t,r)}))}return r=r?r.then(i,i):i()}})}function E(t,a,n){var r=f;return function(i,o){if(r===v)throw new Error("Generator is already running");if(r===g){if("throw"===i)throw o;return{value:e,done:!0}}for(n.method=i,n.arg=o;;){var s=n.delegate;if(s){var l=T(s,n);if(l){if(l===b)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===f)throw r=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=v;var c=p(t,a,n);if("normal"===c.type){if(r=n.done?g:h,c.arg===b)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=g,n.method="throw",n.arg=c.arg)}}}function T(t,a){var n=a.method,r=t.iterator[n];if(r===e)return a.delegate=null,"throw"===n&&t.iterator["return"]&&(a.method="return",a.arg=e,T(t,a),"throw"===a.method)||"return"!==n&&(a.method="throw",a.arg=new TypeError("The iterator does not provide a '"+n+"' method")),b;var i=p(r,t.iterator,a.arg);if("throw"===i.type)return a.method="throw",a.arg=i.arg,a.delegate=null,b;var o=i.arg;return o?o.done?(a[t.resultName]=o.value,a.next=t.nextLoc,"return"!==a.method&&(a.method="next",a.arg=e),a.delegate=null,b):o:(a.method="throw",a.arg=new TypeError("iterator result is not an object"),a.delegate=null,b)}function N(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function z(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(N,this),this.reset(!0)}function D(t){if(t||""===t){var a=t[l];if(a)return a.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function a(){for(;++r<t.length;)if(i.call(t,r))return a.value=t[r],a.done=!1,a;return a.value=e,a.done=!0,a};return o.next=o}}throw new TypeError((0,n.Z)(t)+" is not iterable")}return _.prototype=k,o(C,"constructor",{value:k,configurable:!0}),o(k,"constructor",{value:_,configurable:!0}),_.displayName=d(k,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===_||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,k):(e.__proto__=k,d(e,u,"GeneratorFunction")),e.prototype=Object.create(C),e},t.awrap=function(e){return{__await:e}},q(Z.prototype),d(Z.prototype,c,(function(){return this})),t.AsyncIterator=Z,t.async=function(e,a,n,r,i){void 0===i&&(i=Promise);var o=new Z(m(e,a,n,r),i);return t.isGeneratorFunction(a)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},q(C),d(C,u,"Generator"),d(C,l,(function(){return this})),d(C,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),a=[];for(var n in t)a.push(n);return a.reverse(),function e(){for(;a.length;){var n=a.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,z.prototype={constructor:z,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var a in this)"t"===a.charAt(0)&&i.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var a=this;function n(n,r){return s.type="throw",s.arg=t,a.next=n,r&&(a.method="next",a.arg=e),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],s=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var l=i.call(o,"catchLoc"),c=i.call(o,"finallyLoc");if(l&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var a=this.tryEntries.length-1;a>=0;--a){var n=this.tryEntries[a];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var r=n;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=e,o.arg=t,r?(this.method="next",this.next=r.finallyLoc,b):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var a=this.tryEntries[t];if(a.finallyLoc===e)return this.complete(a.completion,a.afterLoc),P(a),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var a=this.tryEntries[t];if(a.tryLoc===e){var n=a.completion;if("throw"===n.type){var r=n.arg;P(a)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,a,n){return this.delegate={iterator:D(t),resultName:a,nextLoc:n},"next"===this.method&&(this.arg=e),b}},t}}}]);