"use strict";(self["webpackChunkvue_antd_pro"]=self["webpackChunkvue_antd_pro"]||[]).push([[335],{60335:function(e,t,n){n.r(t),n.d(t,{default:function(){return Oe}});var a=function(){var e=this,t=e._self._c;return t("a-card",[t("a-tabs",{attrs:{type:"card",size:"small"}},[t("a-tab-pane",{key:"1",attrs:{tab:"系统环境配置"}},[t("SystemEnvironmentsComponent")],1),t("a-tab-pane",{key:"2",attrs:{tab:"审核参数配置"}},[t("InspectComponent")],1),t("a-tab-pane",{key:"3",attrs:{tab:"数据库实例配置"}},[t("DBConfigsComponent")],1),t("a-tab-pane",{key:"4",attrs:{tab:"数据查询权限配置"}},[t("DasComponent")],1)],1)],1)},r=[],i=(n(68309),function(){var e=this,t=e._self._c;return t("a-card",[t("a-form",{attrs:{layout:"inline",form:e.form},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}}},[t("a-form-item",[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["environment"],expression:"['environment']"}],staticStyle:{width:"200px"},attrs:{allowClear:"",placeholder:"请选择环境","show-search":""}},e._l(e.environments,(function(n,a){return t("a-select-option",{key:a,attrs:{label:n.name,value:n.name}},[e._v(" "+e._s(n.name)+" ")])})),1)],1),t("a-form-item",[t("a-input-search",{directives:[{name:"decorator",rawName:"v-decorator",value:["search"],expression:"['search']"}],staticStyle:{width:"300px"},attrs:{allowClear:"",placeholder:"输入要查询内容"}})],1),t("a-form-item",[t("span",{staticClass:"table-page-search-submitButtons"},[t("a-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")])],1)]),t("a-form-item",{staticStyle:{float:"right","margin-right":"0px"}},[t("a-button",{attrs:{type:"primary"},on:{click:e.onAdd}},[t("a-icon",{attrs:{type:"plus"}}),e._v("新增")],1)],1)],1),t("a-table",{attrs:{columns:e.tableColumns,rowKey:function(e,t){return t},dataSource:e.tableData,pagination:e.pagination,loading:e.loading,size:"middle"},on:{change:e.handleTableChange},scopedSlots:e._u([{key:"schema",fn:function(n,a){return t("span",{},[t("router-link",{attrs:{to:{name:"view.admin.systemManage.das.detail",params:{username:a.username,schema:a.schema,instance_id:a.instance_id}}}},[e._v(e._s(n))])],1)}},{key:"hostname",fn:function(n,a){return t("span",{},[e._v(" "+e._s(n)+":"+e._s(a.port)+" ")])}},{key:"action",fn:function(n,a){return t("span",{},[t("div",{staticClass:"editable-row-operations"},[t("a",{attrs:{type:"dashed"},on:{click:function(t){return e.DeleteConfirm(a.id)}}},[t("span",{staticStyle:{color:"#409eff"}},[e._v("删除")])])])])}}])}),t("DasAddComponent",{ref:"DasAddComponent",on:{refreshTable:e.getAdminGrants}})],1)}),o=[],s=n(23711),l=n(83941),c=n(37255),u=(n(41539),n(74916),n(64765),n(34820)),d=function(e){return u.ZP.request({url:"/api/v1/admin/dbconfig",method:"get",params:e})},m=function(e){return u.ZP.request({url:"/api/v1/admin/dbconfig",method:"post",data:e})},p=function(e){return u.ZP.request({url:"/api/v1/admin/dbconfig/".concat(e.id),method:"put",data:e})},f=function(e){return u.ZP.request({url:"/api/v1/admin/dbconfig/".concat(e),method:"delete",data:e})},h=function(e){return u.ZP.request({url:"/api/v1/admin/environment",method:"get",params:e})},v=function(e){return u.ZP.request({url:"/api/v1/admin/environment",method:"post",data:e})},g=function(e){return u.ZP.request({url:"/api/v1/admin/environment/".concat(e.id),method:"put",data:e})},b=function(e){return u.ZP.request({url:"/api/v1/admin/environment/".concat(e),method:"delete",data:e})},y=n(86325),_=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"新增数据库访问权限",width:"55%","on-ok":"onSubmit"},on:{cancel:e.handleCancel},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("template",{slot:"footer"},[t("a-button",{key:"back",on:{click:e.handleCancel}},[e._v("取消")]),t("a-button",{key:"submit",attrs:{type:"primary",loading:e.loading},on:{click:e.onSubmit}},[e._v("确定")])],1),t("a-form",{attrs:{form:e.form,"label-col":{span:4},"wrapper-col":{span:18}}},[t("a-form-item",{attrs:{label:"用户",help:"需要开通访问权限的用户","has-feedback":""}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["username",{rules:[{required:!0,message:"请选择用户"}]}],expression:"['username', { rules: [{ required: true, message: '请选择用户' }] }]"}],attrs:{placeholder:"请选择用户",allowClear:"","show-search":""}},e._l(e.users,(function(n,a){return t("a-select-option",{key:a,attrs:{label:n.username,value:n.username}},[e._v(" "+e._s(n.username)+" "),t("strong",[e._v(e._s(n.nick_name))])])})),1)],1),t("a-form-item",{attrs:{label:"DB类型","has-feedback":""}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["db_type",{initialValue:"MySQL",rules:[{required:!0,message:"请选择DB类型"}]}],expression:"['db_type', { initialValue: 'MySQL', rules: [{ required: true, message: '请选择DB类型' }] }]"}],attrs:{placeholder:"请选择DB类型",allowClear:"","show-search":""},on:{change:e.changeDBType}},e._l(e.dbTypes,(function(n,a){return t("a-select-option",{key:a,attrs:{label:n,value:n}},[e._v(" "+e._s(n)+" ")])})),1)],1),t("a-form-item",{attrs:{label:"环境","has-feedback":""}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["environment",{rules:[{required:!0,message:"请选择工单环境"}]}],expression:"['environment', { rules: [{ required: true, message: '请选择工单环境' }] }]"}],attrs:{placeholder:"请选择工单环境",allowClear:"","show-search":""},on:{change:e.changeEnvs}},e._l(e.environments,(function(n,a){return t("a-select-option",{key:a,attrs:{label:n.name,value:n.id}},[e._v(" "+e._s(n.name)+" ")])})),1)],1),t("a-form-item",{attrs:{label:"实例","has-feedback":""}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["instance_id",{rules:[{required:!0,message:"请选择数据库实例"}]}],expression:"['instance_id', { rules: [{ required: true, message: '请选择数据库实例' }] }]"}],attrs:{placeholder:"请选择数据库实例",allowClear:"","show-search":""},on:{change:e.changeIns}},e._l(e.instances,(function(n,a){return t("a-select-option",{key:a,attrs:{label:n.remark,value:n.instance_id}},[e._v(" "+e._s(n.remark)+" ")])})),1)],1),t("a-form-item",{attrs:{label:"库名",help:"需要开通访问权限的库名","has-feedback":""}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["schema",{rules:[{required:!0,message:"请选择数据库"}]}],expression:"['schema', { rules: [{ required: true, message: '请选择数据库' }] }]"}],attrs:{placeholder:"请选择数据库",allowClear:"","show-search":""},on:{change:e.getTables}},e._l(e.schemas,(function(n,a){return t("a-select-option",{key:a,attrs:{label:n.schema,value:n.schema}},[e._v(" "+e._s(n.schema)+" ")])})),1)],1),t("a-form-item",{attrs:{label:"表名",help:"需要开通访问权限的表，可不选。不选，默认开通当前库的访问权限；选择指定的表，仅开通当前库指定表的访问权限","has-feedback":""}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["tables",{rules:[{required:!1,message:"请选择表名"}]}],expression:"['tables', { rules: [{ required: false, message: '请选择表名' }] }]"}],attrs:{placeholder:"请选择表名",allowClear:"",mode:"multiple","show-search":""}},e._l(e.tables,(function(n,a){return t("a-select-option",{key:a,attrs:{label:n,value:n}},[e._v(" "+e._s(n)+" ")])})),1)],1)],1)],2)},k=[],w=(n(54747),n(94688)),x=["MySQL","TiDB","ClickHouse"],S={data:function(){return{visible:!1,loading:!1,users:[],environments:[],instances:[],schemas:[],tables:[],dbTypes:x,form:this.$form.createForm(this,{name:"dasAdd"})}},methods:{showModal:function(){this.form.resetFields(),this.visible=!0},handleCancel:function(e){this.visible=!1},getUsers:function(){var e=this;(0,w.xE)({is_page:!1}).then((function(t){e.users=t.data})).catch((function(e){}))},getEnvironments:function(){var e=this;return(0,c.Z)((0,l.Z)().mark((function t(){var n;return(0,l.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,h({is_page:!1});case 3:n=t.sent,e.environments=n.data,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),e.$message.error("Failed to fetch environments:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},changeDBType:function(){this.form.resetFields(["environment","instance_id","schema"])},changeEnvs:function(e){var t=this;this.form.resetFields(["instance_id","schema"]);var n={id:e,db_type:this.form.getFieldValue("db_type"),is_page:!1};(0,y.sk)(n).then((function(e){t.instances=e.data})).catch((function(e){}))},changeIns:function(e){var t=this;this.form.resetFields(["schema"]);var n={instance_id:e,is_page:!1};(0,y.HX)(n).then((function(e){t.schemas=e.data})).catch((function(e){}))},getTables:function(e){var t=this;this.form.resetFields(["tables"]);var n={instance_id:this.form.getFieldValue("instance_id"),schema:e};(0,y.Q4)(n).then((function(e){if("0001"===e.code)return t.$notification.error({title:"加载表失败，请稍后重试",message:e.message}),!1;e.data.forEach((function(e){t.tables.push(e.table_name)}))})).catch((function(e){}))},createAdminGrants:function(e){var t=this;(0,y.Fh)(e).then((function(e){var n="0000"===e.code?"info":"error";t.$message[n](e.message)})).catch((function(e){})).finally((function(){t.handleCancel(),t.$emit("refreshTable")}))},onSubmit:function(e){var t=this;this.loading=!0,e.preventDefault(),this.form.validateFields((function(e,n){e||("string"===typeof n["port"]&&(n["port"]=parseInt(n["port"])),t.createAdminGrants(n))})),this.loading=!1}},mounted:function(){this.getUsers(),this.getEnvironments()}},C=S,q=n(1001),Z=(0,q.Z)(C,_,k,!1,null,null,null),E=Z.exports,P=[{title:"用户名",dataIndex:"username",key:"username",scopedSlots:{customRender:"username"}},{title:"库名",dataIndex:"schema",key:"schema",scopedSlots:{customRender:"schema"}},{title:"环境",dataIndex:"environment",key:"environment",scopedSlots:{customRender:"environment"}},{title:"类型",dataIndex:"db_type",key:"db_type",scopedSlots:{customRender:"db_type"}},{title:"实例ID",dataIndex:"instance_id",key:"instance_id",scopedSlots:{customRender:"instance_id"}},{title:"主机",dataIndex:"hostname",key:"hostname",scopedSlots:{customRender:"hostname"}},{title:"备注",dataIndex:"remark",key:"remark",scopedSlots:{customRender:"remark"}},{title:"更新时间",dataIndex:"updated_at",key:"updated_at",scopedSlots:{customRender:"updated_at"}},{title:"操作",dataIndex:"action",key:"action",scopedSlots:{customRender:"action"}}],T={components:{DasAddComponent:E},data:function(){return{loading:!1,environments:[],tableColumns:P,tableData:[],pagination:{current:1,pageSize:10,total:0,pageSizeOptions:["10","20"],showSizeChanger:!0},form:this.$form.createForm(this,{name:"das"})}},methods:{getEnvironments:function(){var e=this;return(0,c.Z)((0,l.Z)().mark((function t(){var n;return(0,l.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,h({is_page:!1});case 3:n=t.sent,e.environments=n.data,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),e.$message.error("Failed to fetch environments:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},getAdminGrants:function(){var e=this;this.loading=!0;var t=(0,s.Z)({page_size:this.pagination.pageSize,page:this.pagination.current,is_page:!0},this.filters);(0,y.TH)(t).then((function(t){"0000"===t.code?(e.pagination.total=t.total,e.tableData=t.data):e.$message.error(t.message)})).catch((function(e){})).finally((function(){e.loading=!1}))},onAdd:function(){this.$refs.DasAddComponent.showModal()},DeleteConfirm:function(e){var t=this;this.$confirm({title:"警告",content:"你确定删除？这将会删除当前的库表权限！！！",okText:"Yes",okType:"danger",cancelText:"No",onOk:function(){(0,y.AK)(e).then((function(e){"0001"===e.code?t.$message.warning(e.message):t.$message.info(e.message)})).catch((function(e){})).finally((function(){t.getAdminGrants()}))},onCancel:function(){}})},handleTableChange:function(e){this.pagination.current=e.current,this.pagination.pageSize=e.pageSize,this.getAdminGrants()},handleSearch:function(e){var t=this;e.preventDefault(),this.form.validateFields((function(e,n){e||(t.filters={environment:n["environment"],search:n["search"]},t.pagination.current=1,t.getAdminGrants())}))}},mounted:function(){this.getAdminGrants(),this.getEnvironments()}},z=T,N=(0,q.Z)(z,i,o,!1,null,"af5cbcea",null),D=N.exports,I=function(){var e=this,t=e._self._c;return t("a-card",[t("a-form",{attrs:{layout:"inline",form:e.form},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}}},[t("a-form-item",[t("a-cascader",{directives:[{name:"decorator",rawName:"v-decorator",value:["organization_key"],expression:"['organization_key']"}],staticStyle:{width:"200px"},attrs:{"field-names":{label:"title",value:"key",children:"children"},options:e.organizations,"change-on-select":"","expand-trigger":"hover",placeholder:"请选择组织"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"apartment"},slot:"suffixIcon"})],1)],1),t("a-form-item",[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["environment"],expression:"['environment']"}],staticStyle:{width:"200px"},attrs:{allowClear:"",placeholder:"请选择环境","show-search":""}},e._l(e.environments,(function(n,a){return t("a-select-option",{key:a,attrs:{label:n.name,value:n.name}},[e._v(" "+e._s(n.name)+" ")])})),1)],1),t("a-form-item",[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["db_type"],expression:"['db_type']"}],staticStyle:{width:"200px"},attrs:{allowClear:"",placeholder:"请选择DB类型","show-search":""}},e._l(e.dbTypes,(function(n,a){return t("a-select-option",{key:a,attrs:{label:n,value:n}},[e._v(" "+e._s(n)+" ")])})),1)],1),t("a-form-item",[t("a-input-search",{directives:[{name:"decorator",rawName:"v-decorator",value:["search"],expression:"['search']"}],staticStyle:{width:"250px"},attrs:{allowClear:"",placeholder:"输入要查询内容"}})],1),t("a-form-item",[t("span",{staticClass:"table-page-search-submitButtons"},[t("a-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")])],1)]),t("a-form-item",{staticStyle:{float:"right","margin-right":"0px"}},[t("a-button",{attrs:{type:"primary"},on:{click:e.onAdd}},[t("a-icon",{attrs:{type:"plus"}}),e._v("新增")],1)],1)],1),t("a-table",{attrs:{columns:e.tableColumns,rowKey:function(e,t){return t},dataSource:e.tableData,pagination:e.pagination,loading:e.loading,size:"middle"},on:{change:e.handleTableChange},scopedSlots:e._u([{key:"use_type",fn:function(n){return t("span",{},["工单"===n?t("a-tag",{attrs:{color:"blue"}},[e._v(" "+e._s(n)+" ")]):t("a-tag",{attrs:{color:"purple"}},[e._v(e._s(n))])],1)}},{key:"action",fn:function(n,a){return t("span",{},[t("div",{staticClass:"editable-row-operations"},[t("a",{on:{click:function(){return e.editRow(a)}}},[t("span",{staticStyle:{color:"#409eff"}},[e._v("编辑")])]),t("a-divider",{attrs:{type:"vertical"}}),t("a",{attrs:{type:"dashed"},on:{click:function(t){return e.DeleteConfirm(a.id)}}},[t("span",{staticStyle:{color:"#409eff"}},[e._v("删除")])])],1)])}},{key:"expandedRowRender",fn:function(n){return t("span",{},[t("pre",[e._v(e._s(JSON.stringify(n.inspect_params,null,2)))])])}}])}),t("DBConfigsAddComponent",{ref:"DBConfigsAddComponent",on:{refreshTable:e.getDBConfig}}),t("DBConfigsEditComponent",{ref:"DBConfigsEditComponent",on:{refreshTable:e.getDBConfig}})],1)},$=[],F=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"新增数据库实例",width:"50%","on-ok":"onSubmit"},on:{cancel:e.handleCancel},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("template",{slot:"footer"},[t("a-button",{key:"back",on:{click:e.handleCancel}},[e._v("取消")]),t("a-button",{key:"submit",attrs:{type:"primary",loading:e.loading},on:{click:e.onSubmit}},[e._v("确定")])],1),t("a-form",{attrs:{form:e.form,"label-col":{span:4},"wrapper-col":{span:18}}},[t("a-form-item",{attrs:{label:"环境","has-feedback":""}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["environment",{rules:[{required:!0,message:"请选择环境"}]}],expression:"['environment', { rules: [{ required: true, message: '请选择环境' }] }]"}],attrs:{placeholder:"请选择环境",allowClear:"","show-search":""}},e._l(e.environments,(function(n,a){return t("a-select-option",{key:a,attrs:{label:n.name,value:n.id}},[e._v(" "+e._s(n.name)+" ")])})),1)],1),t("a-form-item",{attrs:{label:"组织","has-feedback":""}},[t("a-cascader",{directives:[{name:"decorator",rawName:"v-decorator",value:["organization_key",{rules:[{required:!0,message:"请选择组织"}]}],expression:"['organization_key', { rules: [{ required: true, message: '请选择组织' }] }]"}],attrs:{"field-names":{label:"title",value:"key",children:"children"},options:e.organizations,"change-on-select":"","expand-trigger":"hover",placeholder:"请选择组织"}})],1),t("a-form-item",{attrs:{label:"类型","has-feedback":""}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["db_type",{initialValue:"MySQL",rules:[{required:!0,message:"请选择数据库类型"}]}],expression:"['db_type', { initialValue: 'MySQL', rules: [{ required: true, message: '请选择数据库类型' }] }]"}],attrs:{placeholder:"请选择数据库类型"}},[t("a-select-option",{attrs:{value:"MySQL"}},[e._v(" MySQL ")]),t("a-select-option",{attrs:{value:"TiDB"}},[e._v(" TiDB ")]),t("a-select-option",{attrs:{value:"ClickHouse"}},[e._v(" ClickHouse ")])],1)],1),t("a-form-item",{attrs:{label:"用途","has-feedback":""}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["use_type",{initialValue:"工单",rules:[{required:!0,message:"请选择数据库用途"}]}],expression:"['use_type', { initialValue: '工单', rules: [{ required: true, message: '请选择数据库用途' }] }]"}],attrs:{placeholder:"请选择数据库用途"}},[t("a-select-option",{attrs:{value:"查询"}},[e._v(" 查询 ")]),t("a-select-option",{attrs:{value:"工单"}},[e._v(" 工单 ")])],1)],1),t("a-form-item",{attrs:{label:"主机名","has-feedback":""}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["hostname",{rules:[{required:!0,min:3,max:128,message:"请输入主机名"}],validateTrigger:"blur"}],expression:"[\n          'hostname',\n          {\n            rules: [{ required: true, min: 3, max: 128, message: '请输入主机名' }],\n            validateTrigger: 'blur',\n          },\n        ]"}]})],1),t("a-form-item",{attrs:{label:"端口","has-feedback":""}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["port",{type:"number",rules:[{required:!0,message:"请输入端口"}],validateTrigger:"blur"}],expression:"[\n          'port',\n          {\n            type: 'number',\n            rules: [{ required: true, message: '请输入端口' }],\n            validateTrigger: 'blur',\n          },\n        ]"}]})],1),t("a-form-item",{attrs:{label:"自定义审核参数",help:"格式要求为JSON类型，默认为{}，表示继承全局审核参数","has-feedback":""}},[t("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["inspect_params",{initialValue:"{}",rules:[{required:!0,message:"请输入自定义审核参数，默认为{}",validator:e.validatorInspectParams}]}],expression:"[\n          'inspect_params',\n          {\n            initialValue: '{}',\n            rules: [\n              {\n                required: true,\n                message: '请输入自定义审核参数，默认为{}',\n                validator: validatorInspectParams,\n              },\n            ],\n          },\n        ]"}],attrs:{"auto-size":{minRows:5,maxRows:10},placeholder:"请输入自定义审核参数，默认为{}"}})],1),t("a-form-item",{attrs:{label:"备注","has-feedback":""}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["remark",{rules:[{required:!0,min:3,max:256,message:"请输入备注"}],validateTrigger:"blur"}],expression:"[\n          'remark',\n          {\n            rules: [{ required: true, min: 3, max: 256, message: '请输入备注' }],\n            validateTrigger: 'blur',\n          },\n        ]"}]})],1)],1)],2)},O=[],R=(n(47941),{data:function(){return{visible:!1,loading:!1,environments:[],organizations:[],form:this.$form.createForm(this,{name:"dbconfigAdd"}),validatorInspectParams:function(e,t,n){try{JSON.parse(t)}catch(a){return n("请输入正确的JSON格式")}n()}}},methods:{showModal:function(){this.form.resetFields(),this.visible=!0},handleCancel:function(e){this.visible=!1},getEnvironments:function(){var e=this;return(0,c.Z)((0,l.Z)().mark((function t(){var n;return(0,l.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,h({is_page:!1});case 3:n=t.sent,e.environments=n.data,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),e.$message.error("Failed to fetch environments:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},getOrganizations:function(){var e=this;return(0,c.Z)((0,l.Z)().mark((function t(){var n;return(0,l.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,w.xY)({is_page:!1});case 3:n=t.sent,e.organizations=n.data,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),e.$message.error("Failed to fetch organizations:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},createDBConfig:function(e){var t=this;m(e).then((function(e){var n="0000"===e.code?"info":"error";t.$message[n](e.message)})).catch((function(e){})).finally((function(){t.visible=!1,t.loading=!1,t.$emit("refreshTable")}))},onSubmit:function(e){var t=this;this.loading=!0,e.preventDefault(),this.form.validateFields((function(e,n){e||(n["port"]=parseInt(n["port"],10),isNaN(n["port"])||(n["inspect_params"]=JSON.parse(n["inspect_params"]),t.createDBConfig(n)))})),this.loading=!1}},mounted:function(){this.getEnvironments(),this.getOrganizations()}}),L=R,B=(0,q.Z)(L,F,O,!1,null,null,null),A=B.exports,M=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"编辑数据库配置",width:"50%","on-ok":"onSubmit"},on:{cancel:e.handleCancel},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("template",{slot:"footer"},[t("a-button",{key:"back",on:{click:e.handleCancel}},[e._v("取消")]),t("a-button",{key:"submit",attrs:{type:"primary",loading:e.loading},on:{click:e.onSubmit}},[e._v("确定")])],1),t("a-form",{attrs:{form:e.form,"label-col":{span:4},"wrapper-col":{span:18}}},[t("a-form-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{label:"ID"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["id"],expression:"['id']"}]})],1),t("a-form-item",{attrs:{label:"环境","has-feedback":""}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["environment",{rules:[{required:!0,message:"请选择环境"}]}],expression:"['environment', { rules: [{ required: true, message: '请选择环境' }] }]"}],attrs:{placeholder:"请选择环境",allowClear:"","show-search":""}},e._l(e.environments,(function(n,a){return t("a-select-option",{key:a,attrs:{label:n.name,value:n.id}},[e._v(" "+e._s(n.name)+" ")])})),1)],1),t("a-form-item",{attrs:{label:"组织","has-feedback":""}},[t("a-cascader",{directives:[{name:"decorator",rawName:"v-decorator",value:["organization_key",{rules:[{required:!0,message:"请选择组织"}]}],expression:"['organization_key', { rules: [{ required: true, message: '请选择组织' }] }]"}],attrs:{"field-names":{label:"title",value:"key",children:"children"},options:e.organizations,"change-on-select":"","expand-trigger":"hover",placeholder:"请选择组织"}})],1),t("a-form-item",{attrs:{label:"类型","has-feedback":""}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["db_type",{initialValue:"MySQL",rules:[{required:!0,message:"请选择数据库类型"}]}],expression:"['db_type', { initialValue: 'MySQL', rules: [{ required: true, message: '请选择数据库类型' }] }]"}],attrs:{placeholder:"请选择数据库类型"}},[t("a-select-option",{attrs:{value:"MySQL"}},[e._v(" MySQL ")]),t("a-select-option",{attrs:{value:"TiDB"}},[e._v(" TiDB ")]),t("a-select-option",{attrs:{value:"ClickHouse"}},[e._v(" ClickHouse ")])],1)],1),t("a-form-item",{attrs:{label:"用途","has-feedback":""}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["use_type",{initialValue:"工单",rules:[{required:!0,message:"请选择数据库用途"}]}],expression:"['use_type', { initialValue: '工单', rules: [{ required: true, message: '请选择数据库用途' }] }]"}],attrs:{placeholder:"请选择数据库用途"}},[t("a-select-option",{attrs:{value:"查询"}},[e._v(" 查询 ")]),t("a-select-option",{attrs:{value:"工单"}},[e._v(" 工单 ")])],1)],1),t("a-form-item",{attrs:{label:"主机名","has-feedback":""}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["hostname",{rules:[{required:!0,min:3,max:128,message:"请输入主机名"}],validateTrigger:"blur"}],expression:"[\n          'hostname',\n          {\n            rules: [{ required: true, min: 3, max: 128, message: '请输入主机名' }],\n            validateTrigger: 'blur',\n          },\n        ]"}]})],1),t("a-form-item",{attrs:{label:"端口","has-feedback":""}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["port",{rules:[{required:!0,message:"请输入端口"}],validateTrigger:"blur"}],expression:"[\n          'port',\n          {\n            rules: [{ required: true, message: '请输入端口' }],\n            validateTrigger: 'blur',\n          },\n        ]"}]})],1),t("a-form-item",{attrs:{label:"自定义审核参数",help:"格式要求为JSON类型，默认为{}，表示继承全局审核参数","has-feedback":""}},[t("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["inspect_params",{initialValue:"{}",rules:[{required:!0,message:"请输入自定义审核参数，默认为{}",validator:e.validatorInspectParams}]}],expression:"[\n          'inspect_params',\n          {\n            initialValue: '{}',\n            rules: [\n              {\n                required: true,\n                message: '请输入自定义审核参数，默认为{}',\n                validator: validatorInspectParams,\n              },\n            ],\n          },\n        ]"}],attrs:{"auto-size":{minRows:5,maxRows:10},placeholder:"请输入自定义审核参数，默认为{}"}})],1),t("a-form-item",{attrs:{label:"备注","has-feedback":""}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["remark",{rules:[{required:!0,min:3,max:256,message:"请输入备注"}],validateTrigger:"blur"}],expression:"[\n          'remark',\n          {\n            rules: [{ required: true, min: 3, max: 256, message: '请输入备注' }],\n            validateTrigger: 'blur',\n          },\n        ]"}]})],1)],1)],2)},G=[],V={data:function(){return{visible:!1,loading:!1,environments:[],organizations:[],form:this.$form.createForm(this,{name:"dbConfigEdit"}),validatorInspectParams:function(e,t,n){try{JSON.parse(t)}catch(a){return n("请输入正确的JSON格式")}n()}}},methods:{getEnvironments:function(){var e=this;return(0,c.Z)((0,l.Z)().mark((function t(){var n;return(0,l.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,h({is_page:!1});case 3:n=t.sent,e.environments=n.data,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),e.$message.error("Failed to fetch environments:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},getOrganizations:function(){var e=this;return(0,c.Z)((0,l.Z)().mark((function t(){var n;return(0,l.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,w.xY)({is_page:!1});case 3:n=t.sent,e.organizations=n.data,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),e.$message.error("Failed to fetch organizations:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},showModal:function(e){var t=this;this.form.resetFields(),this.$nextTick((function(){setTimeout((function(){var n={id:e.id,hostname:e.hostname,port:e.port,inspect_params:JSON.stringify(e.inspect_params),use_type:e.use_type,db_type:e.db_type,environment:e.environment,organization_key:e.organization_path,remark:e.remark};t.form.setFieldsValue(n)}))})),this.visible=!0},handleCancel:function(e){this.visible=!1},updateDBConfig:function(e){var t=this;p(e).then((function(e){var n="0000"===e.code?"info":"error";t.$message[n](e.message)})).catch((function(e){})).finally((function(){t.visible=!1,t.loading=!1,t.$emit("refreshTable")}))},onSubmit:function(e){var t=this;this.loading=!0,e.preventDefault(),this.form.validateFields((function(e,n){e||(n["port"]=parseInt(n["port"],10),isNaN(n["port"])||(n["inspect_params"]=JSON.parse(n["inspect_params"]),t.updateDBConfig(n)))})),this.loading=!1}},mounted:function(){this.getEnvironments(),this.getOrganizations()}},Q=V,J=(0,q.Z)(Q,M,G,!1,null,null,null),j=J.exports,H=[{title:"用途",dataIndex:"use_type",key:"use_type",scopedSlots:{customRender:"use_type"}},{title:"环境",dataIndex:"environment_name",key:"environment_name",scopedSlots:{customRender:"environment_name"}},{title:"类型",dataIndex:"db_type",key:"db_type",scopedSlots:{customRender:"db_type"}},{title:"组织",dataIndex:"organization_name",key:"organization_name",scopedSlots:{customRender:"organization_name"}},{title:"主机名",dataIndex:"hostname",key:"hostname",scopedSlots:{customRender:"hostname"}},{title:"端口",dataIndex:"port",key:"port",scopedSlots:{customRender:"port"}},{title:"备注",dataIndex:"remark",key:"remark",scopedSlots:{customRender:"remark"}},{title:"创建时间",dataIndex:"created_at",key:"created_at",scopedSlots:{customRender:"created_at"}},{title:"更新时间",dataIndex:"updated_at",key:"updated_at",scopedSlots:{customRender:"updated_at"}},{title:"操作",dataIndex:"action",key:"action",scopedSlots:{customRender:"action"}}],Y=["MySQL","TiDB","ClickHouse"],K={components:{DBConfigsAddComponent:A,DBConfigsEditComponent:j},data:function(){return{loading:!1,tableColumns:H,tableData:[],environments:[],organizations:[],dbTypes:Y,pagination:{current:1,pageSize:10,total:0,pageSizeOptions:["10","20"],showSizeChanger:!0},form:this.$form.createForm(this,{name:"dbconfig"})}},methods:{getEnvironments:function(){var e=this;return(0,c.Z)((0,l.Z)().mark((function t(){var n;return(0,l.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,h({is_page:!1});case 3:n=t.sent,e.environments=n.data,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),e.$message.error("Failed to fetch environments:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},getOrganizations:function(){var e=this;return(0,c.Z)((0,l.Z)().mark((function t(){var n;return(0,l.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,w.xY)({is_page:!1});case 3:n=t.sent,e.organizations=n.data,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),e.$message.error("Failed to fetch organizations:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},getDBConfig:function(){var e=this;this.loading=!0;var t=(0,s.Z)({page_size:this.pagination.pageSize,page:this.pagination.current,is_page:!0},this.filters);d(t).then((function(t){"0000"===t.code?(e.pagination.total=t.total,e.tableData=t.data):e.$message.error(t.message)})).catch((function(e){})).finally((function(){e.loading=!1}))},editRow:function(e){this.$refs.DBConfigsEditComponent.showModal(e)},onAdd:function(){this.$refs.DBConfigsAddComponent.showModal()},DeleteConfirm:function(e){var t=this;this.$confirm({title:"警告",content:"你确定删除？",okText:"Yes",okType:"danger",cancelText:"No",onOk:function(){f(e).then((function(e){"0001"===e.code?t.$message.warning(e.message):t.$message.info(e.message)})).catch((function(e){})).finally((function(){t.getDBConfig()}))},onCancel:function(){}})},handleTableChange:function(e){this.pagination.current=e.current,this.pagination.pageSize=e.pageSize,this.getDBConfig()},handleSearch:function(e){var t=this;e.preventDefault(),this.form.validateFields((function(e,n){e||(t.filters={environment:n["environment"],db_type:n["db_type"],search:n["search"]},t.pagination.current=1,t.getDBConfig())}))}},mounted:function(){this.getDBConfig(),this.getEnvironments(),this.getOrganizations()}},U=K,X=(0,q.Z)(U,I,$,!1,null,"6b8e840e",null),W=X.exports,ee=function(){var e=this,t=e._self._c;return t("a-card",[t("a-form",{attrs:{layout:"inline",form:e.form},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}}},[t("a-form-item",[t("a-input-search",{directives:[{name:"decorator",rawName:"v-decorator",value:["search"],expression:"['search']"}],staticStyle:{width:"300px"},attrs:{allowClear:"",placeholder:"输入要查询内容"}})],1),t("a-form-item",[t("span",{staticClass:"table-page-search-submitButtons"},[t("a-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")])],1)]),t("a-form-item",{staticStyle:{float:"right","margin-right":"0px"}},[t("a-button",{attrs:{type:"primary"},on:{click:e.onAdd}},[t("a-icon",{attrs:{type:"plus"}}),e._v("新增")],1)],1)],1),t("a-table",{attrs:{columns:e.tableColumns,rowKey:function(e,t){return t},dataSource:e.tableData,pagination:e.pagination,loading:e.loading,size:"middle"},on:{change:e.handleTableChange},scopedSlots:e._u([{key:"action",fn:function(n,a){return t("span",{},[t("div",{staticClass:"editable-row-operations"},[t("a",{on:{click:function(){return e.editRow(a)}}},[t("span",{staticStyle:{color:"#409eff"}},[e._v("编辑")])]),t("a-divider",{attrs:{type:"vertical"}}),t("a",{attrs:{type:"dashed"},on:{click:function(t){return e.DeleteConfirm(a.id)}}},[t("span",{staticStyle:{color:"#409eff"}},[e._v("删除")])])],1)])}}])}),t("EnvironmentsAddComponent",{ref:"EnvironmentsAddComponent",on:{refreshTable:e.getEnvironments}}),t("EnvironmentsEditComponent",{ref:"EnvironmentsEditComponent",on:{refreshTable:e.getEnvironments}})],1)},te=[],ne=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"新增环境",width:"40%","on-ok":"onSubmit"},on:{cancel:e.handleCancel},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("template",{slot:"footer"},[t("a-button",{key:"back",on:{click:e.handleCancel}},[e._v("取消")]),t("a-button",{key:"submit",attrs:{type:"primary",loading:e.loading},on:{click:e.onSubmit}},[e._v("确定")])],1),t("a-form",{attrs:{form:e.form,"label-col":{span:4},"wrapper-col":{span:18}}},[t("a-form-item",{attrs:{label:"环境","has-feedback":""}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,min:3,max:128,message:"请输入环境名"}],validateTrigger:"blur"}],expression:"[\n          'name',\n          {\n            rules: [{ required: true, min: 3, max: 128, message: '请输入环境名' }],\n            validateTrigger: 'blur',\n          },\n        ]"}]})],1)],1)],2)},ae=[],re={data:function(){return{visible:!1,loading:!1,form:this.$form.createForm(this,{name:"systemEnvironmentAdd"})}},methods:{showModal:function(){this.form.resetFields(),this.visible=!0},handleCancel:function(e){this.visible=!1},createEnvironments:function(e){var t=this;v(e).then((function(e){var n="0000"===e.code?"info":"error";t.$message[n](e.message)})).catch((function(e){})).finally((function(){t.visible=!1,t.loading=!1,t.$emit("refreshTable")}))},onSubmit:function(e){var t=this;this.loading=!0,e.preventDefault(),this.form.validateFields((function(e,n){e||t.createEnvironments(n)})),this.loading=!1}}},ie=re,oe=(0,q.Z)(ie,ne,ae,!1,null,null,null),se=oe.exports,le=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"编辑角色",width:"55%","on-ok":"onSubmit"},on:{cancel:e.handleCancel},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("template",{slot:"footer"},[t("a-button",{key:"back",on:{click:e.handleCancel}},[e._v("取消")]),t("a-button",{key:"submit",attrs:{type:"primary",loading:e.loading},on:{click:e.onSubmit}},[e._v("确定")])],1),t("a-form",{attrs:{form:e.form,"label-col":{span:4},"wrapper-col":{span:18}}},[t("a-form-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{label:"ID"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["id"],expression:"['id']"}]})],1),t("a-form-item",{attrs:{label:"环境","has-feedback":""}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,min:3,max:128,message:"请输入环境名"}],validateTrigger:"blur"}],expression:"[\n          'name',\n          {\n            rules: [{ required: true, min: 3, max: 128, message: '请输入环境名' }],\n            validateTrigger: 'blur',\n          },\n        ]"}]})],1)],1)],2)},ce=[],ue={data:function(){return{visible:!1,loading:!1,form:this.$form.createForm(this,{name:"systemEnvironmentEdit"})}},methods:{showModal:function(e){var t=this;this.form.resetFields(),this.$nextTick((function(){setTimeout((function(){var n={id:e.id,name:e.name};t.form.setFieldsValue(n)}))})),this.visible=!0},handleCancel:function(e){this.visible=!1},updateEnvironments:function(e){var t=this;g(e).then((function(e){var n="0000"===e.code?"info":"error";t.$message[n](e.message)})).catch((function(e){})).finally((function(){t.visible=!1,t.loading=!1,t.$emit("refreshTable")}))},onSubmit:function(e){var t=this;this.loading=!0,e.preventDefault(),this.form.validateFields((function(e,n){e||("string"===typeof n["port"]&&(n["port"]=parseInt(n["port"])),t.updateEnvironments(n))})),this.loading=!1}}},de=ue,me=(0,q.Z)(de,le,ce,!1,null,null,null),pe=me.exports,fe=[{title:"环境",dataIndex:"name",key:"name",scopedSlots:{customRender:"name"}},{title:"创建时间",dataIndex:"created_at",key:"created_at",scopedSlots:{customRender:"created_at"}},{title:"更新时间",dataIndex:"updated_at",key:"updated_at",scopedSlots:{customRender:"updated_at"}},{title:"操作",dataIndex:"action",key:"action",scopedSlots:{customRender:"action"}}],he={components:{EnvironmentsAddComponent:se,EnvironmentsEditComponent:pe},data:function(){return{loading:!1,tableColumns:fe,tableData:[],pagination:{current:1,pageSize:10,total:0,pageSizeOptions:["10","20"],showSizeChanger:!0},form:this.$form.createForm(this,{name:"environment"})}},methods:{getEnvironments:function(){var e=this;this.loading=!0;var t=(0,s.Z)({page_size:this.pagination.pageSize,page:this.pagination.current,is_page:!0},this.filters);h(t).then((function(t){"0000"===t.code?(e.pagination.total=t.total,e.tableData=t.data):e.$message.error(t.message)})).catch((function(e){})).finally((function(){e.loading=!1}))},editRow:function(e){this.$refs.EnvironmentsEditComponent.showModal(e)},onAdd:function(){this.$refs.EnvironmentsAddComponent.showModal()},DeleteConfirm:function(e){var t=this;this.$confirm({title:"警告",content:"你确定删除？",okText:"Yes",okType:"danger",cancelText:"No",onOk:function(){b(e).then((function(e){"0001"===e.code?t.$message.warning(e.message):t.$message.info(e.message)})).catch((function(e){})).finally((function(){t.getEnvironments()}))},onCancel:function(){}})},handleTableChange:function(e){this.pagination.current=e.current,this.pagination.pageSize=e.pageSize,this.getEnvironments()},handleSearch:function(e){var t=this;e.preventDefault(),this.form.validateFields((function(e,n){e||(t.filters={search:n["search"]},t.pagination.current=1,t.getEnvironments())}))}},mounted:function(){this.getEnvironments()}},ve=he,ge=(0,q.Z)(ve,ee,te,!1,null,"7a45bdc0",null),be=ge.exports,ye=function(){var e=this,t=e._self._c;return t("a-card",[t("a-alert",{attrs:{message:"全局审核参数配置，作用于全部数据库实例的语法审核。优先级：数据库实例级别审核参数 > 全局审核参数。如您需要个性化定制实例级别审核参数，请在「数据库实例配置」里面进行调整。",type:"success"}}),t("a-form",{attrs:{layout:"inline",form:e.form},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}}},[t("a-form-item",[t("a-input-search",{directives:[{name:"decorator",rawName:"v-decorator",value:["search"],expression:"['search']"}],staticStyle:{width:"250px"},attrs:{allowClear:"",placeholder:"输入要查询内容"}})],1),t("a-form-item",[t("span",{staticClass:"table-page-search-submitButtons"},[t("a-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")])],1)])],1),t("a-table",{attrs:{columns:e.tableColumns,rowKey:function(e,t){return t},dataSource:e.tableData,pagination:e.pagination,loading:e.loading,size:"middle"},on:{change:e.handleTableChange},scopedSlots:e._u([{key:"action",fn:function(n,a){return t("span",{},[t("div",{staticClass:"editable-row-operations"},[t("a",{on:{click:function(){return e.editRow(a)}}},[t("span",{staticStyle:{color:"#409eff"}},[e._v("编辑")])])])])}},{key:"expandedRowRender",fn:function(n){return t("span",{},[t("pre",[e._v(e._s(JSON.stringify(n.params,null,2)))])])}}])}),t("InspectEditComponent",{ref:"InspectEditComponent",on:{refreshTable:e.GetInspectParams}})],1)},_e=[],ke=function(e){return u.ZP.request({url:"/api/v1/admin/inspect/params",method:"get",params:e})},we=function(e){return u.ZP.request({url:"/api/v1/admin/inspect/params/".concat(e.id),method:"put",data:e})},xe=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"编辑审核参数",width:"55%","on-ok":"onSubmit"},on:{cancel:e.handleCancel},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("template",{slot:"footer"},[t("a-button",{key:"back",on:{click:e.handleCancel}},[e._v("取消")]),t("a-button",{key:"submit",attrs:{type:"primary",loading:e.loading},on:{click:e.onSubmit}},[e._v("确定")])],1),t("a-form",{attrs:{form:e.form,"label-col":{span:4},"wrapper-col":{span:18}}},[t("a-form-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{label:"ID"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["id"],expression:"['id']"}]})],1),t("a-form-item",{attrs:{label:"审核参数",help:"格式要求为JSON类型，禁止修改KEY，可修改Value！！！","has-feedback":""}},[t("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["params",{initialValue:"{}",rules:[{required:!0,message:"请输入自定义审核参数，默认为{}",validator:e.validatorInspectParams}]}],expression:"[\n        'params',\n        {\n          initialValue: '{}',\n          rules: [\n            {\n              required: true,\n              message: '请输入自定义审核参数，默认为{}',\n              validator: validatorInspectParams,\n            },\n          ],\n        },\n      ]"}],attrs:{"auto-size":{minRows:3,maxRows:5},placeholder:"请输入自定义审核参数，默认为{}"}})],1),t("a-form-item",{attrs:{label:"备注",help:"非必要不要修改","has-feedback":""}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["remark",{rules:[{required:!0,min:3,max:256,message:"请输入备注"}],validateTrigger:"blur"}],expression:"[\n          'remark',\n          {\n            rules: [{ required: true, min: 3, max: 256, message: '请输入备注' }],\n            validateTrigger: 'blur',\n          },\n        ]"}]})],1)],1)],2)},Se=[],Ce={data:function(){return{visible:!1,loading:!1,form:this.$form.createForm(this,{name:"inspectEdit"}),validatorInspectParams:function(e,t,n){try{JSON.parse(t)}catch(a){return n("请输入正确的JSON格式")}n()}}},methods:{showModal:function(e){var t=this;this.form.resetFields(),this.$nextTick((function(){setTimeout((function(){var n={id:e.id,params:JSON.stringify(e.params),remark:e.remark};t.form.setFieldsValue(n)}))})),this.visible=!0},handleCancel:function(e){this.visible=!1},UpdateInspectParams:function(e){var t=this;we(e).then((function(e){var n="0000"===e.code?"info":"error";t.$message[n](e.message)})).catch((function(e){})).finally((function(){t.visible=!1,t.loading=!1,t.$emit("refreshTable")}))},onSubmit:function(e){var t=this;this.loading=!0,e.preventDefault(),this.form.validateFields((function(e,n){e||(n["params"]=JSON.parse(n["params"]),t.UpdateInspectParams(n))})),this.loading=!1}}},qe=Ce,Ze=(0,q.Z)(qe,xe,Se,!1,null,null,null),Ee=Ze.exports,Pe=[{title:"备注",dataIndex:"remark",key:"remark",scopedSlots:{customRender:"remark"}},{title:"更新时间",dataIndex:"updated_at",key:"updated_at",scopedSlots:{customRender:"updated_at"}},{title:"操作",dataIndex:"action",key:"action",scopedSlots:{customRender:"action"}}],Te={components:{InspectEditComponent:Ee},data:function(){return{loading:!1,tableColumns:Pe,tableData:[],pagination:{current:1,pageSize:10,total:0,pageSizeOptions:["10","20"],showSizeChanger:!0},form:this.$form.createForm(this,{name:"inspect"})}},methods:{GetInspectParams:function(){var e=this;this.loading=!0;var t=(0,s.Z)({page_size:this.pagination.pageSize,page:this.pagination.current,is_page:!0},this.filters);ke(t).then((function(t){"0000"===t.code?(e.pagination.total=t.total,e.tableData=t.data):e.$message.error(t.message)})).catch((function(e){})).finally((function(){e.loading=!1}))},editRow:function(e){this.$refs.InspectEditComponent.showModal(e)},handleTableChange:function(e){this.pagination.current=e.current,this.pagination.pageSize=e.pageSize,this.GetInspectParams()},handleSearch:function(e){var t=this;e.preventDefault(),this.form.validateFields((function(e,n){e||(t.filters={environment:n["environment"],db_type:n["db_type"],search:n["search"]},t.pagination.current=1,t.GetInspectParams())}))}},mounted:function(){this.GetInspectParams()}},ze=Te,Ne=(0,q.Z)(ze,ye,_e,!1,null,"6a87eef2",null),De=Ne.exports,Ie={components:{DBConfigsComponent:W,InspectComponent:De,SystemEnvironmentsComponent:be,DasComponent:D}},$e=Ie,Fe=(0,q.Z)($e,a,r,!1,null,"28bfbf42",null),Oe=Fe.exports},86325:function(e,t,n){n.d(t,{AK:function(){return b},E0:function(){return y},Fh:function(){return g},Fx:function(){return l},HX:function(){return x},NA:function(){return h},OR:function(){return c},Q4:function(){return S},TH:function(){return v},a5:function(){return _},dN:function(){return k},g2:function(){return p},gg:function(){return r},h7:function(){return d},rK:function(){return s},s1:function(){return u},sk:function(){return w},tv:function(){return i},ty:function(){return m},v_:function(){return f},zv:function(){return o}});var a=n(34820),r=function(e){return a.ZP.request({url:"/api/v1/das/schemas",method:"get",params:e})},i=function(e){return a.ZP.request({url:"/api/v1/das/tables",method:"get",params:e})},o=function(e){return a.ZP.request({url:"/api/v1/das/execute/query/mysql",method:"post",data:e})},s=function(e){return a.ZP.request({url:"/api/v1/das/execute/query/clickhouse",method:"post",data:e})},l=function(e){return a.ZP.request({url:"/api/v1/das/user/grants",method:"get",params:e})},c=function(e){return a.ZP.request({url:"/api/v1/das/dbdict",method:"get",params:e})},u=function(e){return a.ZP.request({url:"/api/v1/das/history",method:"get",params:e})},d=function(e){return a.ZP.request({url:"/api/v1/das/favorites",method:"get",params:e})},m=function(e){return a.ZP.request({url:"/api/v1/das/favorites",method:"post",data:e})},p=function(e){return a.ZP.request({url:"/api/v1/das/favorites/".concat(e.id),method:"put",data:e})},f=function(e){return a.ZP.request({url:"/api/v1/das/favorites/".concat(e),method:"delete",data:e})},h=function(e){return a.ZP.request({url:"/api/v1/das/table-info",method:"get",params:e})},v=function(e){return a.ZP.request({url:"/api/v1/das/admin/schemas/grant",method:"get",params:e})},g=function(e){return a.ZP.request({url:"/api/v1/das/admin/schemas/grant",method:"post",data:e})},b=function(e){return a.ZP.request({url:"/api/v1/das/admin/schemas/grant/".concat(e),method:"delete",data:e})},y=function(e){return a.ZP.request({url:"/api/v1/das/admin/tables/grant",method:"get",params:e})},_=function(e){return a.ZP.request({url:"/api/v1/das/admin/tables/grant",method:"post",data:e})},k=function(e){return a.ZP.request({url:"/api/v1/das/admin/tables/grant/".concat(e),method:"delete",data:e})},w=function(e){return a.ZP.request({url:"/api/v1/das/admin/instances/list",method:"get",params:e})},x=function(e){return a.ZP.request({url:"/api/v1/das/admin/schemas/list",method:"get",params:e})},S=function(e){return a.ZP.request({url:"/api/v1/das/admin/tables/list",method:"get",params:e})}},94688:function(e,t,n){n.d(t,{BQ:function(){return b},DA:function(){return i},EP:function(){return f},G_:function(){return c},Ly:function(){return g},M6:function(){return o},MF:function(){return _},P4:function(){return d},QQ:function(){return v},X7:function(){return l},ZS:function(){return u},ie:function(){return m},mN:function(){return s},nk:function(){return y},vp:function(){return h},xE:function(){return r},xY:function(){return p}});var a=n(34820),r=function(e){return a.ZP.request({url:"/api/v1/admin/users",method:"get",params:e})},i=function(e){return a.ZP.request({url:"/api/v1/admin/users",method:"post",data:e})},o=function(e){return a.ZP.request({url:"/api/v1/admin/users/".concat(e.uid),method:"put",data:e})},s=function(e){return a.ZP.request({url:"/api/v1/admin/users/".concat(e),method:"delete",data:e})},l=function(e){return a.ZP.request({url:"/api/v1/admin/users/change/password",method:"post",data:e})},c=function(e){return a.ZP.request({url:"/api/v1/admin/roles",method:"get",params:e})},u=function(e){return a.ZP.request({url:"/api/v1/admin/roles",method:"post",data:e})},d=function(e){return a.ZP.request({url:"/api/v1/admin/roles/".concat(e.id),method:"put",data:e})},m=function(e){return a.ZP.request({url:"/api/v1/admin/roles/".concat(e),method:"delete",data:e})},p=function(e){return a.ZP.request({url:"/api/v1/admin/organizations",method:"get",params:e})},f=function(e){return a.ZP.request({url:"/api/v1/admin/organizations/root-node",method:"post",data:e})},h=function(e){return a.ZP.request({url:"/api/v1/admin/organizations/child-node",method:"post",data:e})},v=function(e){return a.ZP.request({url:"/api/v1/admin/organizations",method:"put",data:e})},g=function(e){return a.ZP.request({url:"/api/v1/admin/organizations",method:"delete",data:e})},b=function(e){return a.ZP.request({url:"/api/v1/admin/organizations/users",method:"get",params:e})},y=function(e){return a.ZP.request({url:"/api/v1/admin/organizations/users",method:"post",data:e})},_=function(e){return a.ZP.request({url:"/api/v1/admin/organizations/users",method:"delete",data:e})}},37255:function(e,t,n){n.d(t,{Z:function(){return r}});n(41539);function a(e,t,n,a,r,i,o){try{var s=e[i](o),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(a,r)}function r(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function s(e){a(o,r,i,s,l,"next",e)}function l(e){a(o,r,i,s,l,"throw",e)}s(void 0)}))}}},83941:function(e,t,n){n.d(t,{Z:function(){return r}});n(82526),n(41817),n(41539),n(32165),n(78783),n(33948),n(72443),n(39341),n(73706),n(10408),n(30489),n(54747),n(68309),n(68304),n(47042);var a=n(67555);function r(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
r=function(){return t};var e,t={},n=Object.prototype,i=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},l=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function d(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(e){d=function(e,t,n){return e[t]=n}}function m(e,t,n,a){var r=t&&t.prototype instanceof y?t:y,i=Object.create(r.prototype),s=new N(a||[]);return o(i,"_invoke",{value:E(e,n,s)}),i}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=m;var f="suspendedStart",h="suspendedYield",v="executing",g="completed",b={};function y(){}function _(){}function k(){}var w={};d(w,l,(function(){return this}));var x=Object.getPrototypeOf,S=x&&x(x(D([])));S&&S!==n&&i.call(S,l)&&(w=S);var C=k.prototype=y.prototype=Object.create(w);function q(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function Z(e,t){function n(r,o,s,l){var c=p(e[r],e,o);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==(0,a.Z)(d)&&i.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,s,l)}),(function(e){n("throw",e,s,l)})):t.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return n("throw",e,s,l)}))}l(c.arg)}var r;o(this,"_invoke",{value:function(e,a){function i(){return new t((function(t,r){n(e,a,t,r)}))}return r=r?r.then(i,i):i()}})}function E(t,n,a){var r=f;return function(i,o){if(r===v)throw new Error("Generator is already running");if(r===g){if("throw"===i)throw o;return{value:e,done:!0}}for(a.method=i,a.arg=o;;){var s=a.delegate;if(s){var l=P(s,a);if(l){if(l===b)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(r===f)throw r=g,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);r=v;var c=p(t,n,a);if("normal"===c.type){if(r=a.done?g:h,c.arg===b)continue;return{value:c.arg,done:a.done}}"throw"===c.type&&(r=g,a.method="throw",a.arg=c.arg)}}}function P(t,n){var a=n.method,r=t.iterator[a];if(r===e)return n.delegate=null,"throw"===a&&t.iterator["return"]&&(n.method="return",n.arg=e,P(t,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),b;var i=p(r,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,b;var o=i.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,b):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,b)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function z(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function N(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function D(t){if(t||""===t){var n=t[l];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function n(){for(;++r<t.length;)if(i.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError((0,a.Z)(t)+" is not iterable")}return _.prototype=k,o(C,"constructor",{value:k,configurable:!0}),o(k,"constructor",{value:_,configurable:!0}),_.displayName=d(k,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===_||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,k):(e.__proto__=k,d(e,u,"GeneratorFunction")),e.prototype=Object.create(C),e},t.awrap=function(e){return{__await:e}},q(Z.prototype),d(Z.prototype,c,(function(){return this})),t.AsyncIterator=Z,t.async=function(e,n,a,r,i){void 0===i&&(i=Promise);var o=new Z(m(e,n,a,r),i);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},q(C),d(C,u,"Generator"),d(C,l,(function(){return this})),d(C,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var a in t)n.push(a);return n.reverse(),function e(){for(;n.length;){var a=n.pop();if(a in t)return e.value=a,e.done=!1,e}return e.done=!0,e}},t.values=D,N.prototype={constructor:N,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(z),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function a(a,r){return s.type="throw",s.arg=t,n.next=a,r&&(n.method="next",n.arg=e),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],s=o.completion;if("root"===o.tryLoc)return a("end");if(o.tryLoc<=this.prev){var l=i.call(o,"catchLoc"),c=i.call(o,"finallyLoc");if(l&&c){if(this.prev<o.catchLoc)return a(o.catchLoc,!0);if(this.prev<o.finallyLoc)return a(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return a(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return a(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&i.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var r=a;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=e,o.arg=t,r?(this.method="next",this.next=r.finallyLoc,b):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),z(n),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var a=n.completion;if("throw"===a.type){var r=a.arg;z(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,a){return this.delegate={iterator:D(t),resultName:n,nextLoc:a},"next"===this.method&&(this.arg=e),b}},t}}}]);