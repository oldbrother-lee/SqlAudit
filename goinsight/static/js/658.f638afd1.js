"use strict";(self["webpackChunkvue_antd_pro"]=self["webpackChunkvue_antd_pro"]||[]).push([[658],{4658:function(t,e,r){r.r(e),r.d(e,{default:function(){return f}});r(68309);var n=function(){var t=this,e=t._self._c;return e("a-card",[e("a-form",{attrs:{layout:"inline",form:t.form},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleSearch.apply(null,arguments)}}},[e("a-form-item",[e("a-switch",{staticClass:"cus-switch",attrs:{checked:t.onlyMyOrders,"checked-children":"我的工单","un-checked-children":"我的工单"},on:{change:t.onMyChange}})],1),e("a-form-item",[e("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["environment",{initialValue:""}],expression:"['environment', { initialValue: '' }]"}],staticStyle:{width:"250px"},attrs:{allowClear:"",placeholder:"请选择环境","show-search":""}},[e("a-select-option",{attrs:{value:""}},[t._v("所有环境")]),t._l(t.environments,(function(r,n){return e("a-select-option",{key:n,attrs:{label:r.name,value:r.id}},[t._v(" "+t._s(r.name)+" ")])}))],2)],1),e("a-form-item",[e("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["progress",{initialValue:""}],expression:"['progress', { initialValue: '' }]"}],staticStyle:{width:"250px"},attrs:{allowClear:"",placeholder:"请选择进度","show-search":""}},[e("a-select-option",{attrs:{value:""}},[t._v("所有进度")]),t._l(t.progs,(function(r,n){return e("a-select-option",{key:n,attrs:{label:r,value:r}},[t._v(t._s(r))])}))],2)],1),e("a-form-item",[e("a-input-search",{directives:[{name:"decorator",rawName:"v-decorator",value:["search"],expression:"['search']"}],staticStyle:{width:"350px"},attrs:{allowClear:"",placeholder:"输入要查询工单标题"}})],1),e("a-form-item",[e("span",{staticClass:"table-page-search-submitButtons"},[e("a-button",{attrs:{type:"primary"},on:{click:t.handleSearch}},[t._v("查询")])],1)])],1),e("a-table",{attrs:{columns:t.tableColumns,rowKey:function(t,e){return e},dataSource:t.tableData,pagination:t.pagination,loading:t.loading},on:{change:t.handleTableChange},scopedSlots:t._u([{key:"progress",fn:function(r){return e("span",{},[e("a-tag",{staticClass:"progress-tag",attrs:{color:t.getProgressTagColor(r),circle:""}},[e("a-icon",{attrs:{type:t.getProgressIcon(r)}}),t._v(" "+t._s(r)+" ")],1)],1)}},{key:"order_title",fn:function(r,n){return e("span",{},[e("a-tooltip",[e("template",{slot:"title"},[n.is_restrict_access?e("span",[t._v(" 仅当前工单的提交人/审核人/复核人/抄送人可以查看工单内容（要求工单查看权限） ")]):e("span",[t._v("所有用户均可以查看工单内容（要求工单查看权限）")])]),e("a-icon",{staticClass:"access-icon",attrs:{type:n.is_restrict_access?"lock":"unlock",theme:n.is_restrict_access?"twoTone":"outlined","two-tone-color":n.is_restrict_access?"#eb2f96":"#52c41a"}})],2),e("router-link",{staticClass:"title-link",attrs:{to:{name:"view.orders.detail",params:{order_id:n.order_id}}}},[e("a-tooltip",[e("template",{slot:"title"},[t._v(t._s(r))]),e("span",{staticClass:"title-text"},[t._v(t._s(r))])],2)],1),e("div",{staticClass:"title-meta"},[e("a-icon",{attrs:{type:"clock-circle"}}),e("span",[t._v(t._s(n.created_at))])],1)],1)}},{key:"environment",fn:function(r){return e("span",{},[e("a-tag",[e("a-icon",{attrs:{type:"cloud"}}),t._v(" "+t._s(r)+" ")],1)],1)}},{key:"sql_type",fn:function(r){return e("span",{},[e("span","EXPORT"===r?[t._v("数据导出")]:[t._v(t._s(r))])])}},{key:"instance",fn:function(r,n){return e("span",{staticClass:"instance-cell"},[e("div",{staticClass:"instance-info"},[e("a-icon",{attrs:{type:"link"}}),e("span",{staticClass:"instance-name"},[t._v(t._s(r))])],1),e("div",{staticClass:"schema-info"},[e("a-icon",{attrs:{type:"database"}}),e("span",{staticClass:"schema-name"},[t._v(t._s(n.schema))])],1)])}},{key:"approver",fn:function(r){return e("span",{},t._l(r,(function(r){return e("div",{key:r.user+r.status},[e("a-icon",{style:{color:"pending"===r.status?"#fa1a16":"#52c41a"},attrs:{type:"pending"===r.status?"clock-circle":"check-circle"}}),e("span",{staticClass:"user-text",style:{color:"pending"===r.status?"#fa1a16":"#52c41a"}},[t._v(" "+t._s(r.user)+" ")])],1)})),0)}},{key:"reviewer",fn:function(r){return e("span",{},t._l(r,(function(r){return e("div",{key:r.user+r.status},[e("a-icon",{style:{color:"pending"===r.status?"#fa1a16":"#52c41a"},attrs:{type:"pending"===r.status?"clock-circle":"check-circle"}}),e("span",{staticClass:"user-text",style:{color:"pending"===r.status?"#fa1a16":"#52c41a"}},[t._v(" "+t._s(r.user)+" ")])],1)})),0)}}])},[e("span",{attrs:{slot:"customApplicant"},slot:"customApplicant"},[e("a-tooltip",{attrs:{placement:"topLeft",title:"工单申请人","arrow-point-at-center":""}},[t._v(" 申请人")])],1)])],1)},a=[],s=r(23711),o=(r(41539),r(74916),r(64765),r(72701)),i=r(20629),c=[{title:"进度",dataIndex:"progress",key:"progress",width:100,fixed:"left",scopedSlots:{customRender:"progress"}},{title:"标题",dataIndex:"order_title",key:"order_title",width:300,fixed:"left",ellipsis:!0,scopedSlots:{customRender:"order_title"}},{dataIndex:"applicant",key:"applicant",ellipsis:!0,slots:{title:"customApplicant"},scopedSlots:{customRender:"applicant"}},{title:"组织",dataIndex:"organization",key:"organization",ellipsis:!0,scopedSlots:{customRender:"organization"}},{title:"工单环境",dataIndex:"environment",key:"environment",ellipsis:!0,scopedSlots:{customRender:"environment"}},{title:"工单类型",dataIndex:"sql_type",key:"sql_type",scopedSlots:{customRender:"sql_type"}},{title:"实例/库",dataIndex:"instance",key:"instance",scopedSlots:{customRender:"instance"}},{title:"审核人",dataIndex:"approver",key:"approver",scopedSlots:{customRender:"approver"}},{title:"复核人",dataIndex:"reviewer",key:"reviewer",scopedSlots:{customRender:"reviewer"}}],l={computed:(0,s.Z)({},(0,i.Se)(["sqlState"])),data:function(){return{loading:!1,onlyMyOrders:!1,environments:[],progs:["待审核","已驳回","已批准","执行中","已关闭","已完成","已复核"],tableColumns:c,tableData:[],pagination:{current:1,pageSize:10,total:0,pageSizeOptions:["10","20"],showSizeChanger:!0},form:this.$form.createForm(this,{name:"list"})}},methods:(0,s.Z)((0,s.Z)({},(0,i.nv)(["storeMyOrder"])),{},{onMyChange:function(t){this.storeMyOrder(t?"ON":"OFF"),this.onlyMyOrders="ON"==this.sqlState.orders.my_order,this.pagination.current=1,this.pagination.pageSize=10,this.pagination.total=0,this.getList()},getProgressTagColor:function(t){var e={"待审核":"blue","已驳回":"red","已关闭":"red","已批准":"orange","已复核":"purple","执行中":"pink","已完成":"green"};return e[t]||"default"},getProgressIcon:function(t){var e={"待审核":"clock-circle","已驳回":"close-circle","已关闭":"stop","已批准":"check-circle","已复核":"audit","执行中":"loading","已完成":"check-circle"};return e[t]||"question-circle"},getList:function(){var t=this;this.loading=!0;var e=(0,s.Z)({page_size:this.pagination.pageSize,page:this.pagination.current,is_page:!0,only_my_orders:!0===this.onlyMyOrders?1:0},this.filters);(0,o.el)(e).then((function(e){void 0!=e&&(t.pagination.total=e.total,t.tableData=e.data)})).catch((function(t){})).finally((function(){t.loading=!1}))},getEnvironments:function(){var t=this;(0,o.hS)({is_page:!1}).then((function(e){t.environments=e.data})).catch((function(t){}))},editRow:function(t){this.$refs.RolesEditComponent.show(t)},onAdd:function(){this.$refs.RolesAddComponent.show()},handleTableChange:function(t){this.pagination.current=t.current,this.pagination.pageSize=t.pageSize,this.getList()},handleSearch:function(t){var e=this;t.preventDefault(),this.form.validateFields((function(t,r){t||(e.filters=(0,s.Z)({search:r["search"]},r),e.pagination.current=1,e.getList())}))}}),destroyed:function(){clearInterval(this.timer)},mounted:function(){var t=this;this.getEnvironments(),"ON"==this.sqlState.orders.my_order&&(this.onlyMyOrders=!0),this.getList(),this.timer&&clearInterval(this.timer),this.timer=setInterval((function(){setTimeout(t.getList(),0)}),3e4)}},u=l,p=r(1001),d=(0,p.Z)(u,n,a,!1,null,"14c7954b",null),f=d.exports},72701:function(t,e,r){r.d(e,{$W:function(){return _},E5:function(){return s},EE:function(){return v},M0:function(){return l},QU:function(){return d},Xu:function(){return p},ci:function(){return g},eU:function(){return f},el:function(){return u},gc:function(){return k},gg:function(){return o},hS:function(){return a},jb:function(){return w},kK:function(){return S},l5:function(){return y},pl:function(){return h},u7:function(){return c},um:function(){return m},xE:function(){return i},xZ:function(){return C}});var n=r(34820),a=function(t){return n.ZP.request({url:"/api/v1/orders/environments",method:"get",params:t})},s=function(t){return n.ZP.request({url:"/api/v1/orders/instances",method:"get",params:t})},o=function(t){return n.ZP.request({url:"/api/v1/orders/schemas",method:"get",params:t})},i=function(t){return n.ZP.request({url:"/api/v1/orders/users",method:"get",params:t})},c=function(t){return n.ZP.request({url:"/api/v1/orders/syntax-inspect",method:"post",data:t})},l=function(t){return n.ZP.request({url:"/api/v1/orders/commit",method:"post",data:t})},u=function(t){return n.ZP.request({url:"/api/v1/orders/list",method:"get",params:t})},p=function(t){return n.ZP.request({url:"/api/v1/orders/detail/".concat(t),method:"get",params:t})},d=function(t){return n.ZP.request({url:"/api/v1/orders/detail/oplogs",method:"get",params:t})},f=function(t){return n.ZP.request({url:"/api/v1/orders/operate/approve",method:"put",data:t})},h=function(t){return n.ZP.request({url:"/api/v1/orders/operate/feedback",method:"put",data:t})},m=function(t){return n.ZP.request({url:"/api/v1/orders/operate/review",method:"put",data:t})},v=function(t){return n.ZP.request({url:"/api/v1/orders/operate/close",method:"put",data:t})},g=function(t){return n.ZP.request({url:"/api/v1/orders/hook",method:"post",data:t})},y=function(t){return n.ZP.request({url:"/api/v1/orders/generate-tasks",method:"post",data:t})},_=function(t){return n.ZP.request({url:"/api/v1/orders/tasks/".concat(t.order_id),method:"get",params:t})},k=function(t){return n.ZP.request({url:"/api/v1/orders/tasks/preview",method:"get",params:t})},w=function(t){return n.ZP.request({url:"/api/v1/orders/tasks/execute-single",method:"post",data:t})},C=function(t){return n.ZP.request({url:"/api/v1/orders/tasks/execute-all",method:"post",data:t})},S=function(t){return n.ZP.request({url:"/api/v1/orders/download/exportfile/".concat(t),method:"get",responseType:"blob"})}}}]);