"use strict";(self["webpackChunkvue_antd_pro"]=self["webpackChunkvue_antd_pro"]||[]).push([[221],{44221:function(e,t,a){a.r(t),a.d(t,{default:function(){return y}});var n=function(){var e=this,t=e._self._c;return t("div",[t("a-alert",{attrs:{message:"库表权限说明",type:"info","show-icon":""}},[t("p",{attrs:{slot:"description"},slot:"description"},[t("ul",[t("li",[e._v("列表为空，表示用户有当前库所有表的访问权限")]),t("li",[e._v("允许用户访问当前库指定的一张或多张表时，请添加allow规则，没有指定allow规则的表不允许访问")]),t("li",[e._v("不允许用户访问当前库指定的一张或多张表时，请设置deny规则，没有指定deny规则的表允许访问")]),t("li",[e._v("当列表中有allow和deny规则时，仅allow规则生效，deny规则不生效，表示当前用户仅允许访问有allow规则的表")])])])]),t("a-card",{staticStyle:{"margin-top":"8px"},attrs:{title:e.cardTitle}},[t("a-form",{attrs:{layout:"inline",form:e.form},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}}},[t("a-form-item",[t("a-input-search",{directives:[{name:"decorator",rawName:"v-decorator",value:["search"],expression:"['search']"}],staticStyle:{width:"300px"},attrs:{allowClear:"",placeholder:"输入要查询内容"}})],1),t("a-form-item",[t("span",{staticClass:"table-page-search-submitButtons"},[t("a-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")])],1)]),t("a-form-item",{staticStyle:{float:"right","margin-right":"0px"}},[t("a-button",{attrs:{type:"primary"},on:{click:e.onAdd}},[t("a-icon",{attrs:{type:"plus"}}),e._v("新增")],1)],1)],1),t("a-table",{attrs:{columns:e.tableColumns,rowKey:function(e,t){return t},dataSource:e.tableData,pagination:e.pagination,loading:e.loading,size:"middle"},on:{change:e.handleTableChange},scopedSlots:e._u([{key:"rule",fn:function(a){return t("span",{},[t("a-tag","allow"===a?{attrs:{color:"blue"}}:{attrs:{color:"red"}},[e._v(" "+e._s(a)+" ")])],1)}},{key:"action",fn:function(a,n){return t("span",{},[t("div",{staticClass:"editable-row-operations"},[t("a",{attrs:{type:"dashed"},on:{click:function(t){return e.DeleteConfirm(n.id)}}},[t("span",{staticStyle:{color:"#409eff"}},[e._v("删除")])])])])}}])}),t("DasTablesPermAddComponent",{ref:"DasTablesPermAddComponent",attrs:{inputData:this.$route.params},on:{refreshTable:e.getAdminTablesListGrant}})],1)],1)},r=[],s=a(23711),i=(a(92222),a(41539),a(74916),a(64765),a(86325)),o=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"新增表权限",width:"55%","on-ok":"onSubmit"},on:{cancel:e.handleCancel},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("template",{slot:"footer"},[t("a-button",{key:"back",on:{click:e.handleCancel}},[e._v("取消")]),t("a-button",{key:"submit",attrs:{type:"primary",loading:e.loading},on:{click:e.onSubmit}},[e._v("确定")])],1),t("a-form",{attrs:{form:e.form,"label-col":{span:4},"wrapper-col":{span:18}}},[t("a-form-item",{attrs:{label:"表名","has-feedback":""}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["tables",{rules:[{required:!0,message:"请选择表名"}]}],expression:"['tables', { rules: [{ required: true, message: '请选择表名' }] }]"}],attrs:{placeholder:"请选择表名",allowClear:"",mode:"multiple","show-search":""}},e._l(e.tables,(function(a,n){return t("a-select-option",{key:n,attrs:{label:a,value:a}},[e._v(" "+e._s(a)+" ")])})),1)],1),t("a-form-item",{attrs:{label:"规则","has-feedback":""}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["rule",{rules:[{required:!0,message:"请选择规则"}]}],expression:"['rule', { rules: [{ required: true, message: '请选择规则' }] }]"}],attrs:{placeholder:"请选择规则",allowClear:""}},e._l(e.Rules,(function(a,n){return t("a-select-option",{key:n,attrs:{label:a,value:a}},[e._v(" "+e._s(a)+" ")])})),1)],1)],1)],2)},u=[],l=(a(54747),["allow","deny"]),c={props:{inputData:Object},data:function(){return{visible:!1,loading:!1,tables:[],Rules:l,form:this.$form.createForm(this,{name:"dasTablesPermAdd"})}},methods:{showModal:function(e){this.form.resetFields(),this.getTables(e),this.visible=!0},handleCancel:function(e){this.visible=!1},getTables:function(e){var t=this;this.tables=[];var a={instance_id:e.instance_id,schema:e.schema};(0,i.Q4)(a).then((function(e){if("0001"===e.code)return t.$notification.error({title:"加载表失败，请稍后重试",message:e.message}),!1;e.data.forEach((function(e){t.tables.push(e.table_name)}))})).catch((function(e){}))},createAdminTablesGrants:function(e){var t=this,a=(0,s.Z)((0,s.Z)({},e),this.inputData);(0,i.a5)(a).then((function(e){var a="0000"===e.code?"info":"error";t.$message[a](e.message)})).catch((function(e){})).finally((function(){t.handleCancel(),t.$emit("refreshTable")}))},onSubmit:function(e){var t=this;this.loading=!0,e.preventDefault(),this.form.validateFields((function(e,a){e||t.createAdminTablesGrants(a)})),this.loading=!1}}},d=c,m=a(1001),f=(0,m.Z)(d,o,u,!1,null,null,null),p=f.exports,h=[{title:"规则",dataIndex:"rule",key:"rule",scopedSlots:{customRender:"rule"}},{title:"用户",dataIndex:"username",key:"username",scopedSlots:{customRender:"username"}},{title:"库名",dataIndex:"schema",key:"schema",scopedSlots:{customRender:"schema"}},{title:"表名",dataIndex:"table",key:"table",scopedSlots:{customRender:"table"}},{title:"创建时间",dataIndex:"created_at",key:"created_at",scopedSlots:{customRender:"created_at"}},{title:"更新时间",dataIndex:"updated_at",key:"updated_at",scopedSlots:{customRender:"updated_at"}},{title:"操作",dataIndex:"action",key:"action",scopedSlots:{customRender:"action"}}],g={components:{DasTablesPermAddComponent:p},data:function(){return{loading:!1,cardTitle:"用户".concat(this.$route.params.username,"当前").concat(this.$route.params.schema,"库的表权限列表"),tableColumns:h,tableData:[],pagination:{current:1,pageSize:10,total:0,pageSizeOptions:["10","20"],showSizeChanger:!0},form:this.$form.createForm(this,{name:"dasTablesPerm"})}},methods:{getAdminTablesListGrant:function(){var e=this;this.loading=!0;var t=(0,s.Z)({page_size:this.pagination.pageSize,page:this.pagination.current,is_page:!0,instance_id:this.$route.params.instance_id,username:this.$route.params.username,schema:this.$route.params.schema},this.filters);(0,i.E0)(t).then((function(t){e.pagination.total=t.total,e.tableData=t.data})).finally((function(){e.loading=!1}))},onAdd:function(){this.$refs.DasTablesPermAddComponent.showModal(this.$route.params)},DeleteConfirm:function(e){var t=this;this.$confirm({title:"警告",content:"你确定删除？",okText:"Yes",okType:"danger",cancelText:"No",onOk:function(){(0,i.dN)(e).then((function(e){"0001"===e.code?t.$message.warning(e.message):t.$message.info(e.message)})).finally((function(){t.getAdminTablesListGrant()}))},onCancel:function(){}})},handleTableChange:function(e){this.pagination.current=e.current,this.pagination.pageSize=e.pageSize,this.getAdminTablesListGrant()},handleSearch:function(e){var t=this;e.preventDefault(),this.form.validateFields((function(e,a){e||(t.filters={search:a["search"]},t.pagination.current=1,t.getAdminTablesListGrant())}))}},mounted:function(){this.getAdminTablesListGrant()}},v=g,b=(0,m.Z)(v,n,r,!1,null,"343fa15c",null),y=b.exports},86325:function(e,t,a){a.d(t,{AK:function(){return b},E0:function(){return y},Fh:function(){return v},Fx:function(){return u},HX:function(){return P},NA:function(){return h},OR:function(){return l},Q4:function(){return w},TH:function(){return g},a5:function(){return _},dN:function(){return k},g2:function(){return f},gg:function(){return r},h7:function(){return d},rK:function(){return o},s1:function(){return c},sk:function(){return q},tv:function(){return s},ty:function(){return m},v_:function(){return p},zv:function(){return i}});var n=a(34820),r=function(e){return n.ZP.request({url:"/api/v1/das/schemas",method:"get",params:e})},s=function(e){return n.ZP.request({url:"/api/v1/das/tables",method:"get",params:e})},i=function(e){return n.ZP.request({url:"/api/v1/das/execute/query/mysql",method:"post",data:e})},o=function(e){return n.ZP.request({url:"/api/v1/das/execute/query/clickhouse",method:"post",data:e})},u=function(e){return n.ZP.request({url:"/api/v1/das/user/grants",method:"get",params:e})},l=function(e){return n.ZP.request({url:"/api/v1/das/dbdict",method:"get",params:e})},c=function(e){return n.ZP.request({url:"/api/v1/das/history",method:"get",params:e})},d=function(e){return n.ZP.request({url:"/api/v1/das/favorites",method:"get",params:e})},m=function(e){return n.ZP.request({url:"/api/v1/das/favorites",method:"post",data:e})},f=function(e){return n.ZP.request({url:"/api/v1/das/favorites/".concat(e.id),method:"put",data:e})},p=function(e){return n.ZP.request({url:"/api/v1/das/favorites/".concat(e),method:"delete",data:e})},h=function(e){return n.ZP.request({url:"/api/v1/das/table-info",method:"get",params:e})},g=function(e){return n.ZP.request({url:"/api/v1/das/admin/schemas/grant",method:"get",params:e})},v=function(e){return n.ZP.request({url:"/api/v1/das/admin/schemas/grant",method:"post",data:e})},b=function(e){return n.ZP.request({url:"/api/v1/das/admin/schemas/grant/".concat(e),method:"delete",data:e})},y=function(e){return n.ZP.request({url:"/api/v1/das/admin/tables/grant",method:"get",params:e})},_=function(e){return n.ZP.request({url:"/api/v1/das/admin/tables/grant",method:"post",data:e})},k=function(e){return n.ZP.request({url:"/api/v1/das/admin/tables/grant/".concat(e),method:"delete",data:e})},q=function(e){return n.ZP.request({url:"/api/v1/das/admin/instances/list",method:"get",params:e})},P=function(e){return n.ZP.request({url:"/api/v1/das/admin/schemas/list",method:"get",params:e})},w=function(e){return n.ZP.request({url:"/api/v1/das/admin/tables/list",method:"get",params:e})}}}]);