"use strict";(self["webpackChunkvue_antd_pro"]=self["webpackChunkvue_antd_pro"]||[]).push([[336],{68336:function(e,t,a){a.r(t),a.d(t,{default:function(){return Ze}});var n=function(){var e=this,t=e._self._c;return t("a-card",[t("a-tabs",{attrs:{type:"card",size:"small"}},[t("a-tab-pane",{key:"1",attrs:{tab:"用户"}},[t("UsersComponent")],1),t("a-tab-pane",{key:"2",attrs:{tab:"角色"}},[t("RolesComponent")],1),t("a-tab-pane",{key:"3",attrs:{tab:"组织"}},[t("OrganizationsComponent")],1)],1)],1)},i=[],r=function(){var e=this,t=e._self._c;return t("a-card",[t("a-row",{attrs:{gutter:16}},[t("a-col",{staticClass:"gutter-row",attrs:{span:e.nodeUsersVisible?10:24}},[t("a-card",{staticClass:"box-card",attrs:{title:"组织列表"}},[t("a-button",{attrs:{slot:"extra",type:"primary"},on:{click:function(t){return e.addRootNode()}},slot:"extra"},[t("a-icon",{attrs:{type:"plus"}}),e._v(" 新增根节点 ")],1),t("a-tree",{attrs:{blockNode:"","tree-data":e.treeData,"show-icon":"",expandedKeys:e.expandedKeys},on:{select:e.onSelect,"update:expandedKeys":function(t){e.expandedKeys=t},"update:expanded-keys":function(t){e.expandedKeys=t}},scopedSlots:e._u([{key:"custom",fn:function(a){return[t("span",[e._v(e._s(a.title))]),t("a-tooltip",[t("template",{slot:"title"},[e._v(" 新增子节点 ")]),t("a",{staticClass:"btn-type",staticStyle:{right:"80px"},attrs:{type:"btn"},on:{click:function(t){return e.addChildNode(a)}}},[t("a-icon",{attrs:{type:"plus-circle"}})],1)],2),t("a-tooltip",[t("template",{slot:"title"},[e._v(" 编辑当前节点 ")]),t("a",{staticClass:"btn-type",staticStyle:{right:"50px"},attrs:{type:"btn"},on:{click:function(t){return e.editChildNode(a)}}},[t("a-icon",{attrs:{type:"edit"}})],1)],2),t("a-tooltip",[t("template",{slot:"title"},[e._v(" 删除当前节点 ")]),t("a",{staticClass:"btn-type",attrs:{type:"btn"},on:{click:function(t){return e.DeleteConfirm(a)}}},[t("a-icon",{attrs:{type:"delete"}})],1)],2)]}}])},[t("a-icon",{attrs:{slot:"dir",type:"apartment"},slot:"dir"})],1)],1)],1),t("a-col",{directives:[{name:"show",rawName:"v-show",value:e.nodeUsersVisible,expression:"nodeUsersVisible"}],staticClass:"gutter-row",attrs:{span:e.nodeUsersVisible?14:0}},[t("NodeUsers",{ref:"NodeUsers",attrs:{nodeKey:e.nodeKey}})],1),t("RootNodeAddComponent",{ref:"RootNodeAddComponent",on:{refresh:e.getOrganizations}}),t("ChildNodeAddComponent",{ref:"ChildNodeAddComponent",on:{refresh:e.getOrganizations}}),t("NodeEditComponent",{ref:"NodeEditComponent",on:{refresh:e.getOrganizations}})],1)],1)},o=[],s=(a(41539),a(94688)),l=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"新增根节点",width:"55%","on-ok":"onSubmit"},on:{cancel:e.handleCancel},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("template",{slot:"footer"},[t("a-button",{key:"back",on:{click:e.handleCancel}},[e._v("取消")]),t("a-button",{key:"submit",attrs:{type:"primary",loading:e.loading},on:{click:e.onSubmit}},[e._v("确定")])],1),t("a-form",{attrs:{form:e.form,"label-col":{span:4},"wrapper-col":{span:18}}},[t("a-form-item",{attrs:{label:"组织名","has-feedback":""}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,min:2,max:32}],validateTrigger:"blur"}],expression:"[\n          'name',\n          {\n            rules: [{ required: true, min: 2, max: 32 }],\n            validateTrigger: 'blur',\n          },\n        ]"}]},[t("a-icon",{staticStyle:{color:"rgba(0, 0, 0, 0.25)"},attrs:{slot:"prefix",type:"apartment"},slot:"prefix"})],1)],1)],1)],2)},c=[],u={data:function(){return{visible:!1,loading:!1,form:this.$form.createForm(this,{name:"rootNodeAdd"})}},methods:{showModal:function(){this.form.resetFields(),this.visible=!0},handleCancel:function(e){this.visible=!1},createRootOrganizations:function(e){var t=this;(0,s.EP)(e).then((function(e){var a="0000"===e.code?"info":"error";t.$message[a](e.message)})).catch((function(e){})).finally((function(){t.visible=!1,t.loading=!1,t.$emit("refresh")}))},onSubmit:function(e){var t=this;this.loading=!0,e.preventDefault(),this.form.validateFields((function(e,a){e||t.createRootOrganizations(a)})),this.loading=!1}}},d=u,m=a(1001),f=(0,m.Z)(d,l,c,!1,null,null,null),p=f.exports,h=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"新增子节点",width:"55%","on-ok":"onSubmit"},on:{cancel:e.handleCancel},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("template",{slot:"footer"},[t("a-button",{key:"back",on:{click:e.handleCancel}},[e._v("取消")]),t("a-button",{key:"submit",attrs:{type:"primary",loading:e.loading},on:{click:e.onSubmit}},[e._v("确定")])],1),t("a-form",{attrs:{form:e.form,"label-col":{span:4},"wrapper-col":{span:18}}},[t("a-form-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{label:"父key"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["parent_node_key"],expression:"['parent_node_key']"}]})],1),t("a-form-item",{attrs:{label:"父节点"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["parent_node_name"],expression:"['parent_node_name']"}],attrs:{disabled:""}},[t("a-icon",{staticStyle:{color:"rgba(0, 0, 0, 0.25)"},attrs:{slot:"prefix",type:"apartment"},slot:"prefix"})],1)],1),t("a-form-item",{attrs:{label:"组织名","has-feedback":""}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,min:2,max:32}],validateTrigger:"blur"}],expression:"[\n          'name',\n          {\n            rules: [{ required: true, min: 2, max: 32 }],\n            validateTrigger: 'blur',\n          },\n        ]"}]},[t("a-icon",{staticStyle:{color:"rgba(0, 0, 0, 0.25)"},attrs:{slot:"prefix",type:"apartment"},slot:"prefix"})],1)],1)],1)],2)},v=[],g={data:function(){return{visible:!1,loading:!1,form:this.$form.createForm(this,{name:"childNodesAdd"})}},methods:{showModal:function(e){var t=this;this.form.resetFields(),this.$nextTick((function(){setTimeout((function(){var a={parent_node_key:e.key,parent_node_name:e.title};t.form.setFieldsValue(a)}))})),this.visible=!0},handleCancel:function(e){this.visible=!1},createChildOrganizations:function(e){var t=this;(0,s.vp)(e).then((function(e){var a="0000"===e.code?"info":"error";t.$message[a](e.message)})).finally((function(){t.visible=!1,t.loading=!1,t.$emit("refresh")}))},onSubmit:function(e){var t=this;this.loading=!0,e.preventDefault(),this.form.validateFields((function(e,a){e||t.createChildOrganizations(a)})),this.loading=!1}}},b=g,y=(0,m.Z)(b,h,v,!1,null,null,null),_=y.exports,k=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"编辑节点",width:"55%","on-ok":"onSubmit"},on:{cancel:e.handleCancel},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("template",{slot:"footer"},[t("a-button",{key:"back",on:{click:e.handleCancel}},[e._v("取消")]),t("a-button",{key:"submit",attrs:{type:"primary",loading:e.loading},on:{click:e.onSubmit}},[e._v("确定")])],1),t("a-form",{attrs:{form:e.form,"label-col":{span:4},"wrapper-col":{span:18}}},[t("a-form-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{label:"key","has-feedback":""}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["key"],expression:"['key']"}]})],1),t("a-form-item",{attrs:{label:"组织名","has-feedback":""}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,min:2,max:32}],validateTrigger:"blur"}],expression:"[\n          'name',\n          {\n            rules: [{ required: true, min: 2, max: 32 }],\n            validateTrigger: 'blur',\n          },\n        ]"}]},[t("a-icon",{staticStyle:{color:"rgba(0, 0, 0, 0.25)"},attrs:{slot:"prefix",type:"apartment"},slot:"prefix"})],1)],1)],1)],2)},x=[],w={data:function(){return{visible:!1,loading:!1,form:this.$form.createForm(this,{name:"nodeEdit"})}},methods:{showModal:function(e){var t=this;this.form.resetFields(),this.$nextTick((function(){setTimeout((function(){var a={key:e.key,name:e.title};t.form.setFieldsValue(a)}))})),this.visible=!0},handleCancel:function(e){this.visible=!1},updateOrganizations:function(e){var t=this;(0,s.QQ)(e).then((function(e){var a="0000"===e.code?"info":"error";t.$message[a](e.message)})).catch((function(e){})).finally((function(){t.visible=!1,t.loading=!1,t.$emit("refresh")}))},onSubmit:function(e){var t=this;this.loading=!0,e.preventDefault(),this.form.validateFields((function(e,a){e||t.updateOrganizations(a)})),this.loading=!1}}},S=w,C=(0,m.Z)(S,k,x,!1,null,null,null),N=C.exports,z=function(){var e=this,t=e._self._c;return t("a-card",{staticClass:"box-card"},[t("a-form",{attrs:{layout:"inline",form:e.form},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}}},[t("a-form-item",[t("a-input-search",{directives:[{name:"decorator",rawName:"v-decorator",value:["search"],expression:"['search']"}],staticStyle:{width:"300px"},attrs:{allowClear:"",placeholder:"请输入要查询的用户名"}})],1),t("a-form-item",[t("span",{staticClass:"table-page-search-submitButtons"},[t("a-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")])],1)]),t("a-form-item",{staticStyle:{float:"right","margin-right":"0px"}},[t("a-button",{attrs:{type:"primary"},on:{click:e.onAdd}},[t("a-icon",{attrs:{type:"plus"}}),e._v("绑定用户")],1)],1)],1),t("a-table",{attrs:{columns:e.tableColumns,rowKey:function(e,t){return t},dataSource:e.tableData,pagination:e.pagination,loading:e.loading,size:"middle"},on:{change:e.handleTableChange},scopedSlots:e._u([{key:"action",fn:function(a,n){return t("span",{},[t("div",{staticClass:"editable-row-operations"},[t("a",{attrs:{type:"dashed"},on:{click:function(t){return e.DeleteConfirm(n)}}},[t("span",{staticStyle:{color:"#409eff"}},[e._v("删除")])])])])}}])}),t("NodeUsersAdd",{ref:"NodeUsersAdd",on:{refresh:e.getOrganizationsUsers}})],1)},T=[],$=a(23711),q=(a(74916),a(64765),function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"新增用户",width:"55%","on-ok":"onSubmit"},on:{cancel:e.handleCancel},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("template",{slot:"footer"},[t("a-button",{key:"back",on:{click:e.handleCancel}},[e._v("取消")]),t("a-button",{key:"submit",attrs:{type:"primary",loading:e.loading},on:{click:e.onSubmit}},[e._v("确定")])],1),t("a-form",{attrs:{form:e.form,"label-col":{span:4},"wrapper-col":{span:18}}},[t("a-form-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{label:"节点Key"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["key"],expression:"['key']"}]})],1),t("a-form-item",{attrs:{label:"用户"}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["users"],expression:"['users']"}],attrs:{mode:"multiple",placeholder:"请选择用户","show-search":""}},e._l(e.users,(function(a,n){return t("a-select-option",{key:n,attrs:{label:a.username,value:a.uid}},[e._v(" "+e._s(a.username)+" ")])})),1)],1)],1)],2)}),U=[],R={data:function(){return{visible:!1,loading:!1,users:[],form:this.$form.createForm(this,{name:"nodeUsersAdd"})}},methods:{showModal:function(e){var t=this;this.form.resetFields(),this.$nextTick((function(){setTimeout((function(){var a={key:e};t.form.setFieldsValue(a)}))})),this.getUsers(),this.visible=!0},handleCancel:function(e){this.visible=!1},getUsers:function(){var e=this;this.loading=!0;var t={is_page:!1};(0,s.xE)(t).then((function(t){e.users=t.data})).catch((function(e){})).finally((function(){e.loading=!1}))},bindOrganizationsUsers:function(e){var t=this;(0,s.nk)(e).then((function(e){var a="0000"===e.code?"info":"error";t.$message[a](e.message)})).catch((function(e){})).finally((function(){t.visible=!1,t.loading=!1,t.$emit("refresh")}))},onSubmit:function(e){var t=this;this.loading=!0,e.preventDefault(),this.form.validateFields((function(e,a){e||t.bindOrganizationsUsers(a)})),this.loading=!1}}},E=R,O=(0,m.Z)(E,q,U,!1,null,null,null),F=O.exports,P=[{title:"用户",dataIndex:"username",key:"username",scopedSlots:{customRender:"username"}},{title:"组织",dataIndex:"organization_name",key:"organization_name",scopedSlots:{customRender:"organization_name"}},{title:"操作",dataIndex:"action",key:"action",scopedSlots:{customRender:"action"}}],A={components:{NodeUsersAdd:F},props:{nodeKey:String},data:function(){return{loading:!1,tableColumns:P,tableData:[],pagination:{current:1,pageSize:10,total:0,pageSizeOptions:["10","20"],showSizeChanger:!0},form:this.$form.createForm(this,{name:"nodeUsers"})}},methods:{getOrganizationsUsers:function(){var e=this;this.loading=!0;var t=(0,$.Z)({page_size:this.pagination.pageSize,page:this.pagination.current,is_page:!0,key:this.nodeKey},this.filters);(0,s.BQ)(t).then((function(t){e.pagination.total=t.total,e.tableData=t.data})).finally((function(){e.loading=!1}))},onAdd:function(){this.$refs.NodeUsersAdd.showModal(this.nodeKey)},DeleteConfirm:function(e){var t=this;this.$confirm({title:"警告",content:"你确定删除？",okText:"Yes",okType:"danger",cancelText:"No",onOk:function(){var a={key:e.organization_key,uid:e.uid};(0,s.MF)(a).then((function(e){"0001"===e.code?t.$message.warning(e.message):t.$message.info(e.message)})).catch((function(e){})).finally((function(){t.getOrganizationsUsers()}))},onCancel:function(){}})},handleTableChange:function(e){this.pagination.current=e.current,this.pagination.pageSize=e.pageSize,this.getOrganizationsUsers()},handleSearch:function(e){var t=this;e.preventDefault(),this.form.validateFields((function(e,a){e||(t.filters={search:a["search"]},t.pagination.current=1,t.getOrganizationsUsers())}))}}},Z=A,D=(0,m.Z)(Z,z,T,!1,null,"63e394f0",null),Y=D.exports,V={components:{RootNodeAddComponent:p,ChildNodeAddComponent:_,NodeEditComponent:N,NodeUsers:Y},data:function(){return{loading:!1,treeData:[],expandedKeys:[],nodeKey:"",nodeUsersVisible:!1}},methods:{addRootNode:function(){this.$refs.RootNodeAddComponent.showModal()},addChildNode:function(e){this.$refs.ChildNodeAddComponent.showModal(e)},editChildNode:function(e){this.$refs.NodeEditComponent.showModal(e)},onSelect:function(e,t,a){var n=this;t.selected?(this.nodeKey=e[0],this.$nextTick((function(){n.$refs.NodeUsers.getOrganizationsUsers()})),this.nodeUsersVisible=!0):this.nodeUsersVisible=!1},getOrganizations:function(){var e=this;this.loading=!0,(0,s.xY)().then((function(t){e.treeData=t.data})).catch((function(e){})).finally((function(){e.loading=!1}))},DeleteConfirm:function(e){var t=this;this.$confirm({title:"警告",content:"你确定删除？这将会删除当前节点所有的子节点！！！",okText:"Yes",okType:"danger",cancelText:"No",onOk:function(){var a={key:e.key,name:e.title};(0,s.Ly)(a).then((function(e){"0001"===e.code?t.$message.warning(e.message):t.$message.info(e.message)})).catch((function(e){})).finally((function(){t.getOrganizations()}))},onCancel:function(){}})}},mounted:function(){this.getOrganizations()}},I=V,M=(0,m.Z)(I,r,o,!1,null,"2a7aafa2",null),K=M.exports,Q=function(){var e=this,t=e._self._c;return t("a-card",[t("a-form",{attrs:{layout:"inline",form:e.form},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}}},[t("a-form-item",[t("a-input-search",{directives:[{name:"decorator",rawName:"v-decorator",value:["search"],expression:"['search']"}],staticStyle:{width:"300px"},attrs:{allowClear:"",placeholder:"输入要查询内容"}})],1),t("a-form-item",[t("span",{staticClass:"table-page-search-submitButtons"},[t("a-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")])],1)]),t("a-form-item",{staticStyle:{float:"right","margin-right":"0px"}},[t("a-button",{attrs:{type:"primary"},on:{click:e.onAdd}},[t("a-icon",{attrs:{type:"plus"}}),e._v(" 新增 ")],1)],1)],1),t("a-table",{attrs:{columns:e.tableColumns,rowKey:function(e,t){return t},dataSource:e.tableData,pagination:e.pagination,loading:e.loading,size:"middle"},on:{change:e.handleTableChange},scopedSlots:e._u([{key:"action",fn:function(a,n){return t("span",{},[t("div",{staticClass:"editable-row-operations"},[t("a",{on:{click:function(){return e.editRow(n)}}},[t("span",{staticStyle:{color:"#409eff"}},[e._v("编辑")])]),t("a-divider",{attrs:{type:"vertical"}}),t("a",{attrs:{type:"dashed"},on:{click:function(t){return e.DeleteConfirm(n.id)}}},[t("span",{staticStyle:{color:"#409eff"}},[e._v("删除")])])],1)])}}])}),t("RolesAddComponent",{ref:"RolesAddComponent",on:{refreshTable:e.getRoles}}),t("RolesEditComponent",{ref:"RolesEditComponent",on:{refreshTable:e.getRoles}})],1)},B=[],G=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"新建角色",width:"55%","on-ok":"onSubmit"},on:{cancel:e.handleCancel},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("template",{slot:"footer"},[t("a-button",{key:"back",on:{click:e.handleCancel}},[e._v("取消")]),t("a-button",{key:"submit",attrs:{type:"primary",loading:e.loading},on:{click:e.onSubmit}},[e._v("确定")])],1),t("a-form",{attrs:{form:e.form,"label-col":{span:4},"wrapper-col":{span:18}}},[t("a-form-item",{attrs:{label:"角色名","has-feedback":""}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,min:2,max:32}],validateTrigger:"blur"}],expression:"[\n          'name',\n          {\n            rules: [{ required: true, min: 2, max: 32 }],\n            validateTrigger: 'blur',\n          },\n        ]"}]},[t("a-icon",{staticStyle:{color:"rgba(0, 0, 0, 0.25)"},attrs:{slot:"prefix",type:"heart"},slot:"prefix"})],1)],1)],1)],2)},j=[],L={data:function(){return{visible:!1,loading:!1,form:this.$form.createForm(this,{name:"rolesAdd"})}},methods:{showModal:function(){this.form.resetFields(),this.visible=!0},handleCancel:function(e){this.visible=!1},createRoles:function(e){var t=this;(0,s.ZS)(e).then((function(e){var a="0000"===e.code?"info":"error";t.$message[a](e.message)})).catch((function(e){})).finally((function(){t.visible=!1,t.loading=!1,t.$emit("refreshTable")}))},onSubmit:function(e){var t=this;this.loading=!0,e.preventDefault(),this.form.validateFields((function(e,a){e||t.createRoles(a)})),this.loading=!1}}},X=L,H=(0,m.Z)(X,G,j,!1,null,null,null),J=H.exports,W=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"编辑角色",width:"55%","on-ok":"onSubmit"},on:{cancel:e.handleCancel},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("template",{slot:"footer"},[t("a-button",{key:"back",on:{click:e.handleCancel}},[e._v("取消")]),t("a-button",{key:"submit",attrs:{type:"primary",loading:e.loading},on:{click:e.onSubmit}},[e._v("确定")])],1),t("a-form",{attrs:{form:e.form,"label-col":{span:4},"wrapper-col":{span:18}}},[t("a-form-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{label:"ID"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["id"],expression:"['id']"}]})],1),t("a-form-item",{attrs:{label:"角色名","has-feedback":""}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,min:2,max:32}],validateTrigger:"blur"}],expression:"[\n          'name',\n          {\n            rules: [{ required: true, min: 2, max: 32 }],\n            validateTrigger: 'blur',\n          },\n        ]"}]},[t("a-icon",{staticStyle:{color:"rgba(0, 0, 0, 0.25)"},attrs:{slot:"prefix",type:"heart"},slot:"prefix"})],1)],1)],1)],2)},ee=[],te=(a(68309),{data:function(){return{visible:!1,loading:!1,form:this.$form.createForm(this,{name:"rolesEdit"})}},methods:{showModal:function(e){var t=this;this.form.resetFields(),this.$nextTick((function(){setTimeout((function(){var a={id:e.id,name:e.name};t.form.setFieldsValue(a)}))})),this.visible=!0},handleCancel:function(e){this.visible=!1},updateRoles:function(e){var t=this;(0,s.P4)(e).then((function(e){var a="0000"===e.code?"info":"error";t.$message[a](e.message)})).catch((function(e){})).finally((function(){t.visible=!1,t.loading=!1,t.$emit("refreshTable")}))},onSubmit:function(e){var t=this;this.loading=!0,e.preventDefault(),this.form.validateFields((function(e,a){e||t.updateRoles(a)})),this.loading=!1}}}),ae=te,ne=(0,m.Z)(ae,W,ee,!1,null,null,null),ie=ne.exports,re=[{title:"角色",dataIndex:"name",key:"name",scopedSlots:{customRender:"name"}},{title:"创建时间",dataIndex:"created_at",key:"created_at",scopedSlots:{customRender:"created_at"}},{title:"更新时间",dataIndex:"updated_at",key:"updated_at",scopedSlots:{customRender:"updated_at"}},{title:"操作",dataIndex:"action",key:"action",scopedSlots:{customRender:"action"}}],oe={components:{RolesAddComponent:J,RolesEditComponent:ie},data:function(){return{loading:!1,tableColumns:re,tableData:[],pagination:{current:1,pageSize:10,total:0,pageSizeOptions:["10","20"],showSizeChanger:!0},form:this.$form.createForm(this,{name:"roles"})}},methods:{getRoles:function(){var e=this;this.loading=!0;var t=(0,$.Z)({page_size:this.pagination.pageSize,page:this.pagination.current,is_page:!0},this.filters);(0,s.G_)(t).then((function(t){e.pagination.total=t.total,e.tableData=t.data})).catch((function(e){})).finally((function(){e.loading=!1}))},editRow:function(e){this.$refs.RolesEditComponent.showModal(e)},onAdd:function(){this.$refs.RolesAddComponent.showModal()},DeleteConfirm:function(e){var t=this;this.$confirm({title:"警告",content:"你确定删除？",okText:"Yes",okType:"danger",cancelText:"No",onOk:function(){(0,s.ie)(e).then((function(e){"0001"===e.code?t.$message.warning(e.message):t.$message.info(e.message)})).catch((function(e){})).finally((function(){t.getRoles()}))},onCancel:function(){}})},handleTableChange:function(e){this.pagination.current=e.current,this.pagination.pageSize=e.pageSize,this.getRoles()},handleSearch:function(e){var t=this;e.preventDefault(),this.form.validateFields((function(e,a){e||(t.filters={search:a["search"]},t.pagination.current=1,t.getRoles())}))}},mounted:function(){this.getRoles()}},se=oe,le=(0,m.Z)(se,Q,B,!1,null,"553da4e0",null),ce=le.exports,ue=function(){var e=this,t=e._self._c;return t("a-card",[t("a-form",{attrs:{layout:"inline",form:e.form},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}}},[t("a-form-item",[t("a-cascader",{directives:[{name:"decorator",rawName:"v-decorator",value:["organization_key"],expression:"['organization_key']"}],staticStyle:{width:"350px"},attrs:{"field-names":{label:"title",value:"key",children:"children"},options:e.organizations,"change-on-select":"","expand-trigger":"hover",placeholder:"请选择组织"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"apartment"},slot:"suffixIcon"})],1)],1),t("a-form-item",[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["role_id"],expression:"['role_id']"}],staticStyle:{width:"200px"},attrs:{allowClear:"",placeholder:"请选择角色","show-search":""}},[e._l(e.roles,(function(a,n){return t("a-select-option",{key:n,attrs:{label:a.name,value:a.id}},[e._v(" "+e._s(a.name)+" ")])})),t("a-icon",{attrs:{slot:"suffixIcon",type:"user"},slot:"suffixIcon"})],2)],1),t("a-form-item",[t("a-input-search",{directives:[{name:"decorator",rawName:"v-decorator",value:["search"],expression:"['search']"}],staticStyle:{width:"300px"},attrs:{allowClear:"",placeholder:"请输入要查询内容"}})],1),t("a-form-item",[t("span",{staticClass:"table-page-search-submitButtons"},[t("a-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")])],1)]),t("a-form-item",{staticStyle:{float:"right","margin-right":"0px"}},[t("a-button",{attrs:{type:"primary"},on:{click:e.onAdd}},[t("a-icon",{attrs:{type:"plus"}}),e._v("新增")],1)],1)],1),t("a-table",{attrs:{columns:e.tableColumns,rowKey:function(e,t){return t},dataSource:e.tableData,pagination:e.pagination,loading:e.loading,size:"middle"},on:{change:e.handleTableChange},scopedSlots:e._u([{key:"is_active",fn:function(a){return t("span",{},[t("span",a?[t("a-tag",{attrs:{color:"green"}},[e._v("是")])]:[t("a-tag",{attrs:{color:"volcano"}},[e._v("否")])],1)])}},{key:"is_superuser",fn:function(a){return t("span",{},[t("span",a?[t("a-tag",{attrs:{color:"green"}},[e._v("是")])]:[t("a-tag",{attrs:{color:"volcano"}},[e._v("否")])],1)])}},{key:"is_two_fa",fn:function(a){return t("span",{},[t("span",a?[t("a-tag",{attrs:{color:"green"}},[e._v("是")])]:[t("a-tag",{attrs:{color:"volcano"}},[e._v("否")])],1)])}},{key:"action",fn:function(a,n){return t("span",{},[t("div",{staticClass:"editable-row-operations"},[t("a",{on:{click:function(){return e.editRow(n)}}},[t("span",{staticStyle:{color:"#409eff"}},[e._v("编辑")])]),t("a-divider",{attrs:{type:"vertical"}}),t("a",{attrs:{type:"dashed"},on:{click:function(t){return e.changePassword(n)}}},[t("span",{staticStyle:{color:"#409eff"}},[e._v("修改密码")])]),t("a-divider",{attrs:{type:"vertical"}}),t("a",{attrs:{type:"dashed"},on:{click:function(t){return e.DeleteConfirm(n.uid)}}},[t("span",{staticStyle:{color:"#409eff"}},[e._v("删除")])])],1)])}}])}),t("UsersAddComponent",{ref:"UsersAddComponent",on:{refreshTable:e.getUsers}}),t("UsersEditComponent",{ref:"UsersEditComponent",on:{refreshTable:e.getUsers}}),t("UsersChangePassComponent",{ref:"UsersChangePassComponent",on:{refreshTable:e.getUsers}})],1)},de=[],me=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"新增用户",width:"55%","on-ok":"onSubmit"},on:{cancel:e.handleCancel},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("template",{slot:"footer"},[t("a-button",{key:"back",on:{click:e.handleCancel}},[e._v("取消")]),t("a-button",{key:"submit",attrs:{type:"primary",loading:e.loading},on:{click:e.onSubmit}},[e._v("确定")])],1),t("a-form",{attrs:{form:e.form,"label-col":{span:4},"wrapper-col":{span:18}}},[t("a-form-item",{attrs:{label:"用户名",help:"用户名必须为英文字符或数字或.的组合，例如：zhangshan, shan.zhang等","has-feedback":""}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["username",{rules:[{required:!0,min:2,max:32,validator:e.validatorUsername}],validateTrigger:"blur"}],expression:"[\n          'username',\n          {\n            rules: [{ required: true, min: 2, max: 32, validator: validatorUsername }],\n            validateTrigger: 'blur',\n          },\n        ]"}],attrs:{autocomplete:"username"}},[t("a-icon",{staticStyle:{color:"rgba(0, 0, 0, 0.25)"},attrs:{slot:"prefix",type:"user"},slot:"prefix"})],1)],1),t("a-form-item",{attrs:{label:"昵称",help:"中文名，例如：张珊","has-feedback":""}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["nick_name",{rules:[{required:!0,min:1,max:32}],validateTrigger:"blur"}],expression:"[\n          'nick_name',\n          {\n            rules: [{ required: true, min: 1, max: 32 }],\n            validateTrigger: 'blur',\n          },\n        ]"}],attrs:{autocomplete:"username"}},[t("a-icon",{staticStyle:{color:"rgba(0, 0, 0, 0.25)"},attrs:{slot:"prefix",type:"user"},slot:"prefix"})],1)],1),t("a-form-item",{attrs:{label:"密码","has-feedback":""}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["password",{rules:[{required:!0,min:2,max:32,validator:e.validatorPass}],validateTrigger:"blur"}],expression:"[\n          'password',\n          {\n            rules: [{ required: true, min: 2, max: 32, validator: validatorPass }],\n            validateTrigger: 'blur',\n          },\n        ]"}],attrs:{autocomplete:"new-password",type:"password"}},[t("a-icon",{staticStyle:{color:"rgba(0, 0, 0, 0.25)"},attrs:{slot:"prefix",type:"lock"},slot:"prefix"})],1)],1),t("a-form-item",{attrs:{label:"邮箱","has-feedback":""}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["email",{rules:[{type:"email",message:"The input is not valid E-mail!"},{required:!0,message:"Please input your E-mail!"}]}],expression:"[\n          'email',\n          {\n            rules: [\n              {\n                type: 'email',\n                message: 'The input is not valid E-mail!',\n              },\n              {\n                required: true,\n                message: 'Please input your E-mail!',\n              },\n            ],\n          },\n        ]"}]},[t("a-icon",{staticStyle:{color:"rgba(0, 0, 0, 0.25)"},attrs:{slot:"prefix",type:"mail"},slot:"prefix"})],1)],1),t("a-form-item",{attrs:{label:"手机号","has-feedback":""}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["mobile",{rules:[{min:3,max:32}],validateTrigger:"blur"}],expression:"[\n          'mobile',\n          {\n            rules: [{ min: 3, max: 32 }],\n            validateTrigger: 'blur',\n          },\n        ]"}]},[t("a-icon",{staticStyle:{color:"rgba(0, 0, 0, 0.25)"},attrs:{slot:"prefix",type:"phone"},slot:"prefix"})],1)],1),t("a-form-item",{attrs:{label:"角色",help:"如果角色下拉列表为空，请先创建【角色】","has-feedback":""}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["role_id",{rules:[{required:!0}],validateTrigger:"blur"}],expression:"[\n          'role_id',\n          {\n            rules: [{ required: true }],\n            validateTrigger: 'blur',\n          },\n        ]"}],attrs:{placeholder:"请选择角色","show-search":""}},e._l(e.roles,(function(a,n){return t("a-select-option",{key:n,attrs:{label:a.name,value:a.id}},[e._v(" "+e._s(a.name)+" ")])})),1)],1),t("a-form-item",{attrs:{label:"2FA",help:"是否开启2次登录验证"}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["is_two_fa",{initialValue:"YES",rules:[{required:!0,message:"是否开启2次登录验证"}]}],expression:"[\n          'is_two_fa',\n          { initialValue: 'YES', rules: [{ required: true, message: '是否开启2次登录验证' }] },\n        ]"}],attrs:{placeholder:"是否开启2次登录验证"}},[t("a-select-option",{attrs:{value:"YES"}},[e._v(" 是 ")]),t("a-select-option",{attrs:{value:"NO"}},[e._v(" 否 ")])],1)],1),t("a-form-item",{attrs:{label:"状态",help:"该用户是否可以登录站点"}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["is_active",{initialValue:"YES",rules:[{required:!0,message:"请选择是否激活"}]}],expression:"['is_active', { initialValue: 'YES', rules: [{ required: true, message: '请选择是否激活' }] }]"}],attrs:{placeholder:"请选择是否激活"}},[t("a-select-option",{attrs:{value:"YES"}},[e._v(" 激活 ")]),t("a-select-option",{attrs:{value:"NO"}},[e._v(" 禁用 ")])],1)],1),t("a-form-item",{attrs:{label:"管理员",help:"该用户是否拥有管理员权限"}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["is_superuser",{initialValue:"NO",rules:[{required:!0,message:"请选择是否为管理员"}]}],expression:"[\n          'is_superuser',\n          { initialValue: 'NO', rules: [{ required: true, message: '请选择是否为管理员' }] },\n        ]"}],attrs:{placeholder:"请选择是否为管理员"}},[t("a-select-option",{attrs:{value:"YES"}},[e._v(" 是 ")]),t("a-select-option",{attrs:{value:"NO"}},[e._v(" 否 ")])],1)],1)],1)],2)},fe=[],pe=(a(4723),{data:function(){return{visible:!1,loading:!1,roles:[],form:this.$form.createForm(this,{name:"usersAdd"}),validatorUsername:function(e,t,a){var n=/^([a-zA-Z]|[_])([\w|.]){2,15}$/;if(!t.match(n))return a("用户名必须为英文字符或数字或.的组合");a()},validatorPass:function(e,t,a){var n=/^.*(?=.{7,})(?=.*\d)(?=.*[A-Z])(?=.*[a-z])(?=.*[!@#$%^&*? ]).*$/;if(!t.match(n))return a("密码强度不满足要求，最少7位，包括至少1个大写字母，1个小写字母，1个数字，1个特殊字符");a()}}},methods:{getRoles:function(){var e=this;this.loading=!0;var t={is_page:!1};(0,s.G_)(t).then((function(t){e.roles=t.data})).catch((function(e){})).finally((function(){e.loading=!1}))},showModal:function(){this.getRoles(),this.form.resetFields(),this.visible=!0},handleCancel:function(e){this.visible=!1},createUsers:function(e){var t=this;(0,s.DA)(e).then((function(e){var a="0000"===e.code?"info":"error";t.$message[a](e.message)})).catch((function(e){})).finally((function(){t.visible=!1,t.loading=!1,t.$emit("refreshTable")}))},onSubmit:function(e){var t=this;this.loading=!0,e.preventDefault(),this.form.validateFields((function(e,a){e||(a["is_two_fa"]="YES"===a["is_two_fa"],a["is_active"]="YES"===a["is_active"],a["is_superuser"]="YES"===a["is_superuser"],t.createUsers(a))})),this.loading=!1}}}),he=pe,ve=(0,m.Z)(he,me,fe,!1,null,null,null),ge=ve.exports,be=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"编辑用户",width:"55%","on-ok":"onSubmit"},on:{cancel:e.handleCancel},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("template",{slot:"footer"},[t("a-button",{key:"back",on:{click:e.handleCancel}},[e._v("取消")]),t("a-button",{key:"submit",attrs:{type:"primary",loading:e.loading},on:{click:e.onSubmit}},[e._v("确定")])],1),t("a-form",{attrs:{form:e.form,"label-col":{span:4},"wrapper-col":{span:18}}},[t("a-form-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{label:"用户ID"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["uid"],expression:"['uid']"}]})],1),t("a-form-item",{attrs:{label:"用户名"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["username",{rules:[{required:!0,min:2,max:32,validator:e.validatorUsername}],validateTrigger:"blur"}],expression:"[\n          'username',\n          {\n            rules: [{ required: true, min: 2, max: 32, validator: validatorUsername }],\n            validateTrigger: 'blur',\n          },\n        ]"}],attrs:{autocomplete:"current-password"}},[t("a-icon",{staticStyle:{color:"rgba(0, 0, 0, 0.25)"},attrs:{slot:"prefix",type:"user"},slot:"prefix"})],1)],1),t("a-form-item",{attrs:{label:"密码"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["password",{rules:[{required:!0,min:7,max:128}],validateTrigger:"blur"}],expression:"[\n          'password',\n          {\n            rules: [{ required: true, min: 7, max: 128 }],\n            validateTrigger: 'blur',\n          },\n        ]"}],attrs:{disabled:"",autocomplete:"current-password",type:"password"}},[t("a-icon",{staticStyle:{color:"rgba(0, 0, 0, 0.25)"},attrs:{slot:"prefix",type:"lock"},slot:"prefix"})],1)],1),t("a-form-item",{attrs:{label:"昵称"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["nick_name",{rules:[{required:!0,min:2,max:32}],validateTrigger:"blur"}],expression:"[\n          'nick_name',\n          {\n            rules: [{ required: true, min: 2, max: 32 }],\n            validateTrigger: 'blur',\n          },\n        ]"}]},[t("a-icon",{staticStyle:{color:"rgba(0, 0, 0, 0.25)"},attrs:{slot:"prefix",type:"user"},slot:"prefix"})],1)],1),t("a-form-item",{attrs:{label:"邮箱"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["email",{rules:[{type:"email",message:"The input is not valid E-mail!"},{required:!0,message:"Please input your E-mail!"}]}],expression:"[\n          'email',\n          {\n            rules: [\n              {\n                type: 'email',\n                message: 'The input is not valid E-mail!',\n              },\n              {\n                required: true,\n                message: 'Please input your E-mail!',\n              },\n            ],\n          },\n        ]"}]},[t("a-icon",{staticStyle:{color:"rgba(0, 0, 0, 0.25)"},attrs:{slot:"prefix",type:"mail"},slot:"prefix"})],1)],1),t("a-form-item",{attrs:{label:"手机号"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["mobile",{rules:[{min:3,max:32}],validateTrigger:"blur"}],expression:"[\n          'mobile',\n          {\n            rules: [{ min: 3, max: 32 }],\n            validateTrigger: 'blur',\n          },\n        ]"}]},[t("a-icon",{staticStyle:{color:"rgba(0, 0, 0, 0.25)"},attrs:{slot:"prefix",type:"phone"},slot:"prefix"})],1)],1),t("a-form-item",{attrs:{label:"角色"}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["role_id"],expression:"['role_id']"}],attrs:{placeholder:"请选择角色","show-search":""}},e._l(e.roles,(function(a,n){return t("a-select-option",{key:n,attrs:{label:a.name,value:a.id}},[e._v(" "+e._s(a.name)+" ")])})),1)],1),t("a-form-item",{attrs:{label:"状态",help:"该用户是否可以登录站点"}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["is_active",{initialValue:"YES",rules:[{required:!0,message:"请选择是否激活"}]}],expression:"['is_active', { initialValue: 'YES', rules: [{ required: true, message: '请选择是否激活' }] }]"}],attrs:{placeholder:"请选择是否激活"}},[t("a-select-option",{attrs:{value:"YES"}},[e._v(" 激活 ")]),t("a-select-option",{attrs:{value:"NO"}},[e._v(" 禁用 ")])],1)],1),t("a-form-item",{attrs:{label:"2FA",help:"是否开启2次登录验证"}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["is_two_fa",{initialValue:"YES",rules:[{required:!0,message:"是否开启2次登录验证"}]}],expression:"[\n          'is_two_fa',\n          { initialValue: 'YES', rules: [{ required: true, message: '是否开启2次登录验证' }] },\n        ]"}],attrs:{placeholder:"是否开启2次登录验证"}},[t("a-select-option",{attrs:{value:"YES"}},[e._v(" 是 ")]),t("a-select-option",{attrs:{value:"NO"}},[e._v(" 否 ")])],1)],1),t("a-form-item",{attrs:{label:"管理员",help:"该用户是否拥有管理员权限"}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["is_superuser",{initialValue:"NO",rules:[{required:!0,message:"请选择是否为管理员"}]}],expression:"[\n          'is_superuser',\n          { initialValue: 'NO', rules: [{ required: true, message: '请选择是否为管理员' }] },\n        ]"}],attrs:{placeholder:"请选择是否为管理员"}},[t("a-select-option",{attrs:{value:"YES"}},[e._v(" 是 ")]),t("a-select-option",{attrs:{value:"NO"}},[e._v(" 否 ")])],1)],1)],1)],2)},ye=[],_e={data:function(){return{visible:!1,loading:!1,form:this.$form.createForm(this,{name:"usersEdit"}),roles:[],validatorUsername:function(e,t,a){var n=/^([a-zA-Z]|[_])([\w|.]){2,15}$/;if(!t.match(n))return a("用户名必须为英文字符或数字或.的组合");a()}}},methods:{getRoles:function(){var e=this;this.loading=!0;var t={is_page:!1};(0,s.G_)(t).then((function(t){e.roles=t.data})).catch((function(e){})).finally((function(){e.loading=!1}))},showModal:function(e){var t=this;this.getRoles(),this.form.resetFields(),this.$nextTick((function(){setTimeout((function(){var a={uid:e.uid,username:e.username,password:e.password,email:e.email,nick_name:e.nick_name,mobile:e.mobile,role_id:0===e.role_id?null:e.role_id,is_two_fa:!0===e.is_two_fa?"YES":"NO",is_superuser:!0===e.is_superuser?"YES":"NO",is_active:!0===e.is_active?"YES":"NO"};t.form.setFieldsValue(a)}))})),this.visible=!0},handleCancel:function(e){this.visible=!1},updateUsers:function(e){var t=this;(0,s.M6)(e).then((function(e){var a="0000"===e.code?"info":"error";t.$message[a](e.message)})).catch((function(e){})).finally((function(){t.visible=!1,t.loading=!1,t.$emit("refreshTable")}))},onSubmit:function(e){var t=this;this.loading=!0,e.preventDefault(),this.form.validateFields((function(e,a){e||(a["is_two_fa"]="YES"===a["is_two_fa"],a["is_active"]="YES"===a["is_active"],a["is_superuser"]="YES"===a["is_superuser"],t.updateUsers(a))})),this.loading=!1}}},ke=_e,xe=(0,m.Z)(ke,be,ye,!1,null,null,null),we=xe.exports,Se=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:"55%","on-ok":"onSubmit"},on:{cancel:e.handleCancel},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("template",{slot:"footer"},[t("a-button",{key:"back",on:{click:e.handleCancel}},[e._v("取消")]),t("a-button",{key:"submit",attrs:{type:"primary",loading:e.loading},on:{click:e.onSubmit}},[e._v("确定")])],1),t("a-form",{attrs:{form:e.form,"label-col":{span:4},"wrapper-col":{span:18}}},[t("a-form-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{label:"用户ID"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["uid"],expression:"['uid']"}]})],1),t("a-form-item",{attrs:{label:"新密码","has-feedback":""}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["password",{rules:[{required:!0,min:2,max:32,validator:e.validatorPass}],validateTrigger:"blur"}],expression:"[\n          'password',\n          {\n            rules: [{ required: true, min: 2, max: 32, validator: validatorPass }],\n            validateTrigger: 'blur',\n          },\n        ]"}],attrs:{autocomplete:"new-password",type:"password"}},[t("a-icon",{staticStyle:{color:"rgba(0, 0, 0, 0.25)"},attrs:{slot:"prefix",type:"lock"},slot:"prefix"})],1)],1),t("a-form-item",{attrs:{label:"确认密码","has-feedback":""}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["verify_password",{rules:[{required:!0,min:2,max:32,validator:e.validatorVerifyPass}],validateTrigger:"blur"}],expression:"[\n          'verify_password',\n          {\n            rules: [{ required: true, min: 2, max: 32, validator: validatorVerifyPass }],\n            validateTrigger: 'blur',\n          },\n        ]"}],attrs:{autocomplete:"new-password",type:"password"}},[t("a-icon",{staticStyle:{color:"rgba(0, 0, 0, 0.25)"},attrs:{slot:"prefix",type:"lock"},slot:"prefix"})],1)],1)],1)],2)},Ce=[],Ne={data:function(){var e=this;return{visible:!1,loading:!1,title:"",form:this.$form.createForm(this,{name:"usersChangePassword"}),validatorPass:function(e,t,a){var n=/^.*(?=.{7,})(?=.*\d)(?=.*[A-Z])(?=.*[a-z])(?=.*[!@#$%^&*? ]).*$/;if(!t.match(n))return a("密码强度不满足要求，最少7位，包括至少1个大写字母，1个小写字母，1个数字，1个特殊字符");a()},validatorVerifyPass:function(t,a,n){var i=/^.*(?=.{7,})(?=.*\d)(?=.*[A-Z])(?=.*[a-z])(?=.*[!@#$%^&*? ]).*$/;if(!a.match(i))return n("密码强度不满足要求，最少7位，包括至少1个大写字母，1个小写字母，1个数字，1个特殊字符");var r=e.form;a&&a!==r.getFieldValue("password")&&n("您输入的两个密码不一致"),n()}}},methods:{showModal:function(e){var t=this;this.form.resetFields(),this.title="修改用户"+e.username+"的密码",this.visible=!0,this.$nextTick((function(){setTimeout((function(){t.form.setFieldsValue({uid:e.uid})}))}))},handleCancel:function(e){this.visible=!1},changeUsersPass:function(e){var t=this;(0,s.X7)(e).then((function(e){var a="0000"===e.code?"info":"error";t.$message[a](e.message)})).catch((function(e){})).finally((function(){t.visible=!1,t.loading=!1,t.$emit("refreshTable")}))},onSubmit:function(e){var t=this;this.loading=!0,e.preventDefault(),this.form.validateFields((function(e,a){e||t.changeUsersPass(a)})),this.loading=!1}}},ze=Ne,Te=(0,m.Z)(ze,Se,Ce,!1,null,null,null),$e=Te.exports,qe=[{title:"用户",dataIndex:"username",key:"username",scopedSlots:{customRender:"username"}},{title:"昵称",dataIndex:"nick_name",key:"nick_name",scopedSlots:{customRender:"nick_name"}},{title:"角色",dataIndex:"role",key:"role",scopedSlots:{customRender:"role"}},{title:"激活",dataIndex:"is_active",key:"is_active",scopedSlots:{customRender:"is_active"}},{title:"2FA认证",dataIndex:"is_two_fa",key:"is_two_fa",scopedSlots:{customRender:"is_two_fa"}},{title:"管理员",dataIndex:"is_superuser",key:"is_superuser",scopedSlots:{customRender:"is_superuser"}},{title:"邮箱",dataIndex:"email",key:"email",scopedSlots:{customRender:"email"}},{title:"手机号",dataIndex:"mobile",key:"mobile",scopedSlots:{customRender:"mobile"}},{title:"组织",dataIndex:"organization",key:"organization",scopedSlots:{customRender:"organization"}},{title:"加入时间",dataIndex:"date_joined",key:"date_joined",scopedSlots:{customRender:"date_joined"}},{title:"操作",dataIndex:"action",key:"action",scopedSlots:{customRender:"action"}}],Ue={components:{UsersAddComponent:ge,UsersEditComponent:we,UsersChangePassComponent:$e},data:function(){return{loading:!1,tableColumns:qe,tableData:[],organizations:[],roles:[],pagination:{current:1,pageSize:10,total:0,pageSizeOptions:["10","20"],showSizeChanger:!0},form:this.$form.createForm(this,{name:"users"})}},methods:{getOrganizations:function(){var e=this;this.loading=!0;var t={is_page:!1};(0,s.xY)(t).then((function(t){e.organizations=t.data})).catch((function(e){})).finally((function(){e.loading=!1}))},getRoles:function(){var e=this;this.loading=!0;var t={is_page:!1};(0,s.G_)(t).then((function(t){e.roles=t.data})).catch((function(e){})).finally((function(){e.loading=!1}))},getUsers:function(){var e=this;this.loading=!0;var t=(0,$.Z)({page_size:this.pagination.pageSize,page:this.pagination.current,is_page:!0},this.filters);(0,s.xE)(t).then((function(t){e.pagination.total=t.total,e.tableData=t.data})).catch((function(e){})).finally((function(){e.loading=!1}))},editRow:function(e){this.$refs.UsersEditComponent.showModal(e)},onAdd:function(){this.$refs.UsersAddComponent.showModal()},changePassword:function(e){this.$refs.UsersChangePassComponent.showModal(e)},DeleteConfirm:function(e){var t=this;this.$confirm({title:"警告",content:"你确定删除？",okText:"Yes",okType:"danger",cancelText:"No",onOk:function(){(0,s.mN)(e).then((function(e){"0001"===e.code?t.$message.warning(e.message):t.$message.info(e.message)})).catch((function(e){})).finally((function(){t.getUsers()}))},onCancel:function(){}})},handleTableChange:function(e){this.pagination.current=e.current,this.pagination.pageSize=e.pageSize,this.getUsers()},handleSearch:function(e){var t=this;e.preventDefault(),this.form.validateFields((function(e,a){if(!e){var n="";void 0!=a["organization_key"]&&(n=a["organization_key"][a["organization_key"].length-1]),t.filters={organization_key:n,role_id:a["role_id"],search:a["search"]},t.pagination.current=1,t.getUsers()}}))}},mounted:function(){this.getUsers(),this.getOrganizations(),this.getRoles()}},Re=Ue,Ee=(0,m.Z)(Re,ue,de,!1,null,"75f1fc54",null),Oe=Ee.exports,Fe={components:{UsersComponent:Oe,RolesComponent:ce,OrganizationsComponent:K}},Pe=Fe,Ae=(0,m.Z)(Pe,n,i,!1,null,"24d2b27a",null),Ze=Ae.exports},94688:function(e,t,a){a.d(t,{BQ:function(){return b},DA:function(){return r},EP:function(){return p},G_:function(){return c},Ly:function(){return g},M6:function(){return o},MF:function(){return _},P4:function(){return d},QQ:function(){return v},X7:function(){return l},ZS:function(){return u},ie:function(){return m},mN:function(){return s},nk:function(){return y},vp:function(){return h},xE:function(){return i},xY:function(){return f}});var n=a(34820),i=function(e){return n.ZP.request({url:"/api/v1/admin/users",method:"get",params:e})},r=function(e){return n.ZP.request({url:"/api/v1/admin/users",method:"post",data:e})},o=function(e){return n.ZP.request({url:"/api/v1/admin/users/".concat(e.uid),method:"put",data:e})},s=function(e){return n.ZP.request({url:"/api/v1/admin/users/".concat(e),method:"delete",data:e})},l=function(e){return n.ZP.request({url:"/api/v1/admin/users/change/password",method:"post",data:e})},c=function(e){return n.ZP.request({url:"/api/v1/admin/roles",method:"get",params:e})},u=function(e){return n.ZP.request({url:"/api/v1/admin/roles",method:"post",data:e})},d=function(e){return n.ZP.request({url:"/api/v1/admin/roles/".concat(e.id),method:"put",data:e})},m=function(e){return n.ZP.request({url:"/api/v1/admin/roles/".concat(e),method:"delete",data:e})},f=function(e){return n.ZP.request({url:"/api/v1/admin/organizations",method:"get",params:e})},p=function(e){return n.ZP.request({url:"/api/v1/admin/organizations/root-node",method:"post",data:e})},h=function(e){return n.ZP.request({url:"/api/v1/admin/organizations/child-node",method:"post",data:e})},v=function(e){return n.ZP.request({url:"/api/v1/admin/organizations",method:"put",data:e})},g=function(e){return n.ZP.request({url:"/api/v1/admin/organizations",method:"delete",data:e})},b=function(e){return n.ZP.request({url:"/api/v1/admin/organizations/users",method:"get",params:e})},y=function(e){return n.ZP.request({url:"/api/v1/admin/organizations/users",method:"post",data:e})},_=function(e){return n.ZP.request({url:"/api/v1/admin/organizations/users",method:"delete",data:e})}}}]);