(self["webpackChunkvue_antd_pro"]=self["webpackChunkvue_antd_pro"]||[]).push([[593],{4593:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return A}});r(26699);var a=function(){var e=this,t=e._self._c;return e.orderDetail?t("page-header-wrapper",{attrs:{title:e.orderDetail.title},scopedSlots:e._u([{key:"content",fn:function(){return[t("a-descriptions",{attrs:{size:"small",column:3}},[t("a-descriptions-item",{attrs:{label:"申请人"}},[e._v(e._s(e.orderDetail.applicant))]),t("a-descriptions-item",{attrs:{label:"工单环境"}},[t("span",{staticStyle:{color:"red"}},[e._v(e._s(e.orderDetail.environment))])]),t("a-descriptions-item",{attrs:{label:"DB类型"}},[e._v(e._s(e.orderDetail.db_type))]),t("a-descriptions-item",{attrs:{label:"工单类型"}},[e._v(e._s(e.orderDetail.sql_type))]),t("a-descriptions-item",{attrs:{label:"DB实例"}},[e._v(e._s(e.orderDetail.instance))]),t("a-descriptions-item",{attrs:{label:"库名"}},[t("span",{staticStyle:{color:"blue"}},[e._v(e._s(e.orderDetail.schema))])]),"EXPORT"===e.orderDetail.sql_type?t("a-descriptions-item",{attrs:{label:"文件格式"}},[e._v(e._s(e.orderDetail.export_file_format))]):e._e(),t("a-descriptions-item",{attrs:{label:"创建时间"}},[e._v(e._s(e.orderDetail.created_at))]),t("a-descriptions-item",{attrs:{label:"更新时间"}},[e._v(e._s(e.orderDetail.updated_at))])],1)]},proxy:!0},{key:"extraContent",fn:function(){return[t("a-row",{staticClass:"status-list"},[t("a-col",{attrs:{xs:24,sm:24}},[t("div",{staticClass:"text"},[e._v("状态")]),t("div",{staticClass:"heading"},[t("h2",[e._v(e._s(e.orderDetail.progress))])])])],1)]},proxy:!0},{key:"extra",fn:function(){return[t("a-button-group",{staticStyle:{"margin-right":"4px"}},[t("a-button",{attrs:{type:"dashed",disabled:e.btnStatus.btnDisabled,icon:"retweet"},on:{click:e.showActionModal}},[e._v(" "+e._s(e._f("btnTitle")(e.orderDetail.progress))+" ")]),"已复核"===e.orderDetail.progress?t("a-button",{attrs:{icon:"link"},on:{click:e.showHookModal}},[e._v("钩子")]):e._e(),t("a-button",{attrs:{type:"dashed",disabled:e.btnStatus.closeDisabled,icon:"close-circle"},on:{click:e.showCloseModal}},[e._v("关闭工单")]),["已批准","执行中","已完成","已复核"].includes(e.orderDetail.progress)?t("a-button",{attrs:{type:"dashed",loading:e.executeLoading,icon:"thunderbolt"},on:{click:e.generateSqlOrdersTasks}},[e._v("执行工单")]):e._e(),t("a-button",{attrs:{type:"dashed",loading:e.refreshLoading,icon:"sync"},on:{click:e.refresh}},[e._v("刷新")])],1),t("a-modal",{attrs:{title:"请输入附加信息"},model:{value:e.actionVisible,callback:function(t){e.actionVisible=t},expression:"actionVisible"}},[t("a-textarea",{attrs:{"allow-clear":"",rows:"3",autoSize:{minRows:3,maxRows:8}},model:{value:e.confirmMsg,callback:function(t){e.confirmMsg=t},expression:"confirmMsg"}}),t("template",{slot:"footer"},[t("a-button",{key:"back",on:{click:e.handleActionCancel}},[e._v(e._s(e.confirmBtnTips.cancelText))]),t("a-button",{key:"submit",attrs:{type:"primary",loading:e.loading},on:{click:e.handleActionOk}},[e._v(" "+e._s(e.confirmBtnTips.okText)+" ")])],1)],2),t("a-modal",{attrs:{title:"请输入附加信息"},model:{value:e.closeVisible,callback:function(t){e.closeVisible=t},expression:"closeVisible"}},[t("a-textarea",{attrs:{rows:"3",autoSize:{minRows:3,maxRows:5}},model:{value:e.confirmMsg,callback:function(t){e.confirmMsg=t},expression:"confirmMsg"}}),t("template",{slot:"footer"},[t("a-button",{key:"back",on:{click:e.handleCloseCancel}},[e._v("取消")]),t("a-button",{key:"submit",attrs:{type:"primary",loading:e.loading},on:{click:e.handleCloseOk}},[e._v("确定")])],1)],2),t("DetailHookComponent",{ref:"DetailHookComponent",attrs:{orderDetail:e.orderDetail}})]},proxy:!0}],null,!1,4052209515)},[t("a-card",{attrs:{bordered:!1,title:"附加信息"}},[t("a-descriptions",{attrs:{size:"small",column:1}},["00000000-0000-0000-0000-000000000000"!=e.orderDetail.hook_order_id?t("a-descriptions-item",{attrs:{label:"Hook工单"}},[t("router-link",{attrs:{target:"_blank",to:{name:"view.orders.detail",params:{order_id:e.orderDetail.hook_order_id}}},nativeOn:{click:function(t){return e.refresh.apply(null,arguments)}}},[e._v(e._s(e.orderDetail.hook_order_id))])],1):e._e(),t("a-descriptions-item",{attrs:{label:"工单备注"}},[e.orderDetail.remark?t("span",[e._v(e._s(e.orderDetail.remark))]):t("span",[e._v("无")])]),t("a-descriptions-item",{attrs:{label:"工单执行人"}},[e.orderDetail.executor?t("span",e._l(e.orderDetail.executor,(function(r){return t("span",{key:r},[t("a-tag",{attrs:{color:"purple"}},[e._v(e._s(r))])],1)})),0):t("span",[e._v(" 无 ")])]),t("a-descriptions-item",{attrs:{label:"工单抄送人"}},[e.orderDetail.cc?t("span",e._l(e.orderDetail.cc,(function(r){return t("span",{key:r},[t("a-tag",[e._v(e._s(r))])],1)})),0):t("span",[e._v(" 无 ")])])],1)],1),t("a-card",{directives:[{name:"show",rawName:"v-show",value:0!=e.statistics.total,expression:"statistics.total != 0"}],staticStyle:{"margin-top":"12px"},attrs:{bordered:!1,title:"任务进度"}},[t("a-row",{attrs:{gutter:16}},[t("a-col",{attrs:{span:3}},[t("a-statistic",{staticStyle:{"margin-right":"50px"},attrs:{title:"任务数",value:this.statistics.total},scopedSlots:e._u([{key:"suffix",fn:function(){return[t("a-icon",{attrs:{type:"flag"}})]},proxy:!0}],null,!1,3400718464)})],1),t("a-col",{attrs:{span:3}},[t("a-statistic",{staticClass:"demo-class",attrs:{title:"已完成",value:this.statistics.completed},scopedSlots:e._u([{key:"suffix",fn:function(){return[t("a-icon",{attrs:{type:"flag"}})]},proxy:!0}],null,!1,3400718464)})],1),t("a-col",{attrs:{span:3}},[t("a-statistic",{staticClass:"demo-class",attrs:{title:"未执行",value:this.statistics.unexecuted},scopedSlots:e._u([{key:"suffix",fn:function(){return[t("a-icon",{attrs:{type:"flag"}})]},proxy:!0}],null,!1,3400718464)})],1),t("a-col",{attrs:{span:3}},[t("a-statistic",{staticClass:"demo-class",attrs:{title:"已失败",value:this.statistics.failed},scopedSlots:e._u([{key:"suffix",fn:function(){return[t("a-icon",{attrs:{type:"flag"}})]},proxy:!0}],null,!1,3400718464)})],1),t("a-col",{attrs:{span:3}},[t("a-statistic",{staticClass:"demo-class",attrs:{title:"执行中",value:this.statistics.processing},scopedSlots:e._u([{key:"suffix",fn:function(){return[t("a-icon",{attrs:{type:"flag"}})]},proxy:!0}],null,!1,3400718464)})],1),t("a-col",{attrs:{span:3}},[t("a-statistic",{staticClass:"demo-class",attrs:{title:"已暂停",value:this.statistics.paused},scopedSlots:e._u([{key:"suffix",fn:function(){return[t("a-icon",{attrs:{type:"flag"}})]},proxy:!0}],null,!1,3400718464)})],1)],1)],1),t("DetailProgressComponent",{ref:"DetailProgressComponent",attrs:{orderDetail:e.orderDetail}}),t("div",{staticStyle:{"margin-top":"12px"}},[t("DetailCodeMirrorComponent",{ref:"DetailCodeMirrorComponent"})],1)],1):e._e()},s=[],o=(r(41539),r(72701)),n=function(){var e=this,t=e._self._c;return t("a-card",{attrs:{bordered:!1,title:"工单内容"}},[t("codemirror",{ref:"myCm",attrs:{options:e.cmOptions},on:{ready:e.onCmReady},model:{value:e.code,callback:function(t){e.code=t},expression:"code"}})],1)},i=[],l=(r(24603),r(74916),r(39714),r(4723),r(4631)),c=r.n(l),u=(r(54086),r(20017),r(21994),r(14504),r(4328),r(82801),r(14146),new RegExp("^create |^drop |^truncate |^update |^delete |^insert into|on update|unique|change|modify|rename","i"));c().defineMode("highlightText",(function(e,t){var r={token:function(e,t){if(e.match(u))return"highlightText";while(null!=e.next()&&!e.match(u,!1))return null;return null}};return c().overlayMode(c().getMode(e,t.backdrop||"text/x-mysql"),r)}));var d={data:function(){return{code:"",cmOptions:{mode:"highlightText",indentUnit:2,tabSize:2,indentWithTabs:!0,smartIndent:!0,autoRefresh:!0,lineNumbers:!0,styleActiveLine:!0,lineWrapping:!0,showCursorWhenSelecting:!0,readOnly:!0,focuse:!1}}},methods:{onCmReady:function(e){e.setSize("height","550px")},setValue:function(e){this.codemirror.setValue(e)}},computed:{codemirror:function(){return this.$refs.myCm.codemirror}}},p=d,f=r(1001),h=(0,f.Z)(p,n,i,!1,null,null,null),m=h.exports,v=(r(68309),function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"HOOK工单",width:"65%","on-ok":"onSubmit"},on:{cancel:e.handleCancel},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("template",{slot:"footer"},[t("a-button",{key:"back",on:{click:e.handleCancel}},[e._v("取消")]),t("a-button",{key:"submit",attrs:{type:"primary",loading:e.loading},on:{click:e.onSubmit}},[e._v("确定")])],1),t("a-form",{attrs:{form:e.form,"label-col":{span:2},"wrapper-col":{span:22}}},[t("a-form-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{label:"工单ID"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["order_id",{rules:[{required:!0}]}],expression:"['order_id', { rules: [{ required: true }] }]"}],attrs:{disabled:""}})],1),t("a-form-item",{attrs:{label:"当前工单"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["title",{rules:[{required:!0}]}],expression:"['title', { rules: [{ required: true }] }]"}],attrs:{disabled:""}})],1),t("a-form-item",{attrs:{label:"DB类型"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["db_type",{rules:[{required:!0}]}],expression:"['db_type', { rules: [{ required: true }] }]"}],attrs:{disabled:""}})],1),t("a-form-item",{attrs:{label:"当前库"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["schema",{rules:[{required:!0}]}],expression:"['schema', { rules: [{ required: true }] }]"}],attrs:{disabled:""}})],1),t("a-form-item",{attrs:{label:"审核状态"}},[t("a-switch",{attrs:{"checked-children":"重置审核状态为：待审批","un-checked-children":"继承审核状态为：已批准","default-checked":""},on:{change:e.onRestProgress}})],1),t("a-form-item",{attrs:{label:"目标库"}},[t("a-card",[e._l(e.keysList,(function(r,a){return t("div",{key:a},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{span:8}},[t("a-form-item",{attrs:{label:"环境",labelCol:{span:6},wrapperCol:{span:18},"has-feedback":""}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["target_environments[".concat(a,"]"),{rules:[{required:!0,message:"请选择工单环境"}]}],expression:"[\n                    `target_environments[${index}]`,\n                    { rules: [{ required: true, message: '请选择工单环境' }] },\n                  ]"}],attrs:{placeholder:"请选择工单环境",allowClear:"","show-search":""},on:{change:e.changeEnvs}},e._l(e.environments,(function(r,a){return t("a-select-option",{key:a,attrs:{label:r.name,value:r.id}},[e._v(" "+e._s(r.name)+" ")])})),1)],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-item",{attrs:{label:"实例",labelCol:{span:6},wrapperCol:{span:18},"has-feedback":""}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["target_instance_ids[".concat(a,"]"),{rules:[{required:!0,message:"请选择数据库实例"}]}],expression:"[\n                    `target_instance_ids[${index}]`,\n                    { rules: [{ required: true, message: '请选择数据库实例' }] },\n                  ]"}],attrs:{placeholder:"请选择数据库实例",allowClear:"","show-search":""},on:{change:e.changeIns}},e._l(e.instances,(function(r,a){return t("a-select-option",{key:a,attrs:{label:r.remark,value:r.instance_id}},[e._v(" "+e._s(r.remark)+" ")])})),1)],1)],1),t("a-col",{attrs:{span:6}},[t("a-form-item",{attrs:{label:"库名",labelCol:{span:6},wrapperCol:{span:18},"has-feedback":""}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["target_schemas[".concat(a,"]"),{rules:[{required:!0,message:"请选择数据库"}]}],expression:"[`target_schemas[${index}]`, { rules: [{ required: true, message: '请选择数据库' }] }]"}],attrs:{placeholder:"请选择数据库",allowClear:"","show-search":""}},e._l(e.schemas,(function(r,a){return t("a-select-option",{key:a,attrs:{label:r.schema,value:r.schema}},[e._v(" "+e._s(r.schema)+" ")])})),1)],1)],1),t("a-col",{attrs:{span:2}},[t("a-form-item",{attrs:{labelCol:{span:0},wrapperCol:{span:24}}},[e.keysList.length>1?[t("a-icon",{staticStyle:{"margin-left":"8px"},attrs:{type:"minus",disabled:1===e.keysList.length},on:{click:function(t){return e.removeFormItem(a)}}})]:e._e()],2)],1)],1)],1)})),t("a-button",{staticClass:"addRowBtn",attrs:{type:"dashed",icon:"plus"},on:{click:e.addFormItem}},[e._v("新增一行")])],2)],1)],1)],2)}),g=[],b=(r(40561),r(54747),{props:{orderDetail:Object},data:function(){return{visible:!1,loading:!1,environments:[],instances:[],schemas:[],progress:"待审核",form:this.$form.createForm(this,{name:"hook"}),keysList:[{}]}},methods:{addFormItem:function(){this.keysList.push({})},removeFormItem:function(e){this.keysList.splice(e,1)},showModal:function(){var e=this;this.visible=!0,this.$nextTick((function(){setTimeout((function(){e.form.setFieldsValue({title:e.orderDetail.title,schema:e.orderDetail.schema,db_type:e.orderDetail.db_type,order_id:e.orderDetail.order_id})}))}))},hideModal:function(){this.visible=!1},handleCancel:function(){this.hideModal()},getEnvironments:function(){var e=this;(0,o.hS)({is_page:!1}).then((function(t){e.environments=t.data}))},changeEnvs:function(e){var t=this,r={id:e,db_type:this.form.getFieldValue("db_type"),is_page:!1};(0,o.E5)(r).then((function(e){t.instances=e.data})).catch((function(e){}))},changeIns:function(e){var t=this,r={instance_id:e,is_page:!1};(0,o.gg)(r).then((function(e){t.schemas=e.data})).catch((function(e){}))},onRestProgress:function(e){this.progress=e?"待审核":"已批准"},onSubmit:function(e){var t=this;this.loading=!0,e.preventDefault(),this.form.validateFields((function(e,r){var a=[];t.keysList.forEach((function(e,t){var s={environment:r["target_environments"][t],instance_id:r["target_instance_ids"][t],schema:r["target_schemas"][t]};a.push(s)})),r["target"]=a,r["progress"]=t.progress,e||(0,o.ci)(r).then((function(e){"0000"===e.code?t.$router.push("/orders/list"):t.$message.error(e.message)})).catch((function(e){}))})),this.loading=!1}},mounted:function(){this.getEnvironments()}}),_=b,k=(0,f.Z)(_,v,g,!1,null,"48707f4b",null),y=k.exports,x=function(){var e=this,t=e._self._c;return t("a-card",{staticStyle:{"margin-top":"12px"},attrs:{bordered:!1,title:"工单进度"}},[t("a-steps",{attrs:{current:e.currentStatus,size:"small"}},[t("a-step",{attrs:{title:"创建工单"}}),t("a-step",{attrs:{title:"待审核"}}),t("a-step",{attrs:{title:"已批准/已驳回"}}),t("a-step",{attrs:{title:"执行中"}}),t("a-step",{attrs:{title:"已完成/已关闭"}}),t("a-step",{attrs:{title:"已复核"}})],1),t("a-row",{staticStyle:{"margin-top":"24px"},attrs:{gutter:8}},[t("a-col",{staticClass:"gutter-row",attrs:{span:0!=e.opLogs.length?10:24}},[t("a-card",{ref:"leftHeight",attrs:{type:"inner"}},[e._l(e.orderDetail.approver,(function(r){return t("a-descriptions",{key:"auditor"+r.user+r.status,attrs:{size:"small",col:4}},[t("a-descriptions-item",{attrs:{label:"审核人"}},[e._v(" "+e._s(r.user)+" "),1===r.is_superuser?t("span",[e._v("(超级审核人)")]):e._e()]),t("a-descriptions-item",{attrs:{label:"状态"}},["pending"===r.status?t("a-tag",{attrs:{color:"blue"}},[e._v("未审核")]):"pass"===r.status?t("a-tag",{attrs:{color:"green"}},[e._v("已审核")]):t("a-tag",{attrs:{color:"red"}},[e._v("已驳回")])],1)],1)})),t("a-divider",{staticStyle:{margin:"5px"}}),e._l(e.orderDetail.reviewer,(function(r){return t("a-descriptions",{key:"reviewer"+r.user+r.status,attrs:{size:"small",col:4}},[t("a-descriptions-item",{attrs:{label:"复核人"}},[e._v(e._s(r.user))]),t("a-descriptions-item",{attrs:{label:"状态"}},["pending"===r.status?t("a-tag",{attrs:{color:"blue"}},[e._v("未复核")]):t("a-tag",{attrs:{color:"green"}},[e._v("已复核")])],1)],1)}))],2)],1),t("a-col",{attrs:{span:0!=e.opLogs.length?14:0}},[t("a-card",{staticClass:"box-card",style:{height:e.leftHeight},attrs:{type:"inner"}},[t("span",{domProps:{innerHTML:e._s(e.opLogs)}})])],1)],1)],1)},D=[],C=(r(92222),r(69600),r(63844)),w=r.n(C),M=w()(),P={props:{orderDetail:Object},data:function(){return{opLogs:"",leftHeight:""}},methods:{getOpLogs:function(){var e=this,t={order_id:this.orderDetail.order_id};(0,o.QU)(t).then((function(t){var r=[];"0000"===t.code&&(t.data.forEach((function(e){r.push("[".concat(e.updated_at,"] ").concat(e.msg))})),e.opLogs=r.join("<br>"))})).catch((function(e){}))},getLeftHeight:function(){var e=this;M.listenTo(this.$refs.leftHeight.$el,(function(t){e.leftHeight=t.offsetHeight+"px"}))}},computed:{currentStatus:function(){return"待审核"===this.orderDetail.progress?1:"已驳回"===this.orderDetail.progress||"已批准"===this.orderDetail.progress?2:"执行中"===this.orderDetail.progress?3:"已关闭"===this.orderDetail.progress||"已完成"===this.orderDetail.progress?4:"已复核"===this.orderDetail.progress?5:6}},mounted:function(){this.getOpLogs(),this.getLeftHeight()}},S=P,q=(0,f.Z)(S,x,D,!1,null,"d63e1368",null),T=q.exports,L={okText:"确认",cancelText:"取消",action:""},O={okText:"提交",cancelText:"关闭",action:"close"},Z={btnDisabled:!1,closeDisabled:!1},$={components:{DetailCodeMirrorComponent:m,DetailHookComponent:y,DetailProgressComponent:T},data:function(){return{orderDetail:null,confirmBtnTips:L,btnStatus:Z,loading:!1,executeLoading:!1,refreshLoading:!1,actionVisible:!1,closeVisible:!1,confirmMsg:"",statistics:{}}},methods:{getDetail:function(){var e=this;this.loading=!0,(0,o.Xu)(this.$route.params.order_id).then((function(t){"0000"===t.code?(e.orderDetail=t.data,e.$nextTick((function(){e.$refs.DetailCodeMirrorComponent.setValue(e.orderDetail.content)}))):e.$message.error(t.message)})).catch((function(e){})).finally((function(){e.loading=!1}))},refresh:function(){this.refreshLoading=!0,this.getDetail(),this.previewTasks(),this.$refs.DetailProgressComponent.getOpLogs(),this.refreshLoading=!1},showActionModal:function(){this.actionVisible=!0},hideActionModal:function(){this.actionVisible=!1},handleActionOk:function(){this.hideActionModal(),this.handleCommit("ok",L.action)},handleActionCancel:function(){this.hideActionModal(),this.handleCommit("cancel",L.action)},handleCommit:function(e,t){if(this.loading=!0,this.confirmMsg.length>256)return this.$message.error("提交失败, 消息长度不能超过256个字符"),this.hideActionModal(),!1;if("approve"===t){var r="ok"===e?"pass":"reject",a={status:r,msg:this.confirmMsg,order_id:this.orderDetail.order_id};this.approveOrders(a)}if("feedback"===t){var s="ok"===e?"已完成":"执行中";a={progress:s,msg:this.confirmMsg,order_id:this.orderDetail.order_id};this.feedbackOrders(a)}if("review"===t){s="ok"===e?"已复核":"None";if("None"===s)return void this.hideActionModal();a={msg:this.confirmMsg,order_id:this.orderDetail.order_id};this.reviewOrders(a)}if("close"===t){a={msg:this.confirmMsg,order_id:this.orderDetail.order_id};this.closeOrders(a)}this.loading=!1,this.confirmMsg=""},approveOrders:function(e){var t=this;(0,o.eU)(e).then((function(e){var r="0000"===e.code?"info":"error";t.$message[r](e.message)})).catch((function(e){})).finally((function(){t.hideActionModal(),t.refresh()}))},feedbackOrders:function(e){var t=this;(0,o.pl)(e).then((function(e){var r="0000"===e.code?"info":"error";t.$message[r](e.message)})).catch((function(e){})).finally((function(){t.hideActionModal(),t.refresh()}))},reviewOrders:function(e){var t=this;(0,o.um)(e).then((function(e){var r="0000"===e.code?"info":"error";t.$message[r](e.message)})).catch((function(e){})).finally((function(){t.hideActionModal(),t.refresh()}))},closeOrders:function(e){var t=this;(0,o.EE)(e).then((function(e){var r="0000"===e.code?"info":"error";t.$message[r](e.message)})).catch((function(e){})).finally((function(){t.refresh()}))},showHookModal:function(){this.$refs.DetailHookComponent.showModal()},showCloseModal:function(){this.closeVisible=!0},hideCloseModal:function(e){this.closeVisible=!1},handleCloseOk:function(e){this.handleCommit("ok",O.action),this.hideCloseModal()},handleCloseCancel:function(){this.hideCloseModal()},generateSqlOrdersTasks:function(){var e=this,t={order_id:this.orderDetail.order_id};(0,o.l5)(t).then((function(t){"0000"===t.code?e.$router.push("/orders/tasks/".concat(e.orderDetail.order_id)):e.$message.error(t.message)})).catch((function(e){}))},previewTasks:function(){var e=this,t={order_id:this.$route.params.order_id};(0,o.gc)(t).then((function(t){e.statistics=t.data})).catch((function(e){}))}},mounted:function(){this.getDetail(),this.previewTasks()},filters:{btnTitle:function(e){return"待审核"===e?(Z.btnDisabled=!1,Z.closeDisabled=!1,L.okText="同意",L.cancelText="驳回",L.action="approve","审核"):["已批准","执行中"].includes(e)?(Z.btnDisabled=!1,Z.closeDisabled=!1,L.okText="执行完成",L.cancelText="执行中",L.action="feedback","更新状态"):"已完成"===e?(Z.btnDisabled=!1,Z.closeDisabled=!0,L.okText="确定",L.cancelText="取消",L.action="review","复核"):["已复核","已驳回","已关闭"].includes(e)?(Z.btnDisabled=!0,Z.closeDisabled=!0,"完成"):void 0}}},H=$,V=(0,f.Z)(H,a,s,!1,null,"53190a5c",null),A=V.exports},72701:function(e,t,r){"use strict";r.d(t,{$W:function(){return _},E5:function(){return o},EE:function(){return v},M0:function(){return c},QU:function(){return p},Xu:function(){return d},ci:function(){return g},eU:function(){return f},el:function(){return u},gc:function(){return k},gg:function(){return n},hS:function(){return s},jb:function(){return y},kK:function(){return D},l5:function(){return b},pl:function(){return h},u7:function(){return l},um:function(){return m},xE:function(){return i},xZ:function(){return x}});var a=r(34820),s=function(e){return a.ZP.request({url:"/api/v1/orders/environments",method:"get",params:e})},o=function(e){return a.ZP.request({url:"/api/v1/orders/instances",method:"get",params:e})},n=function(e){return a.ZP.request({url:"/api/v1/orders/schemas",method:"get",params:e})},i=function(e){return a.ZP.request({url:"/api/v1/orders/users",method:"get",params:e})},l=function(e){return a.ZP.request({url:"/api/v1/orders/syntax-inspect",method:"post",data:e})},c=function(e){return a.ZP.request({url:"/api/v1/orders/commit",method:"post",data:e})},u=function(e){return a.ZP.request({url:"/api/v1/orders/list",method:"get",params:e})},d=function(e){return a.ZP.request({url:"/api/v1/orders/detail/".concat(e),method:"get",params:e})},p=function(e){return a.ZP.request({url:"/api/v1/orders/detail/oplogs",method:"get",params:e})},f=function(e){return a.ZP.request({url:"/api/v1/orders/operate/approve",method:"put",data:e})},h=function(e){return a.ZP.request({url:"/api/v1/orders/operate/feedback",method:"put",data:e})},m=function(e){return a.ZP.request({url:"/api/v1/orders/operate/review",method:"put",data:e})},v=function(e){return a.ZP.request({url:"/api/v1/orders/operate/close",method:"put",data:e})},g=function(e){return a.ZP.request({url:"/api/v1/orders/hook",method:"post",data:e})},b=function(e){return a.ZP.request({url:"/api/v1/orders/generate-tasks",method:"post",data:e})},_=function(e){return a.ZP.request({url:"/api/v1/orders/tasks/".concat(e.order_id),method:"get",params:e})},k=function(e){return a.ZP.request({url:"/api/v1/orders/tasks/preview",method:"get",params:e})},y=function(e){return a.ZP.request({url:"/api/v1/orders/tasks/execute-single",method:"post",data:e})},x=function(e){return a.ZP.request({url:"/api/v1/orders/tasks/execute-all",method:"post",data:e})},D=function(e){return a.ZP.request({url:"/api/v1/orders/download/exportfile/".concat(e),method:"get",responseType:"blob"})}},14146:function(e,t,r){(function(e){e(r(4631))})((function(e){"use strict";e.overlayMode=function(t,r,a){return{startState:function(){return{base:e.startState(t),overlay:e.startState(r),basePos:0,baseCur:null,overlayPos:0,overlayCur:null,streamSeen:null}},copyState:function(a){return{base:e.copyState(t,a.base),overlay:e.copyState(r,a.overlay),basePos:a.basePos,baseCur:null,overlayPos:a.overlayPos,overlayCur:null}},token:function(e,s){return(e!=s.streamSeen||Math.min(s.basePos,s.overlayPos)<e.start)&&(s.streamSeen=e,s.basePos=s.overlayPos=e.start),e.start==s.basePos&&(s.baseCur=t.token(e,s.base),s.basePos=e.pos),e.start==s.overlayPos&&(e.pos=e.start,s.overlayCur=r.token(e,s.overlay),s.overlayPos=e.pos),e.pos=Math.min(s.basePos,s.overlayPos),null==s.overlayCur?s.baseCur:null!=s.baseCur&&s.overlay.combineTokens||a&&null==s.overlay.combineTokens?s.baseCur+" "+s.overlayCur:s.overlayCur},indent:t.indent&&function(e,r,a){return t.indent(e.base,r,a)},electricChars:t.electricChars,innerMode:function(e){return{state:e.base,mode:t}},blankLine:function(e){var s,o;return t.blankLine&&(s=t.blankLine(e.base)),r.blankLine&&(o=r.blankLine(e.overlay)),null==o?s:a&&null!=s?s+" "+o:o}}}}))}}]);